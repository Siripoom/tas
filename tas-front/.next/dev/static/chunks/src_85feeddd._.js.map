{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/services/apiClient.js"],"sourcesContent":["// create axios instance with default config\nimport axios from \"axios\";\n\nconst baseURL = process.env.NEXT_PUBLIC_API_BASE_URL || \"http://localhost:4556/api\";\n\nconst apiClient = axios.create({\n  baseURL,\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n});\n\nconst getToken = () => (typeof window !== \"undefined\" ? localStorage.getItem(\"token\") : null);\nconst getRefreshToken = () =>\n  typeof window !== \"undefined\" ? localStorage.getItem(\"refreshToken\") : null;\n\nconst setTokens = (accessToken, refreshToken) => {\n  if (typeof window === \"undefined\") return;\n  if (accessToken) localStorage.setItem(\"token\", accessToken);\n  if (refreshToken) localStorage.setItem(\"refreshToken\", refreshToken);\n};\n\nconst clearTokens = () => {\n  if (typeof window === \"undefined\") return;\n  localStorage.removeItem(\"token\");\n  localStorage.removeItem(\"refreshToken\");\n};\n\napiClient.interceptors.request.use(\n  (config) => {\n    const token = getToken();\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => Promise.reject(error),\n);\n\nlet isRefreshing = false;\nlet pendingRequests = [];\n\nconst processQueue = (error, token = null) => {\n  pendingRequests.forEach((promise) => {\n    if (error) {\n      promise.reject(error);\n    } else {\n      promise.resolve(token);\n    }\n  });\n  pendingRequests = [];\n};\n\napiClient.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n\n    if (error.response?.status !== 401 || originalRequest?._retry) {\n      return Promise.reject(error);\n    }\n\n    const refreshToken = getRefreshToken();\n    if (!refreshToken) {\n      clearTokens();\n      return Promise.reject(error);\n    }\n\n    if (isRefreshing) {\n      return new Promise((resolve, reject) => {\n        pendingRequests.push({ resolve, reject });\n      })\n        .then((token) => {\n          originalRequest.headers.Authorization = `Bearer ${token}`;\n          return apiClient(originalRequest);\n        })\n        .catch((refreshError) => Promise.reject(refreshError));\n    }\n\n    originalRequest._retry = true;\n    isRefreshing = true;\n\n    try {\n      const response = await axios.post(`${baseURL}/auth/refresh`, { refreshToken });\n      const newAccessToken = response.data?.accessToken;\n      const newRefreshToken = response.data?.refreshToken || refreshToken;\n\n      setTokens(newAccessToken, newRefreshToken);\n      processQueue(null, newAccessToken);\n\n      originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n      return apiClient(originalRequest);\n    } catch (refreshError) {\n      processQueue(refreshError, null);\n      clearTokens();\n      if (typeof window !== \"undefined\") {\n        localStorage.removeItem(\"user\");\n      }\n      return Promise.reject(refreshError);\n    } finally {\n      isRefreshing = false;\n    }\n  },\n);\n\nexport default apiClient;\n"],"names":[],"mappings":"AAAA,4CAA4C;;;;;AAG5B;AAFhB;;AAEA,MAAM,UAAU,iEAAwC;AAExD,MAAM,YAAY,mJAAK,CAAC,MAAM,CAAC;IAC7B;IACA,SAAS;QACP,gBAAgB;IAClB;AACF;AAEA,MAAM,WAAW,IAAO,uCAAgC,aAAa,OAAO,CAAC,WAAW;AACxF,MAAM,kBAAkB,IACtB,uCAAgC,aAAa,OAAO,CAAC,kBAAkB;AAEzE,MAAM,YAAY,CAAC,aAAa;IAC9B;;IACA,IAAI,aAAa,aAAa,OAAO,CAAC,SAAS;IAC/C,IAAI,cAAc,aAAa,OAAO,CAAC,gBAAgB;AACzD;AAEA,MAAM,cAAc;IAClB;;IACA,aAAa,UAAU,CAAC;IACxB,aAAa,UAAU,CAAC;AAC1B;AAEA,UAAU,YAAY,CAAC,OAAO,CAAC,GAAG,CAChC,CAAC;IACC,MAAM,QAAQ;IACd,IAAI,OAAO;QACT,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IAClD;IACA,OAAO;AACT,GACA,CAAC,QAAU,QAAQ,MAAM,CAAC;AAG5B,IAAI,eAAe;AACnB,IAAI,kBAAkB,EAAE;AAExB,MAAM,eAAe,CAAC,OAAO,QAAQ,IAAI;IACvC,gBAAgB,OAAO,CAAC,CAAC;QACvB,IAAI,OAAO;YACT,QAAQ,MAAM,CAAC;QACjB,OAAO;YACL,QAAQ,OAAO,CAAC;QAClB;IACF;IACA,kBAAkB,EAAE;AACtB;AAEA,UAAU,YAAY,CAAC,QAAQ,CAAC,GAAG,CACjC,CAAC,WAAa,UACd,OAAO;IACL,MAAM,kBAAkB,MAAM,MAAM;IAEpC,IAAI,MAAM,QAAQ,EAAE,WAAW,OAAO,iBAAiB,QAAQ;QAC7D,OAAO,QAAQ,MAAM,CAAC;IACxB;IAEA,MAAM,eAAe;IACrB,IAAI,CAAC,cAAc;QACjB;QACA,OAAO,QAAQ,MAAM,CAAC;IACxB;IAEA,IAAI,cAAc;QAChB,OAAO,IAAI,QAAQ,CAAC,SAAS;YAC3B,gBAAgB,IAAI,CAAC;gBAAE;gBAAS;YAAO;QACzC,GACG,IAAI,CAAC,CAAC;YACL,gBAAgB,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;YACzD,OAAO,UAAU;QACnB,GACC,KAAK,CAAC,CAAC,eAAiB,QAAQ,MAAM,CAAC;IAC5C;IAEA,gBAAgB,MAAM,GAAG;IACzB,eAAe;IAEf,IAAI;QACF,MAAM,WAAW,MAAM,mJAAK,CAAC,IAAI,CAAC,GAAG,QAAQ,aAAa,CAAC,EAAE;YAAE;QAAa;QAC5E,MAAM,iBAAiB,SAAS,IAAI,EAAE;QACtC,MAAM,kBAAkB,SAAS,IAAI,EAAE,gBAAgB;QAEvD,UAAU,gBAAgB;QAC1B,aAAa,MAAM;QAEnB,gBAAgB,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,gBAAgB;QAClE,OAAO,UAAU;IACnB,EAAE,OAAO,cAAc;QACrB,aAAa,cAAc;QAC3B;QACA,wCAAmC;YACjC,aAAa,UAAU,CAAC;QAC1B;QACA,OAAO,QAAQ,MAAM,CAAC;IACxB,SAAU;QACR,eAAe;IACjB;AACF;uCAGa"}},
    {"offset": {"line": 104, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/services/file.js"],"sourcesContent":["import apiClient from \"./apiClient\";\n\nconst normalizeFile = (file, user = null) => ({\n  id: file.id,\n  fileName: file.originalName || file.fileName || \"file\",\n  fileType: file.fileType,\n  ownerType: file.ownerType,\n  ownerId: file.ownerId,\n  mimeType: file.mimeType,\n  sizeBytes: file.sizeBytes,\n  uploadedAt: file.uploadedAt || file.createdAt,\n  user,\n  downloadUrl: `/files/${file.id}/download`,\n});\n\nexport const getFilesByOwner = async (ownerType, ownerId) => {\n  const response = await apiClient.get(\"/files\", {\n    params: {\n      ownerType,\n      ownerId,\n    },\n  });\n\n  return Array.isArray(response.data)\n    ? response.data.map((item) => normalizeFile(item))\n    : [];\n};\n\n// Get all files\nexport const getAllFiles = async (params = {}) => {\n  const response = await apiClient.get(\"/files\", { params });\n  return Array.isArray(response.data) ? response.data.map((item) => normalizeFile(item)) : [];\n};\n\n// Get file by ID\nexport const getFileById = async (id) => {\n  const files = await getAllFiles();\n  return files.find((file) => file.id === id) || null;\n};\n\n// Upload single file (compat)\nexport const uploadFileActivity = async (file, ownerId) => {\n  const formData = new FormData();\n  formData.append(\"file\", file);\n  formData.append(\"ownerType\", \"RECORD\");\n  formData.append(\"ownerId\", ownerId);\n\n  const response = await apiClient.post(\"/files/upload\", formData, {\n    headers: {\n      \"Content-Type\": \"multipart/form-data\",\n    },\n  });\n\n  return normalizeFile(response.data);\n};\n\nexport const uploadFileAttendance = async (file, attendanceId) => {\n  const formData = new FormData();\n  formData.append(\"file\", file);\n  formData.append(\"ownerType\", \"APPLICATION\");\n  formData.append(\"ownerId\", attendanceId);\n\n  const response = await apiClient.post(\"/files/upload\", formData, {\n    headers: {\n      \"Content-Type\": \"multipart/form-data\",\n    },\n  });\n\n  return normalizeFile(response.data);\n};\n\nexport const downloadAttendanceFile = async (attendanceId) => {\n  const files = await getFilesByOwner(\"APPLICATION\", attendanceId);\n  if (!files.length) {\n    throw new Error(\"No evidence file found\");\n  }\n\n  const response = await apiClient.get(`/files/${files[0].id}/download`, {\n    responseType: \"blob\",\n  });\n  return response.data;\n};\n\n// Upload multiple files (compat)\nexport const uploadMultipleFiles = async (files, attendanceId) => {\n  const uploaded = await Promise.all(\n    files.slice(0, 3).map((file) => uploadFileAttendance(file, attendanceId)),\n  );\n  return uploaded;\n};\n\n// Upload students CSV (deprecated in new API contract)\nexport const uploadStudentsCSV = async () => {\n  throw new Error(\"CSV upload is not supported in this build. Use /admin/import/students JSON payload.\");\n};\n\n// Delete file\nexport const deleteFile = async (id) => {\n  const response = await apiClient.delete(`/files/${id}`);\n  return response.data;\n};\n\n// Download file\nexport const downloadFile = async (id) => {\n  const response = await apiClient.get(`/files/${id}/download`, {\n    responseType: \"blob\",\n  });\n  return response.data;\n};\n\n// Get files by activity\nexport const getFilesByActivity = async (activityId) => {\n  const detailResponse = await apiClient.get(`/activities/${activityId}`);\n  const activity = detailResponse.data;\n  const applications = Array.isArray(activity.applications) ? activity.applications : [];\n\n  const batches = await Promise.all(\n    applications.map(async (application) => {\n      const files = await getFilesByOwner(\"APPLICATION\", application.id);\n      return files.map((file) => ({ ...file, user: application.student || null }));\n    }),\n  );\n\n  return batches.flat();\n};\n\nexport const getFilesByApplication = async (applicationId) => {\n  return getFilesByOwner(\"APPLICATION\", applicationId);\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA,MAAM,gBAAgB,CAAC,MAAM,OAAO,IAAI,GAAK,CAAC;QAC5C,IAAI,KAAK,EAAE;QACX,UAAU,KAAK,YAAY,IAAI,KAAK,QAAQ,IAAI;QAChD,UAAU,KAAK,QAAQ;QACvB,WAAW,KAAK,SAAS;QACzB,SAAS,KAAK,OAAO;QACrB,UAAU,KAAK,QAAQ;QACvB,WAAW,KAAK,SAAS;QACzB,YAAY,KAAK,UAAU,IAAI,KAAK,SAAS;QAC7C;QACA,aAAa,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC,SAAS,CAAC;IAC3C,CAAC;AAEM,MAAM,kBAAkB,OAAO,WAAW;IAC/C,MAAM,WAAW,MAAM,0IAAS,CAAC,GAAG,CAAC,UAAU;QAC7C,QAAQ;YACN;YACA;QACF;IACF;IAEA,OAAO,MAAM,OAAO,CAAC,SAAS,IAAI,IAC9B,SAAS,IAAI,CAAC,GAAG,CAAC,CAAC,OAAS,cAAc,SAC1C,EAAE;AACR;AAGO,MAAM,cAAc,OAAO,SAAS,CAAC,CAAC;IAC3C,MAAM,WAAW,MAAM,0IAAS,CAAC,GAAG,CAAC,UAAU;QAAE;IAAO;IACxD,OAAO,MAAM,OAAO,CAAC,SAAS,IAAI,IAAI,SAAS,IAAI,CAAC,GAAG,CAAC,CAAC,OAAS,cAAc,SAAS,EAAE;AAC7F;AAGO,MAAM,cAAc,OAAO;IAChC,MAAM,QAAQ,MAAM;IACpB,OAAO,MAAM,IAAI,CAAC,CAAC,OAAS,KAAK,EAAE,KAAK,OAAO;AACjD;AAGO,MAAM,qBAAqB,OAAO,MAAM;IAC7C,MAAM,WAAW,IAAI;IACrB,SAAS,MAAM,CAAC,QAAQ;IACxB,SAAS,MAAM,CAAC,aAAa;IAC7B,SAAS,MAAM,CAAC,WAAW;IAE3B,MAAM,WAAW,MAAM,0IAAS,CAAC,IAAI,CAAC,iBAAiB,UAAU;QAC/D,SAAS;YACP,gBAAgB;QAClB;IACF;IAEA,OAAO,cAAc,SAAS,IAAI;AACpC;AAEO,MAAM,uBAAuB,OAAO,MAAM;IAC/C,MAAM,WAAW,IAAI;IACrB,SAAS,MAAM,CAAC,QAAQ;IACxB,SAAS,MAAM,CAAC,aAAa;IAC7B,SAAS,MAAM,CAAC,WAAW;IAE3B,MAAM,WAAW,MAAM,0IAAS,CAAC,IAAI,CAAC,iBAAiB,UAAU;QAC/D,SAAS;YACP,gBAAgB;QAClB;IACF;IAEA,OAAO,cAAc,SAAS,IAAI;AACpC;AAEO,MAAM,yBAAyB,OAAO;IAC3C,MAAM,QAAQ,MAAM,gBAAgB,eAAe;IACnD,IAAI,CAAC,MAAM,MAAM,EAAE;QACjB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,WAAW,MAAM,0IAAS,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,SAAS,CAAC,EAAE;QACrE,cAAc;IAChB;IACA,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,sBAAsB,OAAO,OAAO;IAC/C,MAAM,WAAW,MAAM,QAAQ,GAAG,CAChC,MAAM,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,OAAS,qBAAqB,MAAM;IAE7D,OAAO;AACT;AAGO,MAAM,oBAAoB;IAC/B,MAAM,IAAI,MAAM;AAClB;AAGO,MAAM,aAAa,OAAO;IAC/B,MAAM,WAAW,MAAM,0IAAS,CAAC,MAAM,CAAC,CAAC,OAAO,EAAE,IAAI;IACtD,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,eAAe,OAAO;IACjC,MAAM,WAAW,MAAM,0IAAS,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,GAAG,SAAS,CAAC,EAAE;QAC5D,cAAc;IAChB;IACA,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,qBAAqB,OAAO;IACvC,MAAM,iBAAiB,MAAM,0IAAS,CAAC,GAAG,CAAC,CAAC,YAAY,EAAE,YAAY;IACtE,MAAM,WAAW,eAAe,IAAI;IACpC,MAAM,eAAe,MAAM,OAAO,CAAC,SAAS,YAAY,IAAI,SAAS,YAAY,GAAG,EAAE;IAEtF,MAAM,UAAU,MAAM,QAAQ,GAAG,CAC/B,aAAa,GAAG,CAAC,OAAO;QACtB,MAAM,QAAQ,MAAM,gBAAgB,eAAe,YAAY,EAAE;QACjE,OAAO,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;gBAAE,GAAG,IAAI;gBAAE,MAAM,YAAY,OAAO,IAAI;YAAK,CAAC;IAC5E;IAGF,OAAO,QAAQ,IAAI;AACrB;AAEO,MAAM,wBAAwB,OAAO;IAC1C,OAAO,gBAAgB,eAAe;AACxC"}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/components/participation/EvidenceListModal.js"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { Avatar, Button, Modal, Space, Spin, Table, Tag, Input, Image } from \"antd\";\nimport { CheckCircle, Eye, FileText, User, XCircle } from \"lucide-react\";\nimport { downloadFile } from \"@/services/file\";\n\nconst { TextArea } = Input;\n\nconst previewableMimeTypes = [\"image/jpeg\", \"image/png\", \"image/webp\", \"image/gif\"];\n\nconst statusConfig = {\n  APPLIED: { color: \"#fa8c16\", text: \"รอตรวจ\" },\n  REVISION_REQUIRED: { color: \"#f5222d\", text: \"ต้องแก้ไข\" },\n  APPROVED: { color: \"#0A894C\", text: \"อนุมัติแล้ว\" },\n  COMPLETED: { color: \"#0A894C\", text: \"เสร็จสิ้น\" },\n};\n\nconst isActionableStatus = (status) => [\"APPLIED\", \"REVISION_REQUIRED\"].includes(status);\n\nconst fileLabel = (file) => {\n  if (file.fileType === \"PDF\" || file.mimeType === \"application/pdf\") return \"PDF\";\n  return \"รูปภาพ\";\n};\n\nconst EvidenceListModal = ({\n  visible,\n  onClose,\n  activity,\n  onApprove,\n  onReject,\n  filesByAttendanceId = {},\n  loading = false,\n}) => {\n  const [selectedRowKeys, setSelectedRowKeys] = useState([]);\n  const [rejectModalVisible, setRejectModalVisible] = useState(false);\n  const [rejectReason, setRejectReason] = useState(\"\");\n  const [studentsToReject, setStudentsToReject] = useState([]);\n  const [previewVisible, setPreviewVisible] = useState(false);\n  const [previewImage, setPreviewImage] = useState(\"\");\n  const [previewTitle, setPreviewTitle] = useState(\"\");\n  const [openingFileId, setOpeningFileId] = useState(null);\n\n  useEffect(() => {\n    return () => {\n      if (previewImage) {\n        window.URL.revokeObjectURL(previewImage);\n      }\n    };\n  }, [previewImage]);\n\n  const studentsWithEvidence = useMemo(() => {\n    const attendances = Array.isArray(activity?.attendances) ? activity.attendances : [];\n    return attendances.map((attendance) => {\n      const files = filesByAttendanceId[attendance.id] || [];\n      return {\n        ...attendance,\n        studentId: attendance.user?.studentCode || attendance.user?.studentId || \"-\",\n        name:\n          attendance.user?.fullname ||\n          `${attendance.user?.firstName || \"\"} ${attendance.user?.lastName || \"\"}`.trim() ||\n          \"Unknown\",\n        department: attendance.user?.department?.name || \"-\",\n        major: attendance.user?.major?.name || \"-\",\n        year: attendance.user?.classYear || attendance.user?.level || \"-\",\n        uploadDate: attendance.updatedAt?.split(\"T\")[0] || \"-\",\n        files,\n      };\n    });\n  }, [activity?.attendances, filesByAttendanceId]);\n\n  const handleOpenFile = async (file) => {\n    setOpeningFileId(file.id);\n    try {\n      const blob = await downloadFile(file.id);\n      const objectUrl = window.URL.createObjectURL(blob);\n\n      if (previewableMimeTypes.includes(file.mimeType)) {\n        if (previewImage) {\n          window.URL.revokeObjectURL(previewImage);\n        }\n        setPreviewImage(objectUrl);\n        setPreviewTitle(file.fileName || \"Evidence\");\n        setPreviewVisible(true);\n      } else {\n        window.open(objectUrl, \"_blank\", \"noopener,noreferrer\");\n        setTimeout(() => {\n          window.URL.revokeObjectURL(objectUrl);\n        }, 30000);\n      }\n    } catch (error) {\n      console.error(\"Error opening evidence file:\", error);\n    } finally {\n      setOpeningFileId(null);\n    }\n  };\n\n  const handleBulkApprove = () => {\n    const selectedStudents = studentsWithEvidence.filter((student) =>\n      selectedRowKeys.includes(student.id),\n    );\n    selectedStudents.forEach((student) => onApprove(student));\n    setSelectedRowKeys([]);\n  };\n\n  const handleRejectClick = (student = null) => {\n    if (student) {\n      setStudentsToReject([student]);\n    } else {\n      const selectedStudents = studentsWithEvidence.filter((item) =>\n        selectedRowKeys.includes(item.id),\n      );\n      setStudentsToReject(selectedStudents);\n    }\n    setRejectModalVisible(true);\n  };\n\n  const handleConfirmReject = () => {\n    if (!rejectReason.trim()) {\n      alert(\"กรุณาระบุเหตุผลในการส่งกลับแก้ไข\");\n      return;\n    }\n\n    studentsToReject.forEach((student) => {\n      onReject({ ...student, rejectReason: rejectReason.trim() });\n    });\n\n    setRejectModalVisible(false);\n    setRejectReason(\"\");\n    setStudentsToReject([]);\n    setSelectedRowKeys([]);\n  };\n\n  const rowSelection = {\n    selectedRowKeys,\n    onChange: (selectedKeys) => setSelectedRowKeys(selectedKeys),\n    getCheckboxProps: (record) => ({\n      disabled: !isActionableStatus(record.status),\n    }),\n  };\n\n  const columns = [\n    {\n      title: \"ลำดับ\",\n      width: 70,\n      align: \"center\",\n      render: (_, __, index) => index + 1,\n    },\n    {\n      title: \"นักศึกษา\",\n      dataIndex: \"name\",\n      render: (name, record) => (\n        <div className=\"flex items-center gap-2\">\n          <Avatar size={32} style={{ backgroundColor: \"#0A894C\" }} icon={<User size={18} />} />\n          <div>\n            <div className=\"font-medium\">{name}</div>\n            <div className=\"text-xs text-gray-500\">{record.studentId}</div>\n          </div>\n        </div>\n      ),\n    },\n    {\n      title: \"ภาควิชา\",\n      dataIndex: \"department\",\n      width: 160,\n    },\n    {\n      title: \"สาขา\",\n      dataIndex: \"major\",\n      width: 120,\n      align: \"center\",\n      render: (major) => <Tag color=\"#0A894C\">{major}</Tag>,\n    },\n    {\n      title: \"ชั้นปี\",\n      dataIndex: \"year\",\n      width: 90,\n      align: \"center\",\n      render: (year) => (year === \"-\" ? \"-\" : `ปี ${year}`),\n    },\n    {\n      title: \"ไฟล์หลักฐาน\",\n      width: 320,\n      render: (_, record) => {\n        if (!record.files.length) {\n          return <span className=\"text-gray-400\">ยังไม่มีไฟล์หลักฐาน</span>;\n        }\n\n        return (\n          <Space wrap>\n            {record.files.map((file) => (\n              <Button\n                key={file.id}\n                size=\"small\"\n                icon={<Eye size={14} />}\n                loading={openingFileId === file.id}\n                onClick={() => handleOpenFile(file)}\n              >\n                {fileLabel(file)}\n              </Button>\n            ))}\n          </Space>\n        );\n      },\n    },\n    {\n      title: \"สถานะ\",\n      dataIndex: \"status\",\n      width: 120,\n      align: \"center\",\n      render: (status) => {\n        const config = statusConfig[status] || { color: \"default\", text: status };\n        return <Tag color={config.color}>{config.text}</Tag>;\n      },\n    },\n    {\n      title: \"การจัดการ\",\n      width: 170,\n      align: \"center\",\n      render: (_, record) => {\n        if (!isActionableStatus(record.status)) {\n          return <span className=\"text-xs text-gray-500\">ไม่มีรายการที่ต้องจัดการ</span>;\n        }\n\n        return (\n          <Space size={4}>\n            <Button\n              size=\"small\"\n              type=\"primary\"\n              icon={<CheckCircle size={14} />}\n              onClick={() => onApprove(record)}\n              style={{ backgroundColor: \"#0A894C\", borderColor: \"#0A894C\" }}\n            >\n              อนุมัติ\n            </Button>\n            <Button size=\"small\" danger icon={<XCircle size={14} />} onClick={() => handleRejectClick(record)}>\n              ส่งกลับ\n            </Button>\n          </Space>\n        );\n      },\n    },\n  ];\n\n  return (\n    <>\n      <Modal\n        title={\n          <div>\n            <h3 className=\"text-lg font-semibold\" style={{ color: \"#0A894C\" }}>\n              <FileText size={20} className=\"inline mr-2\" />\n              หลักฐานการเข้าร่วมกิจกรรม\n            </h3>\n            <p className=\"text-sm text-gray-500 mt-1\">\n              {activity?.name || activity?.activityName || \"กิจกรรม\"}\n            </p>\n          </div>\n        }\n        open={visible}\n        onCancel={onClose}\n        width={1200}\n        footer={null}\n      >\n        <Spin spinning={loading}>\n          {selectedRowKeys.length > 0 && (\n            <div className=\"mb-4 flex gap-2\">\n              <Button\n                type=\"primary\"\n                icon={<CheckCircle size={16} />}\n                onClick={handleBulkApprove}\n                style={{\n                  backgroundColor: \"#0A894C\",\n                  borderColor: \"#0A894C\",\n                }}\n              >\n                อนุมัติที่เลือก ({selectedRowKeys.length})\n              </Button>\n              <Button danger icon={<XCircle size={16} />} onClick={() => handleRejectClick()}>\n                ส่งกลับแก้ไข ({selectedRowKeys.length})\n              </Button>\n            </div>\n          )}\n\n          <Table\n            columns={columns}\n            dataSource={studentsWithEvidence}\n            rowKey=\"id\"\n            rowSelection={rowSelection}\n            pagination={{ pageSize: 6 }}\n            scroll={{ x: 1100 }}\n          />\n        </Spin>\n      </Modal>\n\n      <Modal open={previewVisible} title={previewTitle} footer={null} onCancel={() => setPreviewVisible(false)} width={700}>\n        <Image src={previewImage} alt={previewTitle} style={{ width: \"100%\" }} preview={false} />\n      </Modal>\n\n      <Modal\n        title=\"เหตุผลการส่งกลับแก้ไข\"\n        open={rejectModalVisible}\n        onCancel={() => {\n          setRejectModalVisible(false);\n          setRejectReason(\"\");\n          setStudentsToReject([]);\n        }}\n        onOk={handleConfirmReject}\n        okText=\"ยืนยัน\"\n        cancelText=\"ยกเลิก\"\n        okButtonProps={{\n          style: { backgroundColor: \"#f5222d\", borderColor: \"#f5222d\" },\n        }}\n      >\n        <div className=\"mb-4\">\n          <p className=\"text-gray-600 mb-2\">\n            นักศึกษาที่ส่งกลับ: {studentsToReject.map((student) => student.name).join(\", \")}\n          </p>\n          <TextArea\n            rows={4}\n            placeholder=\"กรุณาระบุเหตุผล...\"\n            value={rejectReason}\n            onChange={(event) => setRejectReason(event.target.value)}\n          />\n        </div>\n      </Modal>\n    </>\n  );\n};\n\nexport default EvidenceListModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 836, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/components/participation/ParticipationTable.js"],"sourcesContent":["\"use client\";\n\nimport { Table, Button, Tag } from \"antd\";\nimport { Eye } from \"lucide-react\";\n\nconst ParticipationTable = ({\n  data,\n  onView,\n  showParticipationCount = false,\n  showEvidenceCount = false\n}) => {\n  const columns = [\n    {\n      title: \"ลำดับ\",\n      dataIndex: \"index\",\n      key: \"index\",\n      width: 80,\n      align: \"center\",\n      render: (text, record, index) => index + 1,\n    },\n    {\n      title: \"กิจกรรม\",\n      key: \"activityName\",\n      ellipsis: true,\n      render: (_, record) => record.name || record.activityName,\n    },\n    {\n      title: \"ภาควิชา\",\n      key: \"department\",\n      width: 180,\n      render: (_, record) => record.department?.name || record.department || \"-\",\n    },\n    {\n      title: \"สาขาวิชา\",\n      key: \"major\",\n      width: 150,\n      align: \"center\",\n      render: (_, record) => {\n        // Handle API data with majorJoins\n        if (record.majorJoins && record.majorJoins.length > 0) {\n          return (\n            <div className=\"flex flex-wrap gap-1 justify-center\">\n              {record.majorJoins.map((mj, idx) => (\n                <Tag\n                  key={idx}\n                  color=\"#0A894C\"\n                  style={{\n                    borderRadius: 8,\n                    fontWeight: 500,\n                  }}\n                >\n                  {mj.major?.name}\n                </Tag>\n              ))}\n            </div>\n          );\n        }\n        // Handle mock data\n        if (record.major) {\n          return (\n            <Tag\n              color=\"#0A894C\"\n              style={{\n                borderRadius: 8,\n                fontWeight: 500,\n              }}\n            >\n              {record.major}\n            </Tag>\n          );\n        }\n        return <span className=\"text-gray-400\">ทุกสาขา</span>;\n      },\n    },\n    {\n      title: showParticipationCount ? \"จำนวนผู้เข้าร่วม\" : showEvidenceCount ? \"จำนวนส่งหลักฐาน\" : \"จำนวนนักศึกษา\",\n      key: \"studentCount\",\n      width: 150,\n      align: \"center\",\n      render: (_, record) => {\n        // Determine which count to show\n        let count, max;\n\n        if (showParticipationCount) {\n          count = record.participationCount || 0;\n          max = record.maxPeopleCount || record.maxStudents || 0;\n        } else if (showEvidenceCount) {\n          count = record.evidenceCount || 0;\n          max = record.maxPeopleCount || record.maxStudents || 0;\n        } else {\n          count = record.studentCount || record.peopleCount || 0;\n          max = record.maxStudents || record.maxPeopleCount || 0;\n        }\n\n        const percentage = max > 0 ? (count / max) * 100 : 0;\n        const color =\n          percentage >= 80\n            ? \"#f5222d\"\n            : percentage >= 50\n            ? \"#fa8c16\"\n            : \"#0A894C\";\n\n        return (\n          <span\n            style={{\n              color: color,\n              fontWeight: \"600\",\n              fontSize: \"14px\",\n            }}\n          >\n            {count}/{max}\n          </span>\n        );\n      },\n    },\n    {\n      title: \"การจัดการ\",\n      key: \"action\",\n      width: 120,\n      align: \"center\",\n      render: (_, record) => (\n        <div className=\"flex gap-2 justify-center\">\n          <Button\n            type=\"text\"\n            icon={<Eye size={18} />}\n            onClick={() => onView(record)}\n            style={{ color: \"#0A894C\" }}\n            title=\"ดูรายละเอียด\"\n          />\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <Table\n      columns={columns}\n      dataSource={data}\n      rowKey=\"id\"\n      pagination={{\n        pageSize: 10,\n        showSizeChanger: true,\n        showTotal: (total) => `ทั้งหมด ${total} รายการ`,\n      }}\n      scroll={{ x: 800 }}\n      style={{\n        backgroundColor: \"#ffffff\",\n        borderRadius: 8,\n      }}\n    />\n  );\n};\n\nexport default ParticipationTable;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1028, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/components/participation/SearchFilterBar.js"],"sourcesContent":["\"use client\";\n\nimport { Input, Select, Row, Col, Button } from \"antd\";\nimport { Search, RotateCcw } from \"lucide-react\";\n\nconst { Option } = Select;\n\nconst defaultDepartments = [\n    \"คอมพิวเตอร์ศึกษา\",\n    \"ครุศาสตร์โยธา\",\n    \"ครุศาสตร์ไฟฟ้า\",\n    \"ครุศาสตร์เครื่องกล\",\n    \"ครุศาสตร์เทคโนโลยีและสารสนเทศ\",\n    \"บริหารเทคนิคศึกษา\",\n];\n\nconst defaultMajors = [\"TCT\", \"CED\"];\nconst defaultYears = [\"1\", \"2\", \"3\", \"4\"];\n\nconst SearchFilterBar = ({\n  onSearch,\n  onFilterChange,\n  onReset,\n  hideDepartmentFilter = false,\n  departmentOptions = defaultDepartments,\n  majorOptions = defaultMajors,\n  yearOptions = defaultYears,\n}) => {\n\n  return (\n    <div\n      className=\"p-4 rounded-lg mb-4\"\n      style={{\n        background: \"#ffffff\",\n        border: \"1px solid #e8f5e9\",\n        boxShadow: \"0 2px 8px rgba(10, 137, 76, 0.08)\",\n      }}\n    >\n      <Row gutter={[16, 16]}>\n        {/* Search Input */}\n        <Col xs={24} md={8}>\n          <Input\n            placeholder=\"Search by student ID, name, or activity name\"\n            prefix={<Search size={16} style={{ color: \"#0A894C\" }} />}\n            onChange={(e) => onSearch(e.target.value)}\n            size=\"large\"\n            style={{\n              borderColor: \"#0A894C\",\n            }}\n          />\n        </Col>\n\n        {/* Department Filter */}\n        {!hideDepartmentFilter && (\n          <Col xs={24} md={5}>\n            <Select\n              placeholder=\"เลือกภาควิชา\"\n              onChange={(value) => onFilterChange(\"department\", value)}\n              allowClear\n              size=\"large\"\n              style={{ width: \"100%\" }}\n            >\n              {departmentOptions.map((dept) => (\n                <Option key={dept.id || dept} value={dept.id || dept}>\n                  {dept.name || dept}\n                </Option>\n              ))}\n            </Select>\n          </Col>\n        )}\n\n        {/* Major Filter */}\n        <Col xs={24} md={hideDepartmentFilter ? 6 : 4}>\n          <Select\n            placeholder=\"เลือกสาขาวิชา\"\n            onChange={(value) => onFilterChange(\"major\", value)}\n            allowClear\n            size=\"large\"\n            style={{ width: \"100%\" }}\n          >\n            {majorOptions.map((major) => (\n              <Option key={major.id || major} value={major.id || major}>\n                {major.name || major}\n              </Option>\n            ))}\n          </Select>\n        </Col>\n\n        {/* Year Filter */}\n        <Col xs={24} md={hideDepartmentFilter ? 6 : 4}>\n          <Select\n            placeholder=\"เลือกชั้นปี\"\n            onChange={(value) => onFilterChange(\"year\", value)}\n            allowClear\n            size=\"large\"\n            style={{ width: \"100%\" }}\n          >\n            {yearOptions.map((year) => (\n              <Option key={year} value={year}>\n                ปี {year}\n              </Option>\n            ))}\n          </Select>\n        </Col>\n\n        {/* Reset Button */}\n        <Col xs={24} md={hideDepartmentFilter ? 4 : 3}>\n          <Button\n            icon={<RotateCcw size={16} />}\n            onClick={onReset}\n            size=\"large\"\n            style={{\n              width: \"100%\",\n              backgroundColor: \"#0A894C\",\n              borderColor: \"#0A894C\",\n              color: \"#ffffff\",\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.backgroundColor = \"#086b3d\";\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.backgroundColor = \"#0A894C\";\n            }}\n          >\n            รีเซ็ต\n          </Button>\n        </Col>\n      </Row>\n    </div>\n  );\n};\n\nexport default SearchFilterBar;\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAHA;;;;AAKA,MAAM,EAAE,MAAM,EAAE,GAAG,+LAAM;AAEzB,MAAM,qBAAqB;IACvB;IACA;IACA;IACA;IACA;IACA;CACH;AAED,MAAM,gBAAgB;IAAC;IAAO;CAAM;AACpC,MAAM,eAAe;IAAC;IAAK;IAAK;IAAK;CAAI;AAEzC,MAAM,kBAAkB,CAAC,EACvB,QAAQ,EACR,cAAc,EACd,OAAO,EACP,uBAAuB,KAAK,EAC5B,oBAAoB,kBAAkB,EACtC,eAAe,aAAa,EAC5B,cAAc,YAAY,EAC3B;IAEC,qBACE,6LAAC;QACC,WAAU;QACV,OAAO;YACL,YAAY;YACZ,QAAQ;YACR,WAAW;QACb;kBAEA,cAAA,6LAAC,sLAAG;YAAC,QAAQ;gBAAC;gBAAI;aAAG;;8BAEnB,6LAAC,sLAAG;oBAAC,IAAI;oBAAI,IAAI;8BACf,cAAA,6LAAC,4LAAK;wBACJ,aAAY;wBACZ,sBAAQ,6LAAC,mNAAM;4BAAC,MAAM;4BAAI,OAAO;gCAAE,OAAO;4BAAU;;;;;;wBACpD,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wBACxC,MAAK;wBACL,OAAO;4BACL,aAAa;wBACf;;;;;;;;;;;gBAKH,CAAC,sCACA,6LAAC,sLAAG;oBAAC,IAAI;oBAAI,IAAI;8BACf,cAAA,6LAAC,+LAAM;wBACL,aAAY;wBACZ,UAAU,CAAC,QAAU,eAAe,cAAc;wBAClD,UAAU;wBACV,MAAK;wBACL,OAAO;4BAAE,OAAO;wBAAO;kCAEtB,kBAAkB,GAAG,CAAC,CAAC,qBACtB,6LAAC;gCAA6B,OAAO,KAAK,EAAE,IAAI;0CAC7C,KAAK,IAAI,IAAI;+BADH,KAAK,EAAE,IAAI;;;;;;;;;;;;;;;8BAShC,6LAAC,sLAAG;oBAAC,IAAI;oBAAI,IAAI,uBAAuB,IAAI;8BAC1C,cAAA,6LAAC,+LAAM;wBACL,aAAY;wBACZ,UAAU,CAAC,QAAU,eAAe,SAAS;wBAC7C,UAAU;wBACV,MAAK;wBACL,OAAO;4BAAE,OAAO;wBAAO;kCAEtB,aAAa,GAAG,CAAC,CAAC,sBACjB,6LAAC;gCAA+B,OAAO,MAAM,EAAE,IAAI;0CAChD,MAAM,IAAI,IAAI;+BADJ,MAAM,EAAE,IAAI;;;;;;;;;;;;;;;8BAQ/B,6LAAC,sLAAG;oBAAC,IAAI;oBAAI,IAAI,uBAAuB,IAAI;8BAC1C,cAAA,6LAAC,+LAAM;wBACL,aAAY;wBACZ,UAAU,CAAC,QAAU,eAAe,QAAQ;wBAC5C,UAAU;wBACV,MAAK;wBACL,OAAO;4BAAE,OAAO;wBAAO;kCAEtB,YAAY,GAAG,CAAC,CAAC,qBAChB,6LAAC;gCAAkB,OAAO;;oCAAM;oCAC1B;;+BADO;;;;;;;;;;;;;;;8BAQnB,6LAAC,sLAAG;oBAAC,IAAI;oBAAI,IAAI,uBAAuB,IAAI;8BAC1C,cAAA,6LAAC,+MAAM;wBACL,oBAAM,6LAAC,gOAAS;4BAAC,MAAM;;;;;;wBACvB,SAAS;wBACT,MAAK;wBACL,OAAO;4BACL,OAAO;4BACP,iBAAiB;4BACjB,aAAa;4BACb,OAAO;wBACT;wBACA,cAAc,CAAC;4BACb,EAAE,aAAa,CAAC,KAAK,CAAC,eAAe,GAAG;wBAC1C;wBACA,cAAc,CAAC;4BACb,EAAE,aAAa,CAAC,KAAK,CAAC,eAAe,GAAG;wBAC1C;kCACD;;;;;;;;;;;;;;;;;;;;;;AAOX;KA/GM;uCAiHS"}},
    {"offset": {"line": 1256, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/components/participation/StudentListModal.js"],"sourcesContent":["\"use client\";\n\nimport { Modal, Tabs, Table, Button, Tag, Avatar, Input } from \"antd\";\nimport { CheckCircle, XCircle, Clock, User } from \"lucide-react\";\nimport { useState } from \"react\";\n\nconst { TextArea } = Input;\n\nconst StudentListModal = ({ visible, onClose, activity, onApprove, onReject }) => {\n  const [selectedRowKeys, setSelectedRowKeys] = useState([]);\n  const [rejectModalVisible, setRejectModalVisible] = useState(false);\n  const [rejectReason, setRejectReason] = useState(\"\");\n  const [studentsToReject, setStudentsToReject] = useState([]);\n\n  // Process attendances data from activity\n  const getStudentsFromAttendances = () => {\n    if (!activity?.attendances) {\n      return { approved: [], pending: [], rejected: [] };\n    }\n\n    const approved = [];\n    const pending = [];\n    const rejected = [];\n\n    activity.attendances.forEach((attendance) => {\n      const student = {\n        ...attendance,\n        studentId: attendance.user?.studentCode || attendance.user?.studentId || \"-\",\n        name:\n          attendance.user?.fullname ||\n          `${attendance.user?.firstName || \"\"} ${attendance.user?.lastName || \"\"}`.trim() ||\n          \"Unknown\",\n        department: attendance.user?.department?.name || \"-\",\n        major: attendance.user?.major?.name || \"-\",\n        year: attendance.user?.level || \"-\",\n      };\n\n      if (attendance.status === \"APPROVED\" || attendance.status === \"COMPLETED\") {\n        approved.push(student);\n      } else if (attendance.status === \"APPLIED\") {\n        pending.push(student);\n      } else if ([\"REVISION_REQUIRED\", \"REJECTED\"].includes(attendance.status)) {\n        rejected.push(student);\n      }\n    });\n\n    return { approved, pending, rejected };\n  };\n\n  const students = getStudentsFromAttendances();\n\n  const handleBulkApprove = () => {\n    const selectedStudents = students.pending.filter((student) =>\n      selectedRowKeys.includes(student.id)\n    );\n    selectedStudents.forEach((student) => onApprove(student));\n    setSelectedRowKeys([]);\n  };\n\n  const handleRejectClick = (student = null) => {\n    if (student) {\n      setStudentsToReject([student]);\n    } else {\n      const selectedStudents = students.pending.filter((student) =>\n        selectedRowKeys.includes(student.id)\n      );\n      setStudentsToReject(selectedStudents);\n    }\n    setRejectModalVisible(true);\n  };\n\n  const handleConfirmReject = () => {\n    if (!rejectReason.trim()) {\n      alert(\"กรุณาระบุเหตุผลในการไม่อนุมัติ\");\n      return;\n    }\n    studentsToReject.forEach((student) => {\n      onReject({ ...student, rejectReason: rejectReason.trim() });\n    });\n    setRejectModalVisible(false);\n    setRejectReason(\"\");\n    setStudentsToReject([]);\n    setSelectedRowKeys([]);\n  };\n\n  const rowSelection = {\n    selectedRowKeys,\n    onChange: (selectedKeys) => {\n      setSelectedRowKeys(selectedKeys);\n    },\n  };\n\n  const columns = [\n    {\n      title: \"ลำดับ\",\n      dataIndex: \"index\",\n      key: \"index\",\n      width: 70,\n      align: \"center\",\n      render: (text, record, index) => index + 1,\n    },\n    {\n      title: \"นักศึกษา\",\n      dataIndex: \"name\",\n      key: \"name\",\n      render: (name, record) => (\n        <div className=\"flex items-center gap-2\">\n          <Avatar\n            size={32}\n            style={{ backgroundColor: \"#0A894C\" }}\n            icon={<User size={18} />}\n          />\n          <div>\n            <div className=\"font-medium\">{name}</div>\n            <div className=\"text-xs text-gray-500\">{record.studentId}</div>\n          </div>\n        </div>\n      ),\n    },\n    {\n      title: \"ภาควิชา\",\n      dataIndex: \"department\",\n      key: \"department\",\n      width: 180,\n    },\n    {\n      title: \"สาขา\",\n      dataIndex: \"major\",\n      key: \"major\",\n      width: 100,\n      align: \"center\",\n      render: (major) => (\n        <Tag color=\"#0A894C\" style={{ borderRadius: 8 }}>\n          {major}\n        </Tag>\n      ),\n    },\n    {\n      title: \"ชั้นปี\",\n      dataIndex: \"year\",\n      key: \"year\",\n      width: 80,\n      align: \"center\",\n      render: (year) => `ปี ${year}`,\n    },\n  ];\n\n  const approvedColumns = [...columns];\n\n  const pendingColumns = [\n    ...columns,\n    {\n      title: \"การจัดการ\",\n      key: \"action\",\n      width: 120,\n      align: \"center\",\n      render: (_, record) => (\n        <div className=\"flex gap-2 justify-center\">\n          <Button\n            size=\"small\"\n            danger\n            icon={<XCircle size={16} />}\n            onClick={() => handleRejectClick(record)}\n          >\n            ไม่อนุมัติ\n          </Button>\n        </div>\n      ),\n    },\n  ];\n\n  const rejectedColumns = [...columns];\n\n  const tabItems = [\n    {\n      key: \"approved\",\n      label: (\n        <span className=\"flex items-center gap-2\">\n          <CheckCircle size={16} />\n          อนุมัติแล้ว ({students.approved.length})\n        </span>\n      ),\n      children: (\n        <Table\n          columns={approvedColumns}\n          dataSource={students.approved}\n          rowKey=\"id\"\n          pagination={{ pageSize: 5 }}\n          scroll={{ x: 600 }}\n        />\n      ),\n    },\n    {\n      key: \"pending\",\n      label: (\n        <span className=\"flex items-center gap-2\">\n          <Clock size={16} />\n          รออนุมัติ ({students.pending.length})\n        </span>\n      ),\n      children: (\n        <div>\n          {selectedRowKeys.length > 0 && (\n            <div className=\"mb-4 flex gap-2\">\n              <Button\n                type=\"primary\"\n                icon={<CheckCircle size={16} />}\n                onClick={handleBulkApprove}\n                style={{\n                  backgroundColor: \"#0A894C\",\n                  borderColor: \"#0A894C\",\n                }}\n              >\n                อนุมัติที่เลือก ({selectedRowKeys.length})\n              </Button>\n              <Button\n                danger\n                icon={<XCircle size={16} />}\n                onClick={() => handleRejectClick()}\n              >\n                ไม่อนุมัติที่เลือก ({selectedRowKeys.length})\n              </Button>\n            </div>\n          )}\n          <Table\n            columns={pendingColumns}\n            dataSource={students.pending}\n            rowKey=\"id\"\n            rowSelection={rowSelection}\n            pagination={{ pageSize: 5 }}\n            scroll={{ x: 600 }}\n          />\n        </div>\n      ),\n    },\n    {\n      key: \"rejected\",\n      label: (\n        <span className=\"flex items-center gap-2\">\n          <XCircle size={16} />\n          ต้องแก้ไข ({students.rejected.length})\n        </span>\n      ),\n      children: (\n        <Table\n          columns={rejectedColumns}\n          dataSource={students.rejected}\n          rowKey=\"id\"\n          pagination={{ pageSize: 5 }}\n          scroll={{ x: 600 }}\n        />\n      ),\n    },\n  ];\n\n  return (\n    <Modal\n      title={\n        <div>\n          <h3 className=\"text-lg font-semibold\" style={{ color: \"#0A894C\" }}>\n            รายการนักศึกษา\n          </h3>\n          <p className=\"text-sm text-gray-500 mt-1\">\n            {activity?.name || activity?.activityName || \"กิจกรรม\"}\n          </p>\n        </div>\n      }\n      open={visible}\n      onCancel={onClose}\n      width={900}\n      footer={null}\n      styles={{\n        header: {\n          borderBottom: \"2px solid #0A894C\",\n          paddingBottom: 16,\n        },\n      }}\n    >\n      <Tabs\n        defaultActiveKey=\"approved\"\n        items={tabItems}\n        className=\"custom-tabs\"\n      />\n      <style jsx global>{`\n        .custom-tabs .ant-tabs-tab.ant-tabs-tab-active .ant-tabs-tab-btn {\n          color: #0A894C !important;\n        }\n        .custom-tabs .ant-tabs-ink-bar {\n          background: #0A894C !important;\n        }\n        .custom-tabs .ant-tabs-tab:hover {\n          color: #0A894C !important;\n        }\n      `}</style>\n\n      {/* Rejection Reason Modal */}\n      <Modal\n        title=\"เหตุผลในการไม่อนุมัติ\"\n        open={rejectModalVisible}\n        onCancel={() => {\n          setRejectModalVisible(false);\n          setRejectReason(\"\");\n          setStudentsToReject([]);\n        }}\n        onOk={handleConfirmReject}\n        okText=\"ยืนยัน\"\n        cancelText=\"ยกเลิก\"\n        okButtonProps={{\n          style: { backgroundColor: \"#f5222d\", borderColor: \"#f5222d\" },\n        }}\n      >\n        <div className=\"mb-4\">\n          <p className=\"text-gray-600 mb-2\">\n            นักศึกษาที่จะไม่อนุมัติ: {studentsToReject.map((s) => s.name).join(\", \")}\n          </p>\n          <TextArea\n            rows={4}\n            placeholder=\"กรุณาระบุเหตุผลในการไม่อนุมัติ...\"\n            value={rejectReason}\n            onChange={(e) => setRejectReason(e.target.value)}\n          />\n        </div>\n      </Modal>\n    </Modal>\n  );\n};\n\nexport default StudentListModal;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1800, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/services/compat.js"],"sourcesContent":["const ROLE_TO_USER_TYPE = {\n  STUDENT: \"student\",\n  TEACHER: \"teacher\",\n  DEPT_STAFF: \"admin\",\n  FACULTY_ADMIN: \"admin\",\n  SUPER_ADMIN: \"admin\",\n};\n\nconst ACTIVITY_STATUS_TO_API = {\n  planned: \"OPEN_REGISTRATION\",\n  inprogress: \"IN_PROGRESS\",\n  completed: \"CLOSED\",\n  cancelled: \"CANCELLED\",\n};\n\nconst LEGACY_ATTENDANCE_ACTION = {\n  APPLIED: \"request-revision\",\n  APPROVED: \"approve\",\n  REJECTED: \"request-revision\",\n  REVISION_REQUIRED: \"request-revision\",\n  CANCELLED: \"request-revision\",\n  NO_SHOW: \"request-revision\",\n  SUBMITTED: \"request-revision\",\n  COMPLETED: \"approve\",\n  joined: \"request-revision\",\n  accepted: \"approve\",\n  approved: \"approve\",\n  completed: \"approve\",\n  rejected: \"request-revision\",\n  uncompleted: \"request-revision\",\n  Inprogress: \"request-revision\",\n};\n\nfunction safeString(value) {\n  return value === null || value === undefined ? \"\" : String(value);\n}\n\nexport function splitFullName(fullname) {\n  const clean = safeString(fullname).trim();\n  if (!clean) {\n    return { firstName: \"User\", lastName: \"\" };\n  }\n  const parts = clean.split(/\\s+/);\n  const firstName = parts.shift() || \"User\";\n  const lastName = parts.join(\" \");\n  return { firstName, lastName };\n}\n\nexport function roleToUserType(role) {\n  return ROLE_TO_USER_TYPE[role] || \"student\";\n}\n\nexport function mapActivityStatusFromApi(status) {\n  return status || \"OPEN_REGISTRATION\";\n}\n\nexport function mapActivityStatusToApi(status) {\n  return ACTIVITY_STATUS_TO_API[status] || status || undefined;\n}\n\nexport function mapApplicationStatusFromApi(status) {\n  return status || \"APPLIED\";\n}\n\nexport function mapLegacyAttendanceAction(status) {\n  return LEGACY_ATTENDANCE_ACTION[status] || \"request-revision\";\n}\n\nexport function mapEvidenceTypeToTypeActivity(requiredEvidenceType) {\n  const mapping = {\n    PHOTO: { id: \"PHOTO\", name: \"ใช้รูปภาพ\" },\n    PDF: { id: \"PDF\", name: \"ใช้ PDF\" },\n    BOTH: { id: \"BOTH\", name: \"ทั่วไป\" },\n  };\n  return mapping[requiredEvidenceType] || mapping.BOTH;\n}\n\nfunction uniqueById(items) {\n  const map = new Map();\n  items.forEach((item) => {\n    if (item?.id) {\n      map.set(item.id, item);\n    }\n  });\n  return Array.from(map.values());\n}\n\nfunction normalizeTargetDepartments(activity) {\n  const targetDepartments = Array.isArray(activity?.targetDepartments)\n    ? activity.targetDepartments\n    : [];\n\n  const mappedTargets = targetDepartments\n    .map((item) => ({\n      departmentId: item?.departmentId || item?.department?.id || null,\n      department: item?.department || null,\n    }))\n    .filter((item) => item.departmentId);\n\n  if (mappedTargets.length > 0) {\n    return mappedTargets;\n  }\n\n  if (activity?.ownerDepartmentId || activity?.ownerDepartment?.id) {\n    return [\n      {\n        departmentId: activity.ownerDepartmentId || activity.ownerDepartment?.id,\n        department: activity.ownerDepartment || null,\n      },\n    ];\n  }\n\n  return [];\n}\n\nfunction normalizeTargetMajors(activity) {\n  const targetMajors = Array.isArray(activity?.targetMajors)\n    ? activity.targetMajors\n    : Array.isArray(activity?.majorJoins)\n      ? activity.majorJoins\n      : [];\n\n  return targetMajors\n    .map((item) => ({\n      majorId: item?.majorId || item?.major?.id || null,\n      major: item?.major || null,\n    }))\n    .filter((item) => item.majorId);\n}\n\nexport function normalizeUser(user) {\n  if (!user) return null;\n\n  const fullNameFromApi = [user.firstName, user.lastName].filter(Boolean).join(\" \").trim();\n  const fullname = user.fullname || fullNameFromApi || user.username || user.email || \"Unknown\";\n\n  const faculty =\n    user.faculty ||\n    user.studentProfile?.faculty ||\n    user.teacherProfile?.faculty ||\n    user.staffProfile?.faculty ||\n    null;\n\n  const department =\n    user.department ||\n    user.studentProfile?.department ||\n    user.teacherProfile?.department ||\n    user.staffProfile?.department ||\n    null;\n\n  const major = user.major || user.studentProfile?.major || null;\n\n  const studentCode = user.studentCode || user.studentProfile?.studentCode || null;\n  const classYear = user.classYear || user.studentProfile?.classYear || null;\n  const academicYear = user.academicYear || user.studentProfile?.academicYear || null;\n\n  return {\n    id: user.id,\n    role: user.role,\n    userType: roleToUserType(user.role),\n    username: user.username || null,\n    email: user.email || null,\n    fullname,\n    name: fullname,\n    firstName: user.firstName || splitFullName(fullname).firstName,\n    lastName: user.lastName || splitFullName(fullname).lastName,\n    phone: user.phone || null,\n    status: user.status || \"ACTIVE\",\n    studentId: studentCode,\n    studentCode,\n    classYear,\n    academicYear,\n    level: classYear,\n    facultyId:\n      user.facultyId ||\n      user.studentProfile?.facultyId ||\n      user.teacherProfile?.facultyId ||\n      user.staffProfile?.facultyId ||\n      faculty?.id ||\n      null,\n    faculty,\n    departmentId:\n      user.departmentId ||\n      user.studentProfile?.departmentId ||\n      user.teacherProfile?.departmentId ||\n      user.staffProfile?.departmentId ||\n      department?.id ||\n      null,\n    department,\n    majorId: user.majorId || user.studentProfile?.majorId || major?.id || null,\n    major,\n  };\n}\n\nexport function normalizeAttendance(application, activity = null) {\n  const normalizedUser = normalizeUser(application?.student || application?.user || null);\n\n  return {\n    id: application.id,\n    activityId: application.activityId || activity?.id || null,\n    userId: application.studentUserId || normalizedUser?.id || null,\n    status: mapApplicationStatusFromApi(application.status),\n    reason: application.remark || null,\n    createdAt: application.submittedAt || application.createdAt || null,\n    updatedAt: application.updatedAt || null,\n    user: normalizedUser,\n    activity,\n    attendanceId: application.id,\n  };\n}\n\nexport function normalizeActivity(activity) {\n  if (!activity) return null;\n\n  const applications = Array.isArray(activity?.applications) ? activity.applications : [];\n  const attendances = applications.map((item) => normalizeAttendance(item));\n\n  const peopleCount = applications.filter((item) =>\n    [\"APPLIED\", \"APPROVED\", \"REVISION_REQUIRED\"].includes(item.status),\n  ).length;\n\n  const typeActivity = activity.activityType\n    ? {\n        id: activity.activityType.id,\n        code: activity.activityType.code,\n        name: activity.activityType.name,\n      }\n    : activity.typeActivity\n      ? {\n          id: activity.typeActivity.id,\n          code: activity.typeActivity.code,\n          name: activity.typeActivity.name,\n        }\n    : mapEvidenceTypeToTypeActivity(activity.requiredEvidenceType);\n\n  const targetDepartments = normalizeTargetDepartments(activity);\n  const departments = uniqueById(\n    targetDepartments\n      .map((item) => item.department)\n      .filter((item) => item?.id),\n  );\n  const departmentIds = targetDepartments.map((item) => item.departmentId).filter(Boolean);\n  const department = departments[0] || activity.ownerDepartment || null;\n\n  const majorJoins = normalizeTargetMajors(activity);\n  const majors = uniqueById(majorJoins.map((item) => item.major).filter((item) => item?.id));\n  const majorIds = majorJoins.map((item) => item.majorId).filter(Boolean);\n\n  const normalizedAttendances = attendances.map((attendance) => ({\n    ...attendance,\n    activityId: attendance.activityId || activity.id,\n  }));\n\n  return {\n    id: activity.id,\n    name: activity.title,\n    title: activity.title,\n    description: activity.note || \"\",\n    note: activity.note || \"\",\n    location: activity.location,\n    address: activity.location,\n    hour: activity.hours,\n    hours: activity.hours,\n    activityHours: activity.hours,\n    maxPeopleCount: activity.capacity,\n    maxStudents: activity.capacity,\n    peopleCount,\n    startDate: activity.startAt,\n    endDate: activity.endAt,\n    date: activity.applyCloseAt,\n    startAt: activity.startAt,\n    endAt: activity.endAt,\n    applyOpen: activity.applyOpenAt,\n    applyClose: activity.applyCloseAt,\n    applyOpenAt: activity.applyOpenAt,\n    applyCloseAt: activity.applyCloseAt,\n    status: mapActivityStatusFromApi(activity.status),\n    departmentId: departmentIds[0] || activity.ownerDepartmentId || null,\n    departmentIds,\n    facultyId: activity.ownerFacultyId || null,\n    department,\n    departments,\n    faculty: activity.ownerFaculty || null,\n    activityType: activity.activityType || typeActivity,\n    typeActivity,\n    typeActivityId: activity.activityTypeId || typeActivity.id,\n    requiredEvidenceType: activity.requiredEvidenceType,\n    ownerScope: activity.ownerScope,\n    attendances: normalizedAttendances,\n    applications,\n    createdBy: activity.createdBy || null,\n    targetDepartments,\n    majorJoins,\n    targetMajors: majorJoins,\n    majorIds,\n    majors,\n    level: activity.level || null,\n    createdAt: activity.createdAt || null,\n    updatedAt: activity.updatedAt || null,\n    fileActivities: [],\n    remarks: activity.note || \"\",\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2077, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/services/activity.js"],"sourcesContent":["import apiClient from \"./apiClient\";\nimport { mapActivityStatusToApi, normalizeActivity } from \"./compat\";\n\nconst isFormData = (value) =>\n  typeof FormData !== \"undefined\" && value instanceof FormData;\n\nconst toIsoString = (value, fallback = null) => {\n  if (!value && fallback) return fallback;\n  if (!value) return null;\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return fallback;\n  return date.toISOString();\n};\n\nconst formDataToObject = (formData) => {\n  const data = {};\n  formData.forEach((value, key) => {\n    if (data[key] !== undefined) {\n      data[key] = Array.isArray(data[key])\n        ? [...data[key], value]\n        : [data[key], value];\n      return;\n    }\n    data[key] = value;\n  });\n  return data;\n};\n\nconst compact = (obj) =>\n  Object.fromEntries(\n    Object.entries(obj).filter(([, value]) => value !== undefined && value !== null),\n  );\n\nconst toArray = (value) => {\n  if (value === undefined || value === null || value === \"\") return [];\n  if (Array.isArray(value)) return value.filter(Boolean);\n  return [value];\n};\n\nconst normalizeIncomingPayload = (rawData) => {\n  const data = isFormData(rawData) ? formDataToObject(rawData) : { ...rawData };\n\n  const title = data.title || data.name || data.activityName;\n  const startAt =\n    toIsoString(data.startAt || data.startDate || data.date || data.activityDate) ||\n    toIsoString(new Date());\n  const endAt =\n    toIsoString(data.endAt || data.endDate || data.startDate || data.date) ||\n    toIsoString(new Date(Date.now() + 60 * 60 * 1000));\n\n  const applyOpenAt =\n    toIsoString(data.applyOpenAt || data.applyOpenDate || data.applyStart) ||\n    toIsoString(new Date());\n\n  const applyCloseAt =\n    toIsoString(data.applyCloseAt || data.activityDeadline || data.date || data.startDate) ||\n    startAt;\n\n  const departmentIds = toArray(data.departmentIds || data.departmentId || data.ownerDepartmentId);\n  const majorIds = toArray(data.majorIds);\n\n  return compact({\n    title,\n    startAt,\n    endAt,\n    location: data.location || data.address,\n    hours: Number(data.hours || data.hour || data.activityHours || 1),\n    requiredEvidenceType:\n      data.requiredEvidenceType || data.evidenceType || (data.pdfDocument ? \"PDF\" : \"BOTH\"),\n    activityTypeId: data.activityTypeId || data.typeActivityId || data.category,\n    capacity: Number(data.capacity || data.maxPeopleCount || data.maxStudents || 1),\n    applyOpenAt,\n    applyCloseAt,\n    note: data.note || data.description || data.remarks,\n    ownerScope: data.ownerScope || (departmentIds.length ? \"DEPARTMENT\" : \"FACULTY\"),\n    ownerFacultyId: data.ownerFacultyId || data.facultyId,\n    ownerDepartmentId: departmentIds[0] || null,\n    departmentIds,\n    majorIds,\n    status: mapActivityStatusToApi(data.status),\n  });\n};\n\nconst mapListQuery = (params = {}) => {\n  const mapped = {\n    scope: params.scope,\n    department: params.department || params.departmentId,\n    status: mapActivityStatusToApi(params.status),\n    dateFrom: params.dateFrom || params.from,\n    dateTo: params.dateTo || params.to,\n  };\n\n  return compact(mapped);\n};\n\nconst fetchActivityDetail = async (id) => {\n  const response = await apiClient.get(`/activities/${id}`);\n  return response.data;\n};\n\nconst enrichWithDetails = async (activities) => {\n  const detailed = await Promise.all(\n    activities.map(async (item) => {\n      try {\n        return await fetchActivityDetail(item.id);\n      } catch (_error) {\n        return item;\n      }\n    }),\n  );\n\n  return detailed;\n};\n\nexport const getAllActivities = async (params = {}) => {\n  const response = await apiClient.get(\"/activities\", {\n    params: mapListQuery(params),\n  });\n\n  const list = Array.isArray(response.data) ? response.data : [];\n  const detailed = params.includeDetails === false ? list : await enrichWithDetails(list);\n\n  return detailed.map(normalizeActivity);\n};\n\nexport const getActivitiesReport = async (params = {}) => {\n  return getAllActivities(params);\n};\n\nexport const getActivityById = async (id) => {\n  const response = await apiClient.get(`/activities/${id}`);\n  return normalizeActivity(response.data);\n};\n\nexport const createActivity = async (data) => {\n  const payload = normalizeIncomingPayload(data);\n  const response = await apiClient.post(\"/activities\", payload);\n  return normalizeActivity(response.data);\n};\n\nexport const updateActivity = async (id, data) => {\n  const payload = normalizeIncomingPayload(data);\n  const response = await apiClient.patch(`/activities/${id}`, payload);\n  return normalizeActivity(response.data);\n};\n\nexport const deleteActivity = async (id) => {\n  const response = await apiClient.delete(`/activities/${id}`);\n  return response.data;\n};\n\nexport const getActivitiesByResponsible = async (userId) => {\n  const activities = await getAllActivities({ includeDetails: false });\n  return activities.filter((activity) => activity.createdBy?.id === userId);\n};\n\nexport const getActivitiesWithQuery = async (queryParams = {}) => {\n  const activities = await getAllActivities({\n    departmentId: queryParams.departmentId,\n    status: queryParams.status,\n  });\n\n  return {\n    activities,\n    total: activities.length,\n  };\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2239, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/services/attendance.js"],"sourcesContent":["import { getActivityById, getAllActivities } from \"./activity\";\nimport apiClient from \"./apiClient\";\nimport {\n  mapApplicationStatusFromApi,\n  mapLegacyAttendanceAction,\n  normalizeAttendance,\n} from \"./compat\";\n\nconst flattenAttendances = (activities) =>\n  activities.flatMap((activity) =>\n    (activity.attendances || []).map((attendance) => ({\n      ...attendance,\n      activityId: attendance.activityId || activity.id,\n      activity,\n    })),\n  );\n\n// Get all attendances\nexport const getAllAttendances = async () => {\n  const activities = await getAllActivities();\n  return flattenAttendances(activities);\n};\n\n// Get attendance by ID\nexport const getAttendanceById = async (id) => {\n  const attendances = await getAllAttendances();\n  return attendances.find((attendance) => attendance.id === id) || null;\n};\n\n// Create new attendance\nexport const createAttendance = async (data) => {\n  const activityId = data.activityId;\n  if (!activityId) {\n    throw new Error(\"activityId is required\");\n  }\n\n  const response = await apiClient.post(`/activities/${activityId}/apply`);\n  return {\n    id: response.data.id,\n    activityId: response.data.activityId,\n    userId: response.data.studentUserId,\n    status: mapApplicationStatusFromApi(response.data.status),\n    reason: response.data.remark || null,\n    createdAt: response.data.submittedAt,\n    updatedAt: response.data.updatedAt,\n  };\n};\n\n// Update attendance\nexport const updateAttendance = async (id, data = {}) => {\n  const action = mapLegacyAttendanceAction(data.status);\n  const endpoint = action === \"approve\" ? \"approve\" : \"request-revision\";\n\n  const response = await apiClient.post(`/approvals/${id}/${endpoint}`, {\n    remark: data.remark || data.reason || data.rejectReason,\n  });\n\n  return normalizeAttendance(response.data);\n};\n\n// Delete attendance (compat)\nexport const deleteAttendance = async (_id) => {\n  return { success: true };\n};\n\n// Get attendances by user\nexport const getAttendancesByUser = async (userId) => {\n  const attendances = await getAllAttendances();\n  return attendances.filter(\n    (attendance) =>\n      attendance.userId === userId ||\n      attendance.user?.id === userId ||\n      attendance.user?.id === String(userId),\n  );\n};\n\n// Get attendances by activity\nexport const getAttendancesByActivity = async (activityId) => {\n  const activity = await getActivityById(activityId);\n\n  return (activity.attendances || []).map((attendance) => ({\n    ...attendance,\n    activityId,\n    activity,\n  }));\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAMA,MAAM,qBAAqB,CAAC,aAC1B,WAAW,OAAO,CAAC,CAAC,WAClB,CAAC,SAAS,WAAW,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,aAAe,CAAC;gBAChD,GAAG,UAAU;gBACb,YAAY,WAAW,UAAU,IAAI,SAAS,EAAE;gBAChD;YACF,CAAC;AAIE,MAAM,oBAAoB;IAC/B,MAAM,aAAa,MAAM,IAAA,kJAAgB;IACzC,OAAO,mBAAmB;AAC5B;AAGO,MAAM,oBAAoB,OAAO;IACtC,MAAM,cAAc,MAAM;IAC1B,OAAO,YAAY,IAAI,CAAC,CAAC,aAAe,WAAW,EAAE,KAAK,OAAO;AACnE;AAGO,MAAM,mBAAmB,OAAO;IACrC,MAAM,aAAa,KAAK,UAAU;IAClC,IAAI,CAAC,YAAY;QACf,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,WAAW,MAAM,0IAAS,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,WAAW,MAAM,CAAC;IACvE,OAAO;QACL,IAAI,SAAS,IAAI,CAAC,EAAE;QACpB,YAAY,SAAS,IAAI,CAAC,UAAU;QACpC,QAAQ,SAAS,IAAI,CAAC,aAAa;QACnC,QAAQ,IAAA,2JAA2B,EAAC,SAAS,IAAI,CAAC,MAAM;QACxD,QAAQ,SAAS,IAAI,CAAC,MAAM,IAAI;QAChC,WAAW,SAAS,IAAI,CAAC,WAAW;QACpC,WAAW,SAAS,IAAI,CAAC,SAAS;IACpC;AACF;AAGO,MAAM,mBAAmB,OAAO,IAAI,OAAO,CAAC,CAAC;IAClD,MAAM,SAAS,IAAA,yJAAyB,EAAC,KAAK,MAAM;IACpD,MAAM,WAAW,WAAW,YAAY,YAAY;IAEpD,MAAM,WAAW,MAAM,0IAAS,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,GAAG,CAAC,EAAE,UAAU,EAAE;QACpE,QAAQ,KAAK,MAAM,IAAI,KAAK,MAAM,IAAI,KAAK,YAAY;IACzD;IAEA,OAAO,IAAA,mJAAmB,EAAC,SAAS,IAAI;AAC1C;AAGO,MAAM,mBAAmB,OAAO;IACrC,OAAO;QAAE,SAAS;IAAK;AACzB;AAGO,MAAM,uBAAuB,OAAO;IACzC,MAAM,cAAc,MAAM;IAC1B,OAAO,YAAY,MAAM,CACvB,CAAC,aACC,WAAW,MAAM,KAAK,UACtB,WAAW,IAAI,EAAE,OAAO,UACxB,WAAW,IAAI,EAAE,OAAO,OAAO;AAErC;AAGO,MAAM,2BAA2B,OAAO;IAC7C,MAAM,WAAW,MAAM,IAAA,iJAAe,EAAC;IAEvC,OAAO,CAAC,SAAS,WAAW,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,aAAe,CAAC;YACvD,GAAG,UAAU;YACb;YACA;QACF,CAAC;AACH"}},
    {"offset": {"line": 2322, "column": 0}, "map": {"version":3,"sources":["file:///home/siripoom/tas/tas-front/src/app/teacher/participation/page.js"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { Card, Spin, Tabs, message } from \"antd\";\nimport { FileCheck, Users } from \"lucide-react\";\nimport EvidenceListModal from \"@/components/participation/EvidenceListModal\";\nimport ParticipationTable from \"@/components/participation/ParticipationTable\";\nimport SearchFilterBar from \"@/components/participation/SearchFilterBar\";\nimport StudentListModal from \"@/components/participation/StudentListModal\";\nimport { getAllActivities } from \"@/services/activity\";\nimport { updateAttendance } from \"@/services/attendance\";\nimport { getFilesByActivity } from \"@/services/file\";\nimport { getUserScope } from \"@/utils/sessionUser\";\n\nconst getActivityDepartments = (activity) => {\n  if (Array.isArray(activity?.departments) && activity.departments.length > 0) {\n    return activity.departments;\n  }\n  if (activity?.department?.id) {\n    return [activity.department];\n  }\n  return [];\n};\n\nconst isInDepartmentScope = (activity, departmentId) =>\n  getActivityDepartments(activity).some((department) => department?.id === departmentId);\n\nconst toFilesByAttendance = (files) => {\n  const map = {};\n  files.forEach((file) => {\n    const attendanceId = file?.ownerId;\n    if (!attendanceId) return;\n    if (!map[attendanceId]) {\n      map[attendanceId] = [];\n    }\n    map[attendanceId].push(file);\n  });\n  return map;\n};\n\nexport default function TeacherParticipationPage() {\n  const [activeTab, setActiveTab] = useState(\"participation\");\n  const [loading, setLoading] = useState(false);\n  const [evidenceLoading, setEvidenceLoading] = useState(false);\n  const [scope, setScope] = useState(null);\n  const [activities, setActivities] = useState([]);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filters, setFilters] = useState({\n    major: null,\n    year: null,\n  });\n\n  const [modalVisible, setModalVisible] = useState(false);\n  const [evidenceModalVisible, setEvidenceModalVisible] = useState(false);\n  const [selectedActivity, setSelectedActivity] = useState(null);\n  const [filesByAttendanceId, setFilesByAttendanceId] = useState({});\n\n  useEffect(() => {\n    setScope(getUserScope());\n  }, []);\n\n  const fetchActivities = async () => {\n    if (!scope?.departmentId) {\n      message.error(\"ไม่พบข้อมูลภาควิชาของผู้ใช้\");\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const data = await getAllActivities({ departmentId: scope.departmentId });\n      const list = Array.isArray(data) ? data : [];\n      setActivities(list.filter((activity) => isInDepartmentScope(activity, scope.departmentId)));\n    } catch (error) {\n      console.error(\"Error fetching participation activities:\", error);\n      message.error(\"ไม่สามารถโหลดข้อมูลได้\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchActivities();\n  }, [scope?.departmentId]);\n\n  const majorOptions = useMemo(() => {\n    const set = new Set();\n    activities.forEach((activity) => {\n      (activity.majorJoins || []).forEach((item) => {\n        if (item?.major?.name) {\n          set.add(item.major.name);\n        }\n      });\n    });\n    return Array.from(set);\n  }, [activities]);\n\n  const filteredActivities = useMemo(() => {\n    const query = searchQuery.trim().toLowerCase();\n    return activities.filter((activity) => {\n      if (query) {\n        const departmentName = activity.department?.name || \"\";\n        const name = activity.name || \"\";\n        const category = activity.typeActivity?.name || \"\";\n        const searchable = `${name} ${departmentName} ${category}`.toLowerCase();\n        if (!searchable.includes(query)) return false;\n      }\n\n      if (filters.major) {\n        const hasMajor = (activity.majorJoins || []).some(\n          (item) => item?.major?.name === filters.major,\n        );\n        if (!hasMajor) return false;\n      }\n\n      if (filters.year) {\n        const hasYear = (activity.attendances || []).some(\n          (attendance) => String(attendance?.user?.level || \"\") === String(filters.year),\n        );\n        if (!hasYear) return false;\n      }\n\n      return true;\n    });\n  }, [activities, searchQuery, filters]);\n\n  const handleOpenParticipation = (activity) => {\n    setSelectedActivity(activity);\n    setModalVisible(true);\n  };\n\n  const handleOpenEvidence = async (activity) => {\n    setSelectedActivity(activity);\n    setEvidenceModalVisible(true);\n    setEvidenceLoading(true);\n    try {\n      const files = await getFilesByActivity(activity.id);\n      setFilesByAttendanceId(toFilesByAttendance(Array.isArray(files) ? files : []));\n    } catch (error) {\n      console.error(\"Error fetching evidence files:\", error);\n      setFilesByAttendanceId({});\n      message.error(\"ไม่สามารถโหลดไฟล์หลักฐานได้\");\n    } finally {\n      setEvidenceLoading(false);\n    }\n  };\n\n  const handleApprove = async (attendance) => {\n    try {\n      await updateAttendance(attendance.id, { status: \"APPROVED\" });\n      message.success(\"อนุมัติการเข้าร่วมสำเร็จ\");\n      await fetchActivities();\n    } catch (error) {\n      console.error(\"Error approving attendance:\", error);\n      message.error(\"ไม่สามารถอนุมัติการเข้าร่วมได้\");\n    }\n  };\n\n  const handleReject = async (attendance) => {\n    try {\n      await updateAttendance(attendance.id, {\n        status: \"REVISION_REQUIRED\",\n        remark: attendance.rejectReason || undefined,\n      });\n      message.success(\"ส่งกลับแก้ไขสำเร็จ\");\n      await fetchActivities();\n    } catch (error) {\n      console.error(\"Error requesting revision:\", error);\n      message.error(\"ไม่สามารถส่งกลับแก้ไขได้\");\n    }\n  };\n\n  const tabItems = [\n    {\n      key: \"participation\",\n      label: (\n        <span className=\"flex items-center gap-2\">\n          <Users size={18} />\n          การเข้าร่วมกิจกรรม\n        </span>\n      ),\n      children: (\n        <div>\n          <SearchFilterBar\n            onSearch={setSearchQuery}\n            onFilterChange={(type, value) =>\n              setFilters((prev) => ({ ...prev, [type]: value }))\n            }\n            onReset={() => {\n              setSearchQuery(\"\");\n              setFilters({ major: null, year: null });\n            }}\n            hideDepartmentFilter\n            majorOptions={majorOptions}\n          />\n          <Card\n            style={{\n              borderRadius: 8,\n              border: \"1px solid #e8f5e9\",\n              boxShadow: \"0 2px 8px rgba(10, 137, 76, 0.08)\",\n            }}\n          >\n            <Spin spinning={loading}>\n              <ParticipationTable data={filteredActivities} onView={handleOpenParticipation} />\n            </Spin>\n          </Card>\n        </div>\n      ),\n    },\n    {\n      key: \"evidence\",\n      label: (\n        <span className=\"flex items-center gap-2\">\n          <FileCheck size={18} />\n          หลักฐานการเข้าร่วมกิจกรรม\n        </span>\n      ),\n      children: (\n        <div>\n          <SearchFilterBar\n            onSearch={setSearchQuery}\n            onFilterChange={(type, value) =>\n              setFilters((prev) => ({ ...prev, [type]: value }))\n            }\n            onReset={() => {\n              setSearchQuery(\"\");\n              setFilters({ major: null, year: null });\n            }}\n            hideDepartmentFilter\n            majorOptions={majorOptions}\n          />\n          <Card\n            style={{\n              borderRadius: 8,\n              border: \"1px solid #e8f5e9\",\n              boxShadow: \"0 2px 8px rgba(10, 137, 76, 0.08)\",\n            }}\n          >\n            <Spin spinning={loading}>\n              <ParticipationTable data={filteredActivities} onView={handleOpenEvidence} />\n            </Spin>\n          </Card>\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <Card\n        className=\"mb-6 shadow-sm\"\n        style={{\n          background: \"linear-gradient(135deg, #0A894C 0%, #0ea258 100%)\",\n          border: \"none\",\n        }}\n      >\n        <div className=\"text-white\">\n          <h2 className=\"text-2xl font-bold mb-2\">ภาควิชา {scope?.departmentName || \"-\"}</h2>\n          <p className=\"text-sm opacity-90\">\n            ตรวจสอบการเข้าร่วมกิจกรรมและหลักฐานของนักศึกษาในภาควิชา\n          </p>\n        </div>\n      </Card>\n\n      <Tabs activeKey={activeTab} onChange={setActiveTab} items={tabItems} size=\"large\" />\n\n      <StudentListModal\n        visible={modalVisible}\n        onClose={() => setModalVisible(false)}\n        activity={selectedActivity}\n        onApprove={handleApprove}\n        onReject={handleReject}\n      />\n\n      <EvidenceListModal\n        visible={evidenceModalVisible}\n        onClose={() => setEvidenceModalVisible(false)}\n        activity={selectedActivity}\n        onApprove={handleApprove}\n        onReject={handleReject}\n        filesByAttendanceId={filesByAttendanceId}\n        loading={evidenceLoading}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}