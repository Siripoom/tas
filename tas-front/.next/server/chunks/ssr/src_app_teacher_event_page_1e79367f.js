module.exports=[72741,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(49281),e=a.i(55565),f=a.i(63825),g=a.i(83772),h=a.i(27387),i=a.i(46764),j=a.i(27730),k=a.i(64831),l=a.i(71306),m=a.i(68186),n=a.i(72348),o=a.i(24569),p=a.i(77156),q=a.i(15618),r=a.i(87532),s=a.i(81560),t=a.i(8193),u=a.i(72838),v=a.i(42351),w=a.i(62719);let x=[{value:"OPEN_REGISTRATION",label:"เปิดรับสมัคร"},{value:"IN_PROGRESS",label:"กำลังดำเนินการ"},{value:"CLOSED",label:"ปิดกิจกรรม"},{value:"CANCELLED",label:"ยกเลิกกิจกรรม"}],y=[{value:"BOTH",label:"ทั่วไป (รูปภาพ/PDF)"},{value:"PHOTO",label:"รูปภาพเท่านั้น"},{value:"PDF",label:"PDF เท่านั้น"}],z=a=>a?Array.isArray(a)?a.filter(Boolean):[a]:[],A=a=>Array.isArray(a?.majorJoins)?a.majorJoins:Array.isArray(a?.targetMajors)?a.targetMajors:[],B=a=>{if(!a)return;let b=new Date(a);if(Number.isNaN(b.getTime()))return;let c=60*b.getTimezoneOffset()*1e3;return new Date(b.getTime()-c).toISOString().slice(0,16)},C=a=>{if(!a)return null;let b=new Date(a);return Number.isNaN(b.getTime())?null:b.toISOString()},D=a=>{if(!a)return"-";let b=new Date(a);return Number.isNaN(b.getTime())?"-":b.toLocaleString("th-TH")};function E(){let[a]=f.Form.useForm(),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(null),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(null);(0,c.useEffect)(()=>{F((0,w.getUserScope)())},[]);let aa=async()=>{if(!E?.departmentId)return void n.message.error("ไม่พบข้อมูลภาควิชาของผู้ใช้");H(!0);try{let[a,b,c]=await Promise.all([(0,t.getAllActivities)({departmentId:E.departmentId}),(0,v.getAllTypeActivities)(),(0,u.getMajorsByDepartment)(E.departmentId)]),d=Array.isArray(a)?a:[];L(d.filter(a=>{var b;return b=E.departmentId,(Array.isArray(a?.departments)&&a.departments.length>0?a.departments:a?.department?.id?[a.department]:[]).some(a=>a?.id===b)})),P(Array.isArray(b)?b:[]),N(Array.isArray(c)?c:[])}catch(a){console.error("Error fetching teacher events:",a),n.message.error("ไม่สามารถโหลดข้อมูลได้")}finally{H(!1)}};(0,c.useEffect)(()=>{aa()},[E?.departmentId]);let ab=(0,c.useMemo)(()=>{let a=Q.trim().toLowerCase();return K.filter(b=>(!a||!!`${b.name||""} ${b.typeActivity?.name||""}`.toLowerCase().includes(a))&&(!S||(b.typeActivity?.id||b.typeActivityId)===S))},[K,Q,S]),ac=(0,c.useMemo)(()=>({totalActivities:ab.length,totalHours:ab.reduce((a,b)=>a+Number(b.hour||b.hours||0),0)}),[ab]),ad=async a=>{try{await (0,t.deleteActivity)(a.id),n.message.success(`ลบกิจกรรม "${a.name||a.title}" สำเร็จ`),await aa()}catch(b){let a=b?.response?.data?.message||"ไม่สามารถลบกิจกรรมได้";n.message.error(a)}},ae=async b=>{var c;let d;if(!E?.departmentId)return void n.message.error("ไม่พบข้อมูลภาควิชาของผู้ใช้");let e={title:b.title,startAt:C(b.startAt),endAt:C(b.endAt),location:b.location,hours:Number(b.hours),requiredEvidenceType:b.requiredEvidenceType,activityTypeId:b.activityTypeId,capacity:Number(b.capacity),applyOpenAt:C(b.applyOpenAt),applyCloseAt:C(b.applyCloseAt),note:b.note||void 0,departmentIds:[E.departmentId],majorIds:(c=z(b.majorIds).map(a=>({id:a})),d=new Map,c.forEach(a=>{a?.id&&d.set(a.id,a)}),Array.from(d.values())).map(a=>a.id),status:b.status};J(!0);try{Y?(await (0,t.updateActivity)(Y.id,e),n.message.success("แก้ไขกิจกรรมสำเร็จ")):(await (0,t.createActivity)(e),n.message.success("เพิ่มกิจกรรมสำเร็จ")),V(!1),Z(null),a.resetFields(),await aa()}catch(b){let a=b?.response?.data?.message||"ไม่สามารถบันทึกกิจกรรมได้";n.message.error(a)}finally{J(!1)}},af=[{title:"ลำดับ",width:80,align:"center",render:(a,b,c)=>c+1},{title:"ชื่อกิจกรรม",dataIndex:"name",render:(a,b)=>a||b.title||"-"},{title:"ประเภท",width:200,render:(a,c)=>(0,b.jsx)(m.Tag,{color:"#0A894C",children:c.typeActivity?.name||"ไม่ระบุประเภท"})},{title:"ช่วงเวลา",width:260,render:(a,c)=>(0,b.jsxs)("span",{children:[D(c.startAt||c.startDate)," -"," ",D(c.endAt||c.endDate)]})},{title:"สาขาวิชา",width:260,render:(a,c)=>{let d=A(c);return 0===d.length?(0,b.jsx)("span",{className:"text-gray-500",children:"-"}):(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:d.map(a=>(0,b.jsxs)(m.Tag,{color:"#0A894C",children:[a.major?.code?`${a.major.code} - `:"",a.major?.name||a.majorId]},a.majorId))})}},{title:"สถานะ",width:160,render:(a,c)=>(0,b.jsx)(m.Tag,{color:"blue",children:x.find(a=>a.value===c.status)?.label||c.status})},{title:"จัดการ",width:140,align:"center",render:(c,e)=>(0,b.jsxs)("div",{className:"flex gap-1 justify-center",children:[(0,b.jsx)(d.Button,{type:"text",icon:(0,b.jsx)(p.Eye,{size:18}),onClick:()=>_(e)}),(0,b.jsx)(d.Button,{type:"text",icon:(0,b.jsx)(o.Edit,{size:18}),onClick:()=>{let b;return Z(e),void(a.setFieldsValue({title:e.title||e.name||"",location:e.location||"",hours:Number(e.hours||e.hour||1),capacity:Number(e.capacity||e.maxPeopleCount||1),activityTypeId:e.typeActivity?.id||e.typeActivityId,requiredEvidenceType:e.requiredEvidenceType||"BOTH",startAt:B(e.startAt||e.startDate),endAt:B(e.endAt||e.endDate),applyOpenAt:B(e.applyOpenAt||e.applyOpen),applyCloseAt:B(e.applyCloseAt||e.applyClose),status:e.status||"OPEN_REGISTRATION",note:e.note||e.description||"",majorIds:(b=z(e?.majorIds)).length>0?b:A(e).map(a=>a?.majorId||a?.major?.id).filter(Boolean)}),V(!0))}}),(0,b.jsx)(i.Popconfirm,{title:"ยืนยันการลบกิจกรรม",description:"ต้องการลบกิจกรรมนี้หรือไม่",onConfirm:()=>ad(e),okText:"ลบ",cancelText:"ยกเลิก",children:(0,b.jsx)(d.Button,{danger:!0,type:"text",icon:(0,b.jsx)(s.Trash2,{size:18})})})]})}];return(0,b.jsxs)("div",{children:[(0,b.jsx)(e.Card,{className:"mb-4 shadow-sm",style:{background:"linear-gradient(135deg, #0A894C 0%, #0ea258 100%)",border:"none"},children:(0,b.jsxs)("div",{className:"text-white",children:[(0,b.jsxs)("h2",{className:"text-xl font-bold mb-1",children:["ภาควิชา ",E?.departmentName||"-"]}),(0,b.jsx)("p",{className:"text-sm opacity-90",children:"จัดการกิจกรรมของภาควิชา"})]})}),(0,b.jsxs)("div",{className:"p-4 rounded-lg mb-4",style:{background:"#ffffff",border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-4",children:[(0,b.jsx)(g.Input,{placeholder:"ค้นหาจากชื่อกิจกรรม",prefix:(0,b.jsx)(r.Search,{size:16,style:{color:"#0A894C"}}),onChange:a=>R(a.target.value),value:Q,size:"large",style:{maxWidth:420,borderColor:"#0A894C"}}),(0,b.jsx)(d.Button,{type:"primary",icon:(0,b.jsx)(q.Plus,{size:18}),onClick:()=>{let b=new Date,c=new Date(b.getTime()+36e5),d=new Date(b.getTime()-72e5),e=new Date(b.getTime()-36e5);Z(null),a.resetFields(),a.setFieldsValue({title:"",location:"",hours:1,capacity:1,activityTypeId:void 0,requiredEvidenceType:"BOTH",startAt:B(b),endAt:B(c),applyOpenAt:B(d),applyCloseAt:B(e),status:"OPEN_REGISTRATION",note:"",majorIds:[]}),V(!0)},size:"large",style:{backgroundColor:"#0A894C",borderColor:"#0A894C"},children:"เพิ่มกิจกรรม"})]}),(0,b.jsx)("div",{className:"flex flex-wrap items-center gap-4",children:(0,b.jsx)(j.Select,{placeholder:"กรองตามประเภทกิจกรรม",allowClear:!0,value:S,onChange:T,style:{minWidth:300},children:O.map(a=>(0,b.jsx)(j.Select.Option,{value:a.id,children:a.name},a.id))})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,b.jsx)(e.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)",background:"linear-gradient(135deg, #0A894C 0%, #0ea258 100%)"},children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-white text-sm mb-1 opacity-90",children:"Total Activities"}),(0,b.jsx)("h2",{className:"text-white text-3xl font-bold",children:ac.totalActivities})]}),(0,b.jsx)("div",{className:"p-4 rounded-full",style:{backgroundColor:"rgba(255, 255, 255, 0.2)"},children:(0,b.jsx)(r.Search,{size:32,className:"text-white"})})]})}),(0,b.jsx)(e.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)",background:"linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)"},children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-white text-sm mb-1 opacity-90",children:"Total Activity Hours"}),(0,b.jsx)("h2",{className:"text-white text-3xl font-bold",children:ac.totalHours})]}),(0,b.jsx)("div",{className:"p-4 rounded-full",style:{backgroundColor:"rgba(255, 255, 255, 0.2)"},children:(0,b.jsx)(q.Plus,{size:32,className:"text-white"})})]})})]}),(0,b.jsx)(e.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:(0,b.jsx)(k.Spin,{spinning:G,children:(0,b.jsx)(l.Table,{columns:af,dataSource:ab,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:a=>`ทั้งหมด ${a} รายการ`},scroll:{x:1e3}})})}),(0,b.jsx)(h.Modal,{title:(0,b.jsx)("h3",{className:"text-lg font-semibold",style:{color:"#0A894C"},children:Y?"แก้ไขกิจกรรม":"เพิ่มกิจกรรม"}),open:U,onCancel:()=>{V(!1),Z(null),a.resetFields()},onOk:()=>a.submit(),okText:Y?"บันทึก":"เพิ่ม",cancelText:"ยกเลิก",confirmLoading:I,width:860,okButtonProps:{style:{backgroundColor:"#0A894C",borderColor:"#0A894C"}},children:(0,b.jsxs)(f.Form,{form:a,layout:"vertical",onFinish:ae,className:"mt-4",children:[(0,b.jsx)(f.Form.Item,{label:"ชื่อกิจกรรม",name:"title",rules:[{required:!0,message:"กรุณากรอกชื่อกิจกรรม"}],children:(0,b.jsx)(g.Input,{placeholder:"ชื่อกิจกรรม"})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(f.Form.Item,{label:"ประเภทกิจกรรม",name:"activityTypeId",rules:[{required:!0,message:"กรุณาเลือกประเภทกิจกรรม"}],children:(0,b.jsx)(j.Select,{placeholder:"เลือกประเภทกิจกรรม",children:O.map(a=>(0,b.jsx)(j.Select.Option,{value:a.id,children:a.name},a.id))})}),(0,b.jsx)(f.Form.Item,{label:"รูปแบบหลักฐาน",name:"requiredEvidenceType",rules:[{required:!0,message:"กรุณาเลือกรูปแบบหลักฐาน"}],children:(0,b.jsx)(j.Select,{options:y})})]}),(0,b.jsx)(f.Form.Item,{label:"สถานที่",name:"location",rules:[{required:!0,message:"กรุณากรอกสถานที่"}],children:(0,b.jsx)(g.Input,{placeholder:"สถานที่จัดกิจกรรม"})}),(0,b.jsx)(f.Form.Item,{label:"สาขาวิชา",name:"majorIds",rules:[{required:!0,message:"กรุณาเลือกสาขาวิชาอย่างน้อย 1 สาขา"}],children:(0,b.jsx)(j.Select,{mode:"multiple",placeholder:"เลือกสาขาวิชา",options:M.map(a=>({value:a.id,label:`${a.code} - ${a.name}`}))})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(f.Form.Item,{label:"วันที่เริ่มกิจกรรม",name:"startAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาเริ่มกิจกรรม"}],children:(0,b.jsx)(g.Input,{type:"datetime-local"})}),(0,b.jsx)(f.Form.Item,{label:"วันที่สิ้นสุดกิจกรรม",name:"endAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาสิ้นสุดกิจกรรม"}],children:(0,b.jsx)(g.Input,{type:"datetime-local"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(f.Form.Item,{label:"วันเวลาเริ่มรับสมัคร",name:"applyOpenAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาเริ่มรับสมัคร"}],children:(0,b.jsx)(g.Input,{type:"datetime-local"})}),(0,b.jsx)(f.Form.Item,{label:"วันเวลาปิดรับสมัคร",name:"applyCloseAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาปิดรับสมัคร"}],children:(0,b.jsx)(g.Input,{type:"datetime-local"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsx)(f.Form.Item,{label:"ชั่วโมงกิจกรรม",name:"hours",rules:[{required:!0,message:"กรุณากรอกชั่วโมงกิจกรรม"}],children:(0,b.jsx)(g.Input,{type:"number",min:1})}),(0,b.jsx)(f.Form.Item,{label:"จำนวนผู้เข้าร่วมสูงสุด",name:"capacity",rules:[{required:!0,message:"กรุณากรอกจำนวนผู้เข้าร่วมสูงสุด"}],children:(0,b.jsx)(g.Input,{type:"number",min:1})}),(0,b.jsx)(f.Form.Item,{label:"สถานะ",name:"status",rules:[{required:!0,message:"กรุณาเลือกสถานะ"}],children:(0,b.jsx)(j.Select,{options:x})})]}),(0,b.jsx)(f.Form.Item,{label:"หมายเหตุ",name:"note",children:(0,b.jsx)(g.Input.TextArea,{rows:3,placeholder:"รายละเอียดเพิ่มเติม"})})]})}),(0,b.jsx)(h.Modal,{title:(0,b.jsx)("h3",{className:"text-lg font-semibold",style:{color:"#0A894C"},children:"รายละเอียดกิจกรรม"}),open:W||!!$,onCancel:()=>{X(!1),_(null)},footer:[(0,b.jsx)(d.Button,{onClick:()=>{X(!1),_(null)},children:"ปิด"},"close")],width:760,children:$&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"ชื่อกิจกรรม:"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:$.name||$.title||"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"ประเภทกิจกรรม:"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:$.typeActivity?.name||"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"สถานที่:"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:$.location||"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"สาขาวิชา:"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:A($).length>0?A($).map(a=>(0,b.jsxs)(m.Tag,{color:"#0A894C",children:[a.major?.code?`${a.major.code} - `:"",a.major?.name||a.majorId]},a.majorId)):(0,b.jsx)("span",{className:"text-gray-500",children:"-"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"ช่วงเวลากิจกรรม:"}),(0,b.jsxs)("p",{className:"text-gray-600 mt-1",children:[D($.startAt||$.startDate)," -"," ",D($.endAt||$.endDate)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"ช่วงรับสมัคร:"}),(0,b.jsxs)("p",{className:"text-gray-600 mt-1",children:[D($.applyOpenAt||$.applyOpen)," -"," ",D($.applyCloseAt||$.applyClose)]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"ชั่วโมงกิจกรรม:"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:$.hour||$.hours||0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"จำนวนผู้เข้าร่วมสูงสุด:"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:$.maxPeopleCount||$.capacity||0})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"font-semibold text-gray-700",children:"หมายเหตุ:"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:$.note||$.description||"-"})]})]})})]})}a.s(["default",()=>E])}];

//# sourceMappingURL=src_app_teacher_event_page_1e79367f.js.map