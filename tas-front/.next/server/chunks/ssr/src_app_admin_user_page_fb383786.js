module.exports=[18836,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(49281),f=a.i(55565),g=a.i(63825),h=a.i(83772),i=a.i(27387),j=a.i(46764),k=a.i(27730),l=a.i(76130),m=a.i(64831),n=a.i(71306),o=a.i(77819),p=a.i(68186),q=a.i(72348),r=a.i(24569),s=a.i(77156),t=a.i(15618),u=a.i(87532),v=a.i(81560),w=a.i(60246),x=a.i(4363),y=a.i(72838);let z={STUDENT:"นักศึกษา",TEACHER:"อาจารย์",DEPT_STAFF:"เจ้าหน้าที่ภาควิชา",FACULTY_ADMIN:"เจ้าหน้าที่คณะ",SUPER_ADMIN:"SUPER_ADMIN"},A={student:["STUDENT"],deptStaff:["TEACHER","DEPT_STAFF"],adminStaff:["FACULTY_ADMIN","SUPER_ADMIN"]};function B(){let a=(0,d.useRouter)(),[B]=g.Form.useForm(),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)("student"),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(void 0),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(null),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)(!1),ae=g.Form.useWatch("role",B),af=g.Form.useWatch("facultyId",B),ag=g.Form.useWatch("departmentId",B),ah=ae||Y?.role||"STUDENT",ai=aa?.role==="FACULTY_ADMIN",aj=async()=>{D(!0);try{let a=await (0,x.getAllUsers)();H(Array.isArray(a)?a:[])}catch(a){q.message.error("ไม่สามารถโหลดข้อมูลผู้ใช้ได้"),console.error(a)}finally{D(!1)}},ak=async()=>{try{let[a,b]=await Promise.all([(0,y.getAllFaculties)(),(0,y.getAllDepartments)()]);J(Array.isArray(a)?a:[]),L(Array.isArray(b)?b:[])}catch(a){q.message.error("ไม่สามารถโหลดข้อมูลคณะ/ภาควิชาได้"),console.error(a)}};(0,c.useEffect)(()=>{let b=localStorage.getItem("user"),c=b?JSON.parse(b):null;if(ab(c),c?.role==="DEPT_STAFF"){ad(!0),q.message.error("คุณไม่มีสิทธิ์เข้าถึงเมนูจัดการผู้ใช้"),a.push("/admin/home");return}ak(),aj()},[a]),(0,c.useEffect)(()=>{if("STUDENT"!==ah||!ag){N([]),"STUDENT"!==ah&&B.setFieldValue("majorId",void 0);return}(async()=>{try{let a=await (0,y.getMajorsByDepartment)(ag);N(Array.isArray(a)?a:[])}catch(a){q.message.error("ไม่สามารถโหลดข้อมูลสาขาวิชาได้"),console.error(a)}})()},[ah,ag,B]),(0,c.useEffect)(()=>{!af||ag||(N([]),B.setFieldValue("majorId",void 0))},[af,ag,B]);let al=(0,c.useMemo)(()=>G.filter(a=>A[O].includes(a.role)),[G,O]),am=(0,c.useMemo)(()=>{let a=[...al];if(Q){let b=Q.toLowerCase();a=a.filter(a=>{let c=a.studentProfile?.studentCode||a.teacherProfile?.employeeCode||a.username||"";return`${a.firstName||""} ${a.lastName||""}`.toLowerCase().includes(b)||String(a.email||"").toLowerCase().includes(b)||String(c).toLowerCase().includes(b)})}return S&&(a=a.filter(a=>a.departmentId===S)),a},[al,Q,S]),an=(0,c.useMemo)(()=>af?K.filter(a=>a.facultyId===af):K,[K,af]),ao=(0,c.useMemo)(()=>"deptStaff"===O?[{value:"TEACHER",label:"อาจารย์"},{value:"DEPT_STAFF",label:"เจ้าหน้าที่ภาควิชา"}]:"adminStaff"===O?[{value:"FACULTY_ADMIN",label:"เจ้าหน้าที่คณะ"}]:[{value:"STUDENT",label:"นักศึกษา"}],[O]),ap=(0,c.useMemo)(()=>"deptStaff"===O?"TEACHER":"adminStaff"===O?"FACULTY_ADMIN":"STUDENT",[O]),aq=async a=>{if("SUPER_ADMIN"===a.role)return;Z(a);let b=a.role,c={role:b,status:a.status,username:a.username||void 0,email:a.email||void 0,firstName:a.firstName||"",lastName:a.lastName||"",phone:a.phone||void 0,facultyId:a.studentProfile?.facultyId||a.teacherProfile?.facultyId||a.staffProfile?.facultyId||void 0,departmentId:a.studentProfile?.departmentId||a.teacherProfile?.departmentId||a.staffProfile?.departmentId||void 0,studentCode:a.studentProfile?.studentCode||void 0,majorId:a.studentProfile?.majorId||void 0,classYear:a.studentProfile?.classYear||void 0,academicYear:a.studentProfile?.academicYear||void 0,employeeCode:a.teacherProfile?.employeeCode||void 0};if("STUDENT"===b&&c.departmentId)try{let a=await (0,y.getMajorsByDepartment)(c.departmentId);N(Array.isArray(a)?a:[])}catch(a){N([])}else N([]);B.setFieldsValue(c),V(!0)},ar=async a=>{try{await (0,x.deleteUser)(a.id),q.message.success("ลบผู้ใช้สำเร็จ"),await aj()}catch(b){let a=b?.response?.data?.message||"ไม่สามารถลบผู้ใช้ได้";q.message.error(a)}},as=async a=>{F(!0);try{let b,c,d=(c={role:b=a.role,username:a.username||void 0,email:a.email||void 0,password:a.password||void 0,firstName:a.firstName,lastName:a.lastName,phone:a.phone||void 0,status:a.status},"STUDENT"===b&&(c.studentProfile={studentCode:a.studentCode,facultyId:a.facultyId,departmentId:a.departmentId,majorId:a.majorId,classYear:Number(a.classYear),academicYear:Number(a.academicYear),registrarVerified:!0}),"TEACHER"===b&&(c.teacherProfile={employeeCode:a.employeeCode||void 0,facultyId:a.facultyId,departmentId:a.departmentId}),("DEPT_STAFF"===b||"FACULTY_ADMIN"===b)&&(c.staffProfile={staffType:"FACULTY_ADMIN"===b?"FACULTY_ADMIN":"DEPT_STAFF",facultyId:a.facultyId,departmentId:"FACULTY_ADMIN"===b?null:a.departmentId}),c);Y?(await (0,x.updateUser)(Y.id,d),q.message.success("แก้ไขผู้ใช้สำเร็จ")):(await (0,x.createUser)(d),q.message.success("เพิ่มผู้ใช้สำเร็จ")),V(!1),B.resetFields(),Z(null),await aj()}catch(b){let a=b?.response?.data?.message||"ไม่สามารถบันทึกข้อมูลผู้ใช้ได้";q.message.error(a),console.error(b)}finally{F(!1)}},at=[{title:"ลำดับ",width:80,render:(a,b,c)=>c+1},{title:"รหัส",width:170,render:(a,b)=>b.studentProfile?.studentCode||b.teacherProfile?.employeeCode||b.username||"-"},{title:"ชื่อ-นามสกุล",render:(a,b)=>`${b.firstName||""} ${b.lastName||""}`.trim()||"-"},{title:"บทบาท",width:180,render:(a,c)=>(0,b.jsx)(p.Tag,{color:"blue",children:z[c.role]||c.role})},{title:"คณะ",width:190,render:(a,b)=>b.studentProfile?.faculty?.name||b.teacherProfile?.faculty?.name||b.staffProfile?.faculty?.name||"-"},{title:"ภาควิชา",width:220,render:(a,b)=>b.studentProfile?.department?.name||b.teacherProfile?.department?.name||b.staffProfile?.department?.name||"-"},{title:"สถานะ",width:120,render:(a,c)=>{let d="ACTIVE"===c.status?"green":"LOCKED"===c.status?"red":"orange";return(0,b.jsx)(p.Tag,{color:d,children:c.status})}},{title:"จัดการ",width:160,render:(a,c)=>{let d="SUPER_ADMIN"===c.role;return(0,b.jsxs)(l.Space,{children:[(0,b.jsx)(e.Button,{type:"text",icon:(0,b.jsx)(s.Eye,{size:18}),onClick:()=>{_(c),X(!0)},title:"ดูรายละเอียด"}),!d&&(0,b.jsx)(e.Button,{type:"text",icon:(0,b.jsx)(r.Edit,{size:18}),onClick:()=>aq(c),title:"แก้ไข"}),!d&&(0,b.jsx)(j.Popconfirm,{title:"ยืนยันการลบผู้ใช้",description:"ต้องการลบผู้ใช้นี้หรือไม่",onConfirm:()=>ar(c),okText:"ลบ",cancelText:"ยกเลิก",children:(0,b.jsx)(e.Button,{danger:!0,type:"text",icon:(0,b.jsx)(v.Trash2,{size:18}),title:"ลบ"})})]})}}],au=[{key:"student",label:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Users,{size:16}),"นักศึกษา (",G.filter(a=>"STUDENT"===a.role).length,")"]})},{key:"deptStaff",label:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Users,{size:16}),"อาจารย์/เจ้าหน้าที่ภาควิชา (",G.filter(a=>["TEACHER","DEPT_STAFF"].includes(a.role)).length,")"]})},{key:"adminStaff",label:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Users,{size:16}),"แอดมิน/เจ้าหน้าที่คณะ (",G.filter(a=>["FACULTY_ADMIN","SUPER_ADMIN"].includes(a.role)).length,")"]})}];return ac?null:(0,b.jsx)(m.Spin,{spinning:C,children:(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Tabs,{activeKey:O,onChange:a=>{P(a),R(""),T(void 0)},items:au,className:"mb-4"}),(0,b.jsx)(f.Card,{className:"mb-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,b.jsx)("div",{className:"col-span-12 md:col-span-5",children:(0,b.jsx)(h.Input,{value:Q,onChange:a=>R(a.target.value),prefix:(0,b.jsx)(u.Search,{size:16}),placeholder:"ค้นหาจากชื่อ/อีเมล/รหัส"})}),(0,b.jsx)("div",{className:"col-span-12 md:col-span-4",children:(0,b.jsx)(k.Select,{value:S,onChange:T,allowClear:!0,placeholder:"กรองตามภาควิชา",options:K.map(a=>({label:a.name,value:a.id})),style:{width:"100%"}})}),(0,b.jsx)("div",{className:"col-span-12 md:col-span-3 flex justify-end",children:(0,b.jsx)(e.Button,{type:"primary",icon:(0,b.jsx)(t.Plus,{size:16}),onClick:()=>{Z(null),N([]),B.resetFields(),B.setFieldsValue({role:ap,status:"ACTIVE",facultyId:ai?aa?.facultyId:void 0,classYear:1,academicYear:2568}),V(!0)},style:{backgroundColor:"#0A894C",borderColor:"#0A894C"},children:"เพิ่มผู้ใช้"})})]})}),(0,b.jsx)(f.Card,{children:(0,b.jsx)(n.Table,{rowKey:"id",columns:at,dataSource:am,pagination:{pageSize:10,showSizeChanger:!0},scroll:{x:1100}})}),(0,b.jsx)(i.Modal,{title:Y?"แก้ไขผู้ใช้":"เพิ่มผู้ใช้",open:U,onCancel:()=>{V(!1),Z(null),N([]),B.resetFields()},onOk:()=>B.submit(),okText:Y?"บันทึก":"สร้าง",cancelText:"ยกเลิก",confirmLoading:E,width:760,children:(0,b.jsx)(g.Form,{form:B,layout:"vertical",onFinish:as,children:(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[!(!Y&&"deptStaff"===O)&&(0,b.jsx)(g.Form.Item,{name:"role",className:"col-span-12",hidden:!0,children:(0,b.jsx)(h.Input,{})}),!Y&&"deptStaff"===O&&(0,b.jsx)(g.Form.Item,{label:"ประเภทบัญชี",name:"role",className:"col-span-12",rules:[{required:!0,message:"กรุณาเลือกประเภทบัญชี"}],children:(0,b.jsx)(k.Select,{options:ao})}),Y&&(0,b.jsx)(g.Form.Item,{label:"บทบาท",className:"col-span-12",children:(0,b.jsx)(h.Input,{value:z[Y.role],disabled:!0})}),(0,b.jsx)(g.Form.Item,{label:"ชื่อ",name:"firstName",className:"col-span-12 md:col-span-6",rules:[{required:!0,message:"กรุณากรอกชื่อ"}],children:(0,b.jsx)(h.Input,{})}),(0,b.jsx)(g.Form.Item,{label:"นามสกุล",name:"lastName",className:"col-span-12 md:col-span-6",rules:[{required:!0,message:"กรุณากรอกนามสกุล"}],children:(0,b.jsx)(h.Input,{})}),(0,b.jsx)(g.Form.Item,{label:"Username",name:"username",className:"col-span-12 md:col-span-6",children:(0,b.jsx)(h.Input,{})}),(0,b.jsx)(g.Form.Item,{label:"Email",name:"email",className:"col-span-12 md:col-span-6",rules:[{type:"email",message:"รูปแบบอีเมลไม่ถูกต้อง"}],children:(0,b.jsx)(h.Input,{})}),(0,b.jsx)(g.Form.Item,{label:"เบอร์โทร",name:"phone",className:"col-span-12 md:col-span-6",children:(0,b.jsx)(h.Input,{})}),(0,b.jsx)(g.Form.Item,{label:Y?"รหัสผ่านใหม่ (ไม่บังคับ)":"รหัสผ่าน (ไม่กรอก = ChangeMe123!)",name:"password",className:"col-span-12 md:col-span-6",children:(0,b.jsx)(h.Input.Password,{})}),(0,b.jsx)(g.Form.Item,{label:"สถานะ",name:"status",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณาเลือกสถานะ"}],children:(0,b.jsx)(k.Select,{options:[{label:"ACTIVE",value:"ACTIVE"},{label:"INACTIVE",value:"INACTIVE"},{label:"LOCKED",value:"LOCKED"}]})}),(0,b.jsx)(g.Form.Item,{label:"คณะ",name:"facultyId",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณาเลือกคณะ"}],children:(0,b.jsx)(k.Select,{disabled:ai,options:I.map(a=>({label:a.name,value:a.id})),onChange:()=>{B.setFieldValue("departmentId",void 0),B.setFieldValue("majorId",void 0)}})}),("STUDENT"===ah||"TEACHER"===ah||"DEPT_STAFF"===ah)&&(0,b.jsx)(g.Form.Item,{label:"ภาควิชา",name:"departmentId",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณาเลือกภาควิชา"}],children:(0,b.jsx)(k.Select,{options:an.map(a=>({label:a.name,value:a.id})),onChange:()=>{B.setFieldValue("majorId",void 0)}})}),"STUDENT"===ah&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Form.Item,{label:"รหัสนักศึกษา",name:"studentCode",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณากรอกรหัสนักศึกษา"}],children:(0,b.jsx)(h.Input,{})}),(0,b.jsx)(g.Form.Item,{label:"สาขาวิชา",name:"majorId",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณาเลือกสาขาวิชา"}],children:(0,b.jsx)(k.Select,{options:M.map(a=>({label:a.code,value:a.id}))})}),(0,b.jsx)(g.Form.Item,{label:"ชั้นปี",name:"classYear",className:"col-span-12 md:col-span-2",rules:[{required:!0,message:"กรุณากรอกชั้นปี"}],children:(0,b.jsx)(h.Input,{type:"number",min:1})}),(0,b.jsx)(g.Form.Item,{label:"ปีการศึกษา",name:"academicYear",className:"col-span-12 md:col-span-2",rules:[{required:!0,message:"กรุณากรอกปีการศึกษา"}],children:(0,b.jsx)(h.Input,{type:"number",min:1})})]}),"TEACHER"===ah&&(0,b.jsx)(g.Form.Item,{label:"รหัสพนักงาน",name:"employeeCode",className:"col-span-12 md:col-span-4",children:(0,b.jsx)(h.Input,{})})]})})}),(0,b.jsx)(i.Modal,{title:"รายละเอียดผู้ใช้",open:W,onCancel:()=>X(!1),footer:null,width:640,children:$&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("b",{children:"ชื่อ:"})," ",`${$.firstName||""} ${$.lastName||""}`.trim()]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("b",{children:"บทบาท:"})," ",z[$.role]||$.role]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("b",{children:"Email:"})," ",$.email||"-"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("b",{children:"Username:"})," ",$.username||"-"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("b",{children:"คณะ:"})," ",$.studentProfile?.faculty?.name||$.teacherProfile?.faculty?.name||$.staffProfile?.faculty?.name||"-"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("b",{children:"ภาควิชา:"})," ",$.studentProfile?.department?.name||$.teacherProfile?.department?.name||$.staffProfile?.department?.name||"-"]})]})})]})})}a.s(["default",()=>B])}];

//# sourceMappingURL=src_app_admin_user_page_fb383786.js.map