(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,17851,e=>{"use strict";let t={STUDENT:"student",TEACHER:"teacher",DEPT_STAFF:"admin",FACULTY_ADMIN:"admin",SUPER_ADMIN:"admin"},a={planned:"OPEN_REGISTRATION",inprogress:"IN_PROGRESS",completed:"CLOSED",cancelled:"CANCELLED"},r={APPLIED:"request-revision",APPROVED:"approve",REJECTED:"request-revision",REVISION_REQUIRED:"request-revision",CANCELLED:"request-revision",NO_SHOW:"request-revision",SUBMITTED:"request-revision",COMPLETED:"approve",joined:"request-revision",accepted:"approve",approved:"approve",completed:"approve",rejected:"request-revision",uncompleted:"request-revision",Inprogress:"request-revision"};function i(e){let t=(null==e?"":String(e)).trim();if(!t)return{firstName:"User",lastName:""};let a=t.split(/\s+/);return{firstName:a.shift()||"User",lastName:a.join(" ")}}function n(e){return t[e]||"student"}function s(e){return a[e]||e||void 0}function l(e){return e||"APPLIED"}function d(e){return r[e]||"request-revision"}function o(e){let t=new Map;return e.forEach(e=>{e?.id&&t.set(e.id,e)}),Array.from(t.values())}function c(e){if(!e)return null;let t=[e.firstName,e.lastName].filter(Boolean).join(" ").trim(),a=e.fullname||t||e.username||e.email||"Unknown",r=e.faculty||e.studentProfile?.faculty||e.teacherProfile?.faculty||e.staffProfile?.faculty||null,s=e.department||e.studentProfile?.department||e.teacherProfile?.department||e.staffProfile?.department||null,l=e.major||e.studentProfile?.major||null,d=e.studentCode||e.studentProfile?.studentCode||null,o=e.classYear||e.studentProfile?.classYear||null,c=e.academicYear||e.studentProfile?.academicYear||null;return{id:e.id,role:e.role,userType:n(e.role),username:e.username||null,email:e.email||null,fullname:a,name:a,firstName:e.firstName||i(a).firstName,lastName:e.lastName||i(a).lastName,phone:e.phone||null,status:e.status||"ACTIVE",studentId:d,studentCode:d,classYear:o,academicYear:c,level:o,facultyId:e.facultyId||e.studentProfile?.facultyId||e.teacherProfile?.facultyId||e.staffProfile?.facultyId||r?.id||null,faculty:r,departmentId:e.departmentId||e.studentProfile?.departmentId||e.teacherProfile?.departmentId||e.staffProfile?.departmentId||s?.id||null,department:s,majorId:e.majorId||e.studentProfile?.majorId||l?.id||null,major:l}}function u(e,t=null){let a=c(e?.student||e?.user||null);return{id:e.id,activityId:e.activityId||t?.id||null,userId:e.studentUserId||a?.id||null,status:l(e.status),reason:e.remark||null,createdAt:e.submittedAt||e.createdAt||null,updatedAt:e.updatedAt||null,user:a,activity:t,attendanceId:e.id}}function p(e){var t;let a,r;if(!e)return null;let i=Array.isArray(e?.applications)?e.applications:[],n=i.map(e=>u(e)),s=i.filter(e=>["APPLIED","APPROVED","REVISION_REQUIRED"].includes(e.status)).length,l=e.activityType?{id:e.activityType.id,code:e.activityType.code,name:e.activityType.name}:e.typeActivity?{id:e.typeActivity.id,code:e.typeActivity.code,name:e.typeActivity.name}:(t=e.requiredEvidenceType,(a={PHOTO:{id:"PHOTO",name:"ใช้รูปภาพ"},PDF:{id:"PDF",name:"ใช้ PDF"},BOTH:{id:"BOTH",name:"ทั่วไป"}})[t]||a.BOTH),d=(r=(Array.isArray(e?.targetDepartments)?e.targetDepartments:[]).map(e=>({departmentId:e?.departmentId||e?.department?.id||null,department:e?.department||null})).filter(e=>e.departmentId)).length>0?r:e?.ownerDepartmentId||e?.ownerDepartment?.id?[{departmentId:e.ownerDepartmentId||e.ownerDepartment?.id,department:e.ownerDepartment||null}]:[],c=o(d.map(e=>e.department).filter(e=>e?.id)),p=d.map(e=>e.departmentId).filter(Boolean),m=c[0]||e.ownerDepartment||null,y=(Array.isArray(e?.targetMajors)?e.targetMajors:Array.isArray(e?.majorJoins)?e.majorJoins:[]).map(e=>({majorId:e?.majorId||e?.major?.id||null,major:e?.major||null})).filter(e=>e.majorId),f=o(y.map(e=>e.major).filter(e=>e?.id)),A=y.map(e=>e.majorId).filter(Boolean),v=n.map(t=>({...t,activityId:t.activityId||e.id}));return{id:e.id,name:e.title,title:e.title,description:e.note||"",note:e.note||"",location:e.location,address:e.location,hour:e.hours,hours:e.hours,activityHours:e.hours,maxPeopleCount:e.capacity,maxStudents:e.capacity,peopleCount:s,startDate:e.startAt,endDate:e.endAt,date:e.applyCloseAt,startAt:e.startAt,endAt:e.endAt,applyOpen:e.applyOpenAt,applyClose:e.applyCloseAt,applyOpenAt:e.applyOpenAt,applyCloseAt:e.applyCloseAt,status:e.status||"OPEN_REGISTRATION",departmentId:p[0]||e.ownerDepartmentId||null,departmentIds:p,facultyId:e.ownerFacultyId||null,department:m,departments:c,faculty:e.ownerFaculty||null,activityType:e.activityType||l,typeActivity:l,typeActivityId:e.activityTypeId||l.id,requiredEvidenceType:e.requiredEvidenceType,ownerScope:e.ownerScope,attendances:v,applications:i,createdBy:e.createdBy||null,targetDepartments:d,majorJoins:y,targetMajors:y,majorIds:A,majors:f,level:e.level||null,createdAt:e.createdAt||null,updatedAt:e.updatedAt||null,fileActivities:[],remarks:e.note||""}}e.s(["mapActivityStatusToApi",()=>s,"mapApplicationStatusFromApi",()=>l,"mapLegacyAttendanceAction",()=>d,"normalizeActivity",()=>p,"normalizeAttendance",()=>u,"normalizeUser",()=>c,"roleToUserType",()=>n])},38953,e=>{"use strict";e.i(47167);var t=e.i(71645);let a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"};var r=e.i(9583);function i(){return(i=Object.assign.bind()).apply(this,arguments)}let n=t.forwardRef((e,n)=>t.createElement(r.default,i({},e,{ref:n,icon:a})));e.s(["default",0,n],38953)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},90121,22611,e=>{"use strict";var t=e.i(71645);let a=e=>e&&"object"==typeof e?e:"boolean"==typeof e?{enabled:e,blur:e}:{};e.s(["useMergedMask",0,(e,r,i)=>(0,t.useMemo)(()=>{let t=a(e),n={...a(r),...t},s=!1!==n.blur?`${i}-mask-blur`:void 0;return[!1!==n.enabled,{mask:s}]},[e,r,i])],90121),e.i(63335);var r=e.i(80251);function i(){}let n=t.createContext({add:i,remove:i});function s(e){let a=t.useContext(n),i=t.useRef(null);return(0,r.useEvent)(t=>{if(t){let r=e?t.querySelector(e):t;r&&(a.add(r),i.current=r)}else a.remove(i.current)})}e.s(["usePanelRef",()=>s],22611)},96870,e=>{"use strict";var t=e.i(38243);e.s(["Space",()=>t.default])},48182,e=>{"use strict";var t=e.i(98961),a=e.i(2783),r=e.i(17851);let i=async()=>(await (0,t.getAllActivities)()).flatMap(e=>(e.attendances||[]).map(t=>({...t,activityId:t.activityId||e.id,activity:e}))),n=async e=>{let t=e.activityId;if(!t)throw Error("activityId is required");let i=await a.default.post(`/activities/${t}/apply`);return{id:i.data.id,activityId:i.data.activityId,userId:i.data.studentUserId,status:(0,r.mapApplicationStatusFromApi)(i.data.status),reason:i.data.remark||null,createdAt:i.data.submittedAt,updatedAt:i.data.updatedAt}},s=async(e,t={})=>{let i=(0,r.mapLegacyAttendanceAction)(t.status),n=await a.default.post(`/approvals/${e}/${"approve"===i?"approve":"request-revision"}`,{remark:t.remark||t.reason||t.rejectReason});return(0,r.normalizeAttendance)(n.data)},l=async e=>(await i()).filter(t=>t.userId===e||t.user?.id===e||t.user?.id===String(e)),d=async e=>{let a=await (0,t.getActivityById)(e);return(a.attendances||[]).map(t=>({...t,activityId:e,activity:a}))};e.s(["createAttendance",0,n,"getAllAttendances",0,i,"getAttendancesByActivity",0,d,"getAttendancesByUser",0,l,"updateAttendance",0,s])},24623,e=>{"use strict";var t=e.i(2783);let a=(e,t=null)=>({id:e.id,fileName:e.originalName||e.fileName||"file",fileType:e.fileType,ownerType:e.ownerType,ownerId:e.ownerId,mimeType:e.mimeType,sizeBytes:e.sizeBytes,uploadedAt:e.uploadedAt||e.createdAt,user:t,downloadUrl:`/files/${e.id}/download`}),r=async(e,r)=>{let i=await t.default.get("/files",{params:{ownerType:e,ownerId:r}});return Array.isArray(i.data)?i.data.map(e=>a(e)):[]},i=async(e,r)=>{let i=new FormData;return i.append("file",e),i.append("ownerType","APPLICATION"),i.append("ownerId",r),a((await t.default.post("/files/upload",i,{headers:{"Content-Type":"multipart/form-data"}})).data)},n=async e=>(await t.default.get(`/files/${e}/download`,{responseType:"blob"})).data,s=async e=>{let a=(await t.default.get(`/activities/${e}`)).data,i=Array.isArray(a.applications)?a.applications:[];return(await Promise.all(i.map(async e=>(await r("APPLICATION",e.id)).map(t=>({...t,user:e.student||null}))))).flat()},l=async e=>r("APPLICATION",e);e.s(["downloadFile",0,n,"getFilesByActivity",0,s,"getFilesByApplication",0,l,"uploadFileAttendance",0,i])},46897,e=>{"use strict";let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},40160,e=>{"use strict";let t=(0,e.i(75254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],40160)},20571,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(47437),i=e.i(64571),n=e.i(75712),s=e.i(11451),l=e.i(12931),d=e.i(96870),o=e.i(82725),c=e.i(91542),u=e.i(62218),p=e.i(98573),m=e.i(87316),y=e.i(40160),f=e.i(78583),A=e.i(46897),v=e.i(55436),h=e.i(84614),I=e.i(98961),g=e.i(48182),x=e.i(24623),w=e.i(2783);let j=async()=>(await w.default.get("/reports/department.xlsx",{responseType:"blob"})).data;var C=e.i(75312);let{Search:T}=s.Input,N=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":t.toLocaleDateString("th-TH")},P=(e,t)=>{let a=window.URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)};function E(){let[e,s]=(0,a.useState)(null),[w,E]=(0,a.useState)(!1),[b,D]=(0,a.useState)(!1),[S,O]=(0,a.useState)(!1),[R,k]=(0,a.useState)(""),[B,z]=(0,a.useState)(!1),[L,M]=(0,a.useState)(null),[U,q]=(0,a.useState)([]),[F,$]=(0,a.useState)([]),[H,_]=(0,a.useState)({});(0,a.useEffect)(()=>{s((0,C.getUserScope)())},[]);let Y=async()=>{if(!e?.departmentId)return void p.message.error("ไม่พบข้อมูลภาควิชาของผู้ใช้");E(!0);try{let t=await (0,I.getAllActivities)({departmentId:e.departmentId}),a=Array.isArray(t)?t:[];q(a.filter(t=>{var a;return a=e.departmentId,(Array.isArray(t?.departments)&&t.departments.length>0?t.departments:t?.department?.id?[t.department]:[]).some(e=>e?.id===a)}))}catch(e){console.error("Error fetching report activities:",e),p.message.error("ไม่สามารถโหลดกิจกรรมได้")}finally{E(!1)}};(0,a.useEffect)(()=>{Y()},[e?.departmentId]);let V=(0,a.useMemo)(()=>U.map(t=>({id:t.id,activityName:t.name||t.title||"-",department:t.department?.name||e?.departmentName||"-",major:t.typeActivity?.name||"ไม่ระบุ",startDate:N(t.startDate||t.startAt),endDate:N(t.endDate||t.endAt),location:t.location||t.address||"-",activityHours:Number(t.hour||t.hours||0),studentCount:(t.attendances||[]).length,rawActivity:t})),[U,e?.departmentName]),K=(0,a.useMemo)(()=>{let e=R.trim().toLowerCase();return e?V.filter(t=>`${t.activityName} ${t.department} ${t.major}`.toLowerCase().includes(e)):V},[V,R]),G=async e=>{D(!0);try{let[t,a]=await Promise.all([(0,g.getAttendancesByActivity)(e),(0,x.getFilesByActivity)(e)]),r=Array.isArray(t)?t:[],i=Array.isArray(a)?a:[],n={};i.forEach(e=>{let t=e?.user?.id;t&&(n[t]||(n[t]=[]),n[t].push(e))}),_(n),$(r.map(e=>({id:e.id,studentCode:e.user?.studentCode||e.user?.studentId||"-",name:e.user?.fullname||"-",department:e.user?.department?.name||"-",major:e.user?.major?.name||"-",classYear:e.user?.classYear||e.user?.level||"-",participationDate:N(e.createdAt),status:e.status,userId:e.user?.id||null})))}catch(e){console.error("Error fetching students for activity:",e),p.message.error("ไม่สามารถโหลดข้อมูลนักศึกษาได้")}finally{D(!1)}},J=async e=>{M(e),z(!0),await G(e.id)},Q=async e=>{let t=H[e.userId]||[];if(!t.length)return void p.message.warning("ไม่พบไฟล์หลักฐานสำหรับนักศึกษานี้");try{for(let a of t){let t=await (0,x.downloadFile)(a.id);P(t,a.fileName||`evidence_${e.studentCode}_${a.id}`)}p.message.success(`ดาวน์โหลดไฟล์ ${t.length} ไฟล์สำเร็จ`)}catch(e){console.error("Error downloading evidence files:",e),p.message.error("ไม่สามารถดาวน์โหลดไฟล์ได้")}},W=async()=>{O(!0);try{let e=await j();P(e,"department-report.xlsx"),p.message.success("ดาวน์โหลดรายงานสำเร็จ")}catch(e){console.error("Error exporting department report:",e),p.message.error("ไม่สามารถดาวน์โหลดรายงานได้")}finally{O(!1)}},X=[{title:"ลำดับ",width:70,align:"center",render:(e,t,a)=>a+1},{title:"รายการกิจกรรม",dataIndex:"activityName",render:e=>(0,t.jsxs)("div",{className:"font-medium",style:{color:"#0A894C"},children:[(0,t.jsx)(f.FileText,{size:16,className:"inline mr-2"}),e]})},{title:"ภาควิชา",dataIndex:"department",width:180},{title:"ประเภทกิจกรรม",dataIndex:"major",width:160,render:e=>(0,t.jsx)(u.Tag,{color:"#0A894C",children:e})},{title:"ช่วงวันที่",width:180,render:(e,a)=>(0,t.jsxs)("span",{children:[a.startDate," - ",a.endDate]})},{title:"จำนวนนักศึกษา",dataIndex:"studentCount",width:120,align:"center",render:e=>(0,t.jsx)(u.Tag,{color:"#1890ff",children:e})},{title:"",width:160,align:"center",render:(e,a)=>(0,t.jsx)(i.Button,{type:"primary",size:"small",onClick:()=>J(a),style:{backgroundColor:"#0A894C",borderColor:"#0A894C"},children:"ดูรายชื่อนักศึกษา"})}],Z=[{title:"ลำดับ",width:70,align:"center",render:(e,t,a)=>a+1},{title:"นักศึกษา",dataIndex:"name",render:(e,a)=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.Avatar,{size:32,style:{backgroundColor:"#0A894C"},icon:(0,t.jsx)(h.User,{size:16})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:a.studentCode})]})]})},{title:"ภาควิชา",dataIndex:"department",width:150},{title:"สาขา",dataIndex:"major",width:120},{title:"ชั้นปี",dataIndex:"classYear",width:90,align:"center",render:e=>"-"===e?"-":`ปี ${e}`},{title:"วันที่เข้าร่วม",dataIndex:"participationDate",width:120,align:"center"},{title:"สถานะ",dataIndex:"status",width:160,align:"center",render:e=>(0,t.jsx)(u.Tag,{color:["APPROVED","COMPLETED"].includes(e)?"green":"orange",children:e})},{title:"หลักฐาน",width:160,align:"center",render:(e,a)=>(0,t.jsx)(i.Button,{size:"small",icon:(0,t.jsx)(y.Download,{size:14}),onClick:()=>Q(a),style:{backgroundColor:"#1890ff",borderColor:"#1890ff",color:"#ffffff"},children:"ดาวน์โหลด"})}];return(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Card,{className:"mb-6 shadow-sm",style:{background:"linear-gradient(135deg, #0A894C 0%, #0ea258 100%)",border:"none"},children:(0,t.jsxs)("div",{className:"text-white",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["ภาควิชา ",e?.departmentName||"-"]}),(0,t.jsx)("p",{className:"text-sm opacity-90",children:"รายงานกิจกรรมและการเข้าร่วมของนักศึกษาในภาควิชา"})]})}),(0,t.jsxs)("div",{className:"mb-4 flex flex-wrap gap-3 items-center justify-between",children:[(0,t.jsx)(T,{placeholder:"ค้นหาจากชื่อกิจกรรม/ภาควิชา/ประเภทกิจกรรม",allowClear:!0,size:"large",value:R,onChange:e=>k(e.target.value),onSearch:k,enterButton:(0,t.jsx)(i.Button,{type:"primary",icon:(0,t.jsx)(v.Search,{size:16}),style:{backgroundColor:"#0A894C",borderColor:"#0A894C"},children:"ค้นหา"}),style:{maxWidth:640}}),(0,t.jsx)(i.Button,{type:"primary",icon:(0,t.jsx)(y.Download,{size:16}),loading:S,onClick:W,style:{backgroundColor:"#0A894C",borderColor:"#0A894C"},children:"Export รายงานภาควิชา"})]}),(0,t.jsx)(n.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:(0,t.jsx)(o.Spin,{spinning:w,children:(0,t.jsx)(c.Table,{columns:X,dataSource:K,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`ทั้งหมด ${e} รายการ`},scroll:{x:1e3}})})}),(0,t.jsx)(l.Modal,{title:(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",style:{color:"#0A894C"},children:"รายชื่อนักศึกษา"}),L&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,t.jsx)("div",{className:"font-medium text-base mb-1",children:L.activityName}),(0,t.jsxs)(d.Space,{size:12,wrap:!0,children:[(0,t.jsxs)("span",{children:[(0,t.jsx)(A.MapPin,{size:14,className:"inline mr-1"}),L.location]}),(0,t.jsxs)("span",{children:[(0,t.jsx)(m.Calendar,{size:14,className:"inline mr-1"}),L.startDate," - ",L.endDate]})]})]})]}),open:B,onCancel:()=>z(!1),width:1200,footer:null,children:(0,t.jsx)(o.Spin,{spinning:b,children:(0,t.jsx)(c.Table,{columns:Z,dataSource:F,rowKey:"id",pagination:{pageSize:10},scroll:{x:1100}})})})]})}e.s(["default",()=>E],20571)}]);