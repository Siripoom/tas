(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},90121,22611,e=>{"use strict";var t=e.i(71645);let a=e=>e&&"object"==typeof e?e:"boolean"==typeof e?{enabled:e,blur:e}:{};e.s(["useMergedMask",0,(e,r,l)=>(0,t.useMemo)(()=>{let t=a(e),s={...a(r),...t},i=!1!==s.blur?`${l}-mask-blur`:void 0;return[!1!==s.enabled,{mask:i}]},[e,r,l])],90121),e.i(63335);var r=e.i(80251);function l(){}let s=t.createContext({add:l,remove:l});function i(e){let a=t.useContext(s),l=t.useRef(null);return(0,r.useEvent)(t=>{if(t){let r=e?t.querySelector(e):t;r&&(a.add(r),l.current=r)}else a.remove(l.current)})}e.s(["usePanelRef",()=>i],22611)},96870,e=>{"use strict";var t=e.i(38243);e.s(["Space",()=>t.default])},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},39874,e=>{"use strict";var t=e.i(8206);function a(e,a){let r=[void 0,void 0],l=Array.isArray(e)?e:[e,void 0],s=a||{xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0};return l.forEach((e,a)=>{if("object"==typeof e&&null!==e)for(let l=0;l<t.responsiveArray.length;l++){let i=t.responsiveArray[l];if(s[i]&&void 0!==e[i]){r[a]=e[i];break}}else r[a]=e}),r}e.s(["default",()=>a])},59442,e=>{"use strict";let t=(0,e.i(71645).createContext)({});e.s(["default",0,t])},64042,e=>{"use strict";e.i(47167);var t=e.i(71645),a=e.i(7670),r=e.i(8206),l=e.i(42064),s=e.i(50073),i=e.i(39874),n=e.i(59442),d=e.i(56570);function o(e,a){let[l,s]=t.useState("string"==typeof e?e:"");return t.useEffect(()=>{(()=>{if("string"==typeof e&&s(e),"object"==typeof e)for(let t=0;t<r.responsiveArray.length;t++){let l=r.responsiveArray[t];if(!a||!a[l])continue;let i=e[l];if(void 0!==i)return void s(i)}})()},[JSON.stringify(e),a]),l}let c=t.forwardRef((e,r)=>{let{prefixCls:c,justify:u,align:m,className:p,style:y,children:f,gutter:x=0,wrap:v,...h}=e,{getPrefixCls:g,direction:j}=t.useContext(l.ConfigContext),A=(0,s.default)(!0,null),I=o(m,A),C=o(u,A),N=g("row",c),[w,T]=(0,d.useRowStyle)(N),E=(0,i.default)(x,A),S=(0,a.clsx)(N,{[`${N}-no-wrap`]:!1===v,[`${N}-${C}`]:C,[`${N}-${I}`]:I,[`${N}-rtl`]:"rtl"===j},p,w,T),$={};E?.[0]&&($.marginInline="number"==typeof E[0]?`${-(E[0]/2)}px`:`calc(${E[0]} / -2)`);let[b,P]=E;$.rowGap=P;let O=t.useMemo(()=>({gutter:[b,P],wrap:v}),[b,P,v]);return t.createElement(n.default.Provider,{value:O},t.createElement("div",{...h,className:S,style:{...$,...y},ref:r},f))});e.s(["Row",0,c],64042)},31757,e=>{"use strict";var t=e.i(71645),a=e.i(7670),r=e.i(42064),l=e.i(59442),s=e.i(56570);function i(e){return"auto"===e?"1 1 auto":"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let n=["xs","sm","md","lg","xl","xxl"],d=t.forwardRef((e,d)=>{let{getPrefixCls:o,direction:c}=t.useContext(r.ConfigContext),{gutter:u,wrap:m}=t.useContext(l.default),{prefixCls:p,span:y,order:f,offset:x,push:v,pull:h,className:g,children:j,flex:A,style:I,...C}=e,N=o("col",p),[w,T]=(0,s.useColStyle)(N),E={},S={};n.forEach(t=>{let a={},r=e[t];"number"==typeof r?a.span=r:"object"==typeof r&&(a=r||{}),delete C[t],S={...S,[`${N}-${t}-${a.span}`]:void 0!==a.span,[`${N}-${t}-order-${a.order}`]:a.order||0===a.order,[`${N}-${t}-offset-${a.offset}`]:a.offset||0===a.offset,[`${N}-${t}-push-${a.push}`]:a.push||0===a.push,[`${N}-${t}-pull-${a.pull}`]:a.pull||0===a.pull,[`${N}-rtl`]:"rtl"===c},a.flex&&(S[`${N}-${t}-flex`]=!0,E[`--${N}-${t}-flex`]=i(a.flex))});let $=(0,a.clsx)(N,{[`${N}-${y}`]:void 0!==y,[`${N}-order-${f}`]:f,[`${N}-offset-${x}`]:x,[`${N}-push-${v}`]:v,[`${N}-pull-${h}`]:h},g,S,w,T),b={};return u?.[0]&&(b.paddingInline="number"==typeof u[0]?`${u[0]/2}px`:`calc(${u[0]} / 2)`),A&&(b.flex=i(A),!1!==m||b.minWidth||(b.minWidth=0)),t.createElement("div",{...C,style:{...b,...I,...E},className:$,ref:d},j)});e.s(["default",0,d])},17851,e=>{"use strict";let t={STUDENT:"student",TEACHER:"teacher",DEPT_STAFF:"admin",FACULTY_ADMIN:"admin",SUPER_ADMIN:"admin"},a={planned:"OPEN_REGISTRATION",inprogress:"IN_PROGRESS",completed:"CLOSED",cancelled:"CANCELLED"},r={APPLIED:"request-revision",APPROVED:"approve",REJECTED:"request-revision",REVISION_REQUIRED:"request-revision",CANCELLED:"request-revision",NO_SHOW:"request-revision",SUBMITTED:"request-revision",COMPLETED:"approve",joined:"request-revision",accepted:"approve",approved:"approve",completed:"approve",rejected:"request-revision",uncompleted:"request-revision",Inprogress:"request-revision"};function l(e){let t=(null==e?"":String(e)).trim();if(!t)return{firstName:"User",lastName:""};let a=t.split(/\s+/);return{firstName:a.shift()||"User",lastName:a.join(" ")}}function s(e){return t[e]||"student"}function i(e){return a[e]||e||void 0}function n(e){return e||"APPLIED"}function d(e){return r[e]||"request-revision"}function o(e){let t=new Map;return e.forEach(e=>{e?.id&&t.set(e.id,e)}),Array.from(t.values())}function c(e){if(!e)return null;let t=[e.firstName,e.lastName].filter(Boolean).join(" ").trim(),a=e.fullname||t||e.username||e.email||"Unknown",r=e.faculty||e.studentProfile?.faculty||e.teacherProfile?.faculty||e.staffProfile?.faculty||null,i=e.department||e.studentProfile?.department||e.teacherProfile?.department||e.staffProfile?.department||null,n=e.major||e.studentProfile?.major||null,d=e.studentCode||e.studentProfile?.studentCode||null,o=e.classYear||e.studentProfile?.classYear||null,c=e.academicYear||e.studentProfile?.academicYear||null;return{id:e.id,role:e.role,userType:s(e.role),username:e.username||null,email:e.email||null,fullname:a,name:a,firstName:e.firstName||l(a).firstName,lastName:e.lastName||l(a).lastName,phone:e.phone||null,status:e.status||"ACTIVE",studentId:d,studentCode:d,classYear:o,academicYear:c,level:o,facultyId:e.facultyId||e.studentProfile?.facultyId||e.teacherProfile?.facultyId||e.staffProfile?.facultyId||r?.id||null,faculty:r,departmentId:e.departmentId||e.studentProfile?.departmentId||e.teacherProfile?.departmentId||e.staffProfile?.departmentId||i?.id||null,department:i,majorId:e.majorId||e.studentProfile?.majorId||n?.id||null,major:n}}function u(e,t=null){let a=c(e?.student||e?.user||null);return{id:e.id,activityId:e.activityId||t?.id||null,userId:e.studentUserId||a?.id||null,status:n(e.status),reason:e.remark||null,createdAt:e.submittedAt||e.createdAt||null,updatedAt:e.updatedAt||null,user:a,activity:t,attendanceId:e.id}}function m(e){var t;let a,r;if(!e)return null;let l=Array.isArray(e?.applications)?e.applications:[],s=l.map(e=>u(e)),i=l.filter(e=>["APPLIED","APPROVED","REVISION_REQUIRED"].includes(e.status)).length,n=e.activityType?{id:e.activityType.id,code:e.activityType.code,name:e.activityType.name}:e.typeActivity?{id:e.typeActivity.id,code:e.typeActivity.code,name:e.typeActivity.name}:(t=e.requiredEvidenceType,(a={PHOTO:{id:"PHOTO",name:"ใช้รูปภาพ"},PDF:{id:"PDF",name:"ใช้ PDF"},BOTH:{id:"BOTH",name:"ทั่วไป"}})[t]||a.BOTH),d=(r=(Array.isArray(e?.targetDepartments)?e.targetDepartments:[]).map(e=>({departmentId:e?.departmentId||e?.department?.id||null,department:e?.department||null})).filter(e=>e.departmentId)).length>0?r:e?.ownerDepartmentId||e?.ownerDepartment?.id?[{departmentId:e.ownerDepartmentId||e.ownerDepartment?.id,department:e.ownerDepartment||null}]:[],c=o(d.map(e=>e.department).filter(e=>e?.id)),m=d.map(e=>e.departmentId).filter(Boolean),p=c[0]||e.ownerDepartment||null,y=(Array.isArray(e?.targetMajors)?e.targetMajors:Array.isArray(e?.majorJoins)?e.majorJoins:[]).map(e=>({majorId:e?.majorId||e?.major?.id||null,major:e?.major||null})).filter(e=>e.majorId),f=o(y.map(e=>e.major).filter(e=>e?.id)),x=y.map(e=>e.majorId).filter(Boolean),v=s.map(t=>({...t,activityId:t.activityId||e.id}));return{id:e.id,name:e.title,title:e.title,description:e.note||"",note:e.note||"",location:e.location,address:e.location,hour:e.hours,hours:e.hours,activityHours:e.hours,maxPeopleCount:e.capacity,maxStudents:e.capacity,peopleCount:i,startDate:e.startAt,endDate:e.endAt,date:e.applyCloseAt,startAt:e.startAt,endAt:e.endAt,applyOpen:e.applyOpenAt,applyClose:e.applyCloseAt,applyOpenAt:e.applyOpenAt,applyCloseAt:e.applyCloseAt,status:e.status||"OPEN_REGISTRATION",departmentId:m[0]||e.ownerDepartmentId||null,departmentIds:m,facultyId:e.ownerFacultyId||null,department:p,departments:c,faculty:e.ownerFaculty||null,activityType:e.activityType||n,typeActivity:n,typeActivityId:e.activityTypeId||n.id,requiredEvidenceType:e.requiredEvidenceType,ownerScope:e.ownerScope,attendances:v,applications:l,createdBy:e.createdBy||null,targetDepartments:d,majorJoins:y,targetMajors:y,majorIds:x,majors:f,level:e.level||null,createdAt:e.createdAt||null,updatedAt:e.updatedAt||null,fileActivities:[],remarks:e.note||""}}e.s(["mapActivityStatusToApi",()=>i,"mapApplicationStatusFromApi",()=>n,"mapLegacyAttendanceAction",()=>d,"normalizeActivity",()=>m,"normalizeAttendance",()=>u,"normalizeUser",()=>c,"roleToUserType",()=>s])},38953,e=>{"use strict";e.i(47167);var t=e.i(71645);let a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"};var r=e.i(9583);function l(){return(l=Object.assign.bind()).apply(this,arguments)}let s=t.forwardRef((e,s)=>t.createElement(r.default,l({},e,{ref:s,icon:a})));e.s(["default",0,s],38953)},99133,e=>{"use strict";var t=e.i(27494);e.s(["Select",()=>t.default])},88511,e=>{"use strict";let t=(0,e.i(75254).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>t],88511)},83552,7233,27612,e=>{"use strict";e.i(47167);var t=e.i(71645),a=e.i(62901);e.i(63335);var r=e.i(51095),l=e.i(30294),s=e.i(7670),i=e.i(11517),n=e.i(42064),d=e.i(29672),o=e.i(96158),c=e.i(85781),u=e.i(36938),m=e.i(20228),p=e.i(62405),y=e.i(8850),f=e.i(87414),x=e.i(10730);let v=(0,e.i(46422).genStyleHooks)("Popconfirm",e=>(e=>{let{componentCls:t,iconCls:a,antCls:r,zIndexPopup:l,colorText:s,colorWarning:i,marginXXS:n,marginXS:d,fontSize:o,fontWeightStrong:c,colorTextHeading:u}=e;return{[t]:{zIndex:l,[`&${r}-popover`]:{fontSize:o},[`${t}-message`]:{marginBottom:d,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${t}-message-icon ${a}`]:{color:i,fontSize:o,lineHeight:1,marginInlineEnd:d},[`${t}-title`]:{fontWeight:c,color:u,"&:only-child":{fontWeight:"normal"}},[`${t}-description`]:{marginTop:n,color:s}},[`${t}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:d}}}}})(e),e=>{let{zIndexPopupBase:t}=e;return{zIndexPopup:t+60}},{resetStyle:!1}),h=e=>{let{prefixCls:r,okButtonProps:l,cancelButtonProps:i,title:d,description:o,cancelText:x,okText:v,okType:h="primary",icon:g=t.createElement(a.default,null),showCancel:j=!0,close:A,onConfirm:I,onCancel:C,onPopupClick:N,classNames:w,styles:T}=e,{getPrefixCls:E}=t.useContext(n.ConfigContext),[S]=(0,y.useLocale)("Popconfirm",f.default.Popconfirm),$=(0,u.getRenderPropValue)(d),b=(0,u.getRenderPropValue)(o);return t.createElement("div",{className:`${r}-inner-content`,onClick:N},t.createElement("div",{className:`${r}-message`},g&&t.createElement("span",{className:`${r}-message-icon`},g),t.createElement("div",{className:`${r}-message-text`},$&&t.createElement("div",{className:(0,s.clsx)(`${r}-title`,w?.title),style:T?.title},$),b&&t.createElement("div",{className:(0,s.clsx)(`${r}-description`,w?.content),style:T?.content},b))),t.createElement("div",{className:`${r}-buttons`},j&&t.createElement(m.default,{onClick:C,size:"small",...i},x||S?.cancelText),t.createElement(c.default,{buttonProps:{size:"small",...(0,p.convertLegacyProps)(h),...l},actionFn:I,close:A,prefixCls:E("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},v||S?.okText)))},g=t.forwardRef((e,c)=>{let{prefixCls:u,placement:m="top",trigger:p="click",okType:y="primary",icon:f=t.createElement(a.default,null),children:x,overlayClassName:g,onOpenChange:j,overlayStyle:A,styles:I,arrow:C,classNames:N,...w}=e,{getPrefixCls:T,className:E,style:S,classNames:$,styles:b,arrow:P}=(0,n.useComponentConfig)("popconfirm"),[O,D]=(0,l.useControlledState)(e.defaultOpen??!1,e.open),F=(0,o.default)(C,P),M=(e,t)=>{D(e),j?.(e,t)},R=T("popconfirm",u),q={...e,placement:m,trigger:p,okType:y,overlayStyle:A,styles:I,classNames:N},[k,B]=(0,i.useMergeSemantic)([$,N],[b,I],{props:q}),L=(0,s.clsx)(R,E,g,k.root);return v(R),t.createElement(d.default,{arrow:F,...(0,r.omit)(w,["title"]),trigger:p,placement:m,onOpenChange:(t,a)=>{let{disabled:r=!1}=e;r||M(t,a)},open:O,ref:c,classNames:{root:L,container:k.container,arrow:k.arrow},styles:{root:{...S,...B.root,...A},container:B.container,arrow:B.arrow},content:t.createElement(h,{okType:y,icon:f,...e,prefixCls:R,close:e=>{M(!1,e)},onConfirm:t=>e.onConfirm?.call(void 0,t),onCancel:t=>{M(!1,t),e.onCancel?.call(void 0,t)},classNames:k,styles:B}),"data-popover-inject":!0},x)});g._InternalPanelDoNotUseOrYouWillBeFired=e=>{let{prefixCls:a,placement:r,className:l,style:i,...d}=e,{getPrefixCls:o}=t.useContext(n.ConfigContext),c=o("popconfirm",a);return v(c),t.createElement(x.default,{placement:r,className:(0,s.clsx)(c,l),style:i,content:t.createElement(h,{prefixCls:c,...d})})},e.s(["Popconfirm",0,g],83552);var j=e.i(75254);let A=(0,j.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>A],7233);let I=(0,j.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>I],27612)},27521,e=>{"use strict";var t=e.i(2783);let a=async()=>{var e;let a,r=await t.default.get("/activities");return e=(Array.isArray(r.data)?r.data:[]).map(e=>e.ownerDepartment).filter(e=>e?.id),a=new Map,e.forEach(e=>{e?.id&&a.set(e.id,e)}),Array.from(a.values())},r=e=>[401,403].includes(e?.response?.status),l=async(e={})=>{try{let a=await t.default.get("/departments",{params:e});return Array.isArray(a.data)?a.data:[]}catch(e){if(r(e))return a();throw e}},s=async e=>(await t.default.post("/departments",e)).data,i=async(e,a)=>(await t.default.patch(`/departments/${e}`,a)).data,n=async e=>(await t.default.delete(`/departments/${e}`)).data,d=async()=>{let e=await t.default.get("/departments/faculties");return Array.isArray(e.data)?e.data:[]},o=async e=>{if(!e)return[];try{let a=await t.default.get(`/departments/${e}/majors`);return Array.isArray(a.data)?a.data:[]}catch(a){if(r(a)){let a=await t.default.get(`/activities/departments/${e}/majors`);return Array.isArray(a.data)?a.data:[]}throw a}},c=async(e,a)=>(await t.default.post(`/departments/${e}/majors`,a)).data,u=async(e,a,r)=>(await t.default.patch(`/departments/${e}/majors/${a}`,r)).data,m=async(e,a)=>(await t.default.delete(`/departments/${e}/majors/${a}`)).data;e.s(["createDepartment",0,s,"createMajor",0,c,"deleteDepartment",0,n,"deleteMajor",0,m,"getAllDepartments",0,l,"getAllFaculties",0,d,"getMajorsByDepartment",0,o,"updateDepartment",0,i,"updateMajor",0,u])},20905,e=>{"use strict";var t=e.i(2783);let a=async(e={})=>{let a=await t.default.get("/activity-types",{params:e});return Array.isArray(a.data)?a.data:[]},r=async e=>(await t.default.post("/activity-types",e)).data,l=async(e,a)=>(await t.default.patch(`/activity-types/${e}`,a)).data,s=async e=>(await t.default.delete(`/activity-types/${e}`)).data;e.s(["createTypeActivity",0,r,"deleteTypeActivity",0,s,"getAllTypeActivities",0,a,"updateTypeActivity",0,l])},99022,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(64571),l=e.i(75712),s=e.i(8613),i=e.i(11451),n=e.i(12931),d=e.i(83552),o=e.i(99133),c=e.i(96870),u=e.i(82725),m=e.i(91542),p=e.i(62218),y=e.i(98573),f=e.i(88511),x=e.i(86536),v=e.i(7233),h=e.i(55436),g=e.i(27612),j=e.i(98961),A=e.i(27521),I=e.i(20905);let C=["FACULTY_ADMIN","SUPER_ADMIN"],N=[{value:"OPEN_REGISTRATION",label:"เปิดรับสมัคร"},{value:"IN_PROGRESS",label:"กำลังดำเนินการ"},{value:"CLOSED",label:"ปิดกิจกรรม"},{value:"CANCELLED",label:"ยกเลิกกิจกรรม"}],w=[{value:"BOTH",label:"ทั่วไป (รูปภาพหรือ PDF)"},{value:"PHOTO",label:"รูปภาพเท่านั้น"},{value:"PDF",label:"PDF เท่านั้น"}],T=e=>{let t=new Map;return e.forEach(e=>{e?.id&&t.set(e.id,e)}),Array.from(t.values())},E=e=>e?Array.isArray(e)?e.filter(Boolean):[e]:[],S=e=>{if(!e)return;let t=new Date(e);if(Number.isNaN(t.getTime()))return;let a=60*t.getTimezoneOffset()*1e3;return new Date(t.getTime()-a).toISOString().slice(0,16)},$=e=>{if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()},b=e=>Array.isArray(e.departments)&&e.departments.length>0?e.departments:e.department?.id?[e.department]:[],P=e=>Array.isArray(e.majorJoins)?e.majorJoins:[];function O(){let[e]=s.Form.useForm(),O=s.Form.useWatch("departmentIds",e),[D,F]=(0,a.useState)(null),[M,R]=(0,a.useState)(!1),[q,k]=(0,a.useState)(!1),[B,L]=(0,a.useState)([]),[z,H]=(0,a.useState)([]),[_,U]=(0,a.useState)([]),[V,G]=(0,a.useState)([]),[W,J]=(0,a.useState)(""),[Y,K]=(0,a.useState)(null),[Q,X]=(0,a.useState)(null),[Z,ee]=(0,a.useState)(!1),[et,ea]=(0,a.useState)(!1),[er,el]=(0,a.useState)(null),[es,ei]=(0,a.useState)(null),en=C.includes(D?.role),ed=!en&&D?.departmentId||null,eo=async(t,a=!0)=>{let r=T(E(t).map(e=>({id:e}))).map(e=>e.id);if(0===r.length){U([]),a||e.setFieldValue("majorIds",[]);return}try{let t=(await Promise.all(r.map(async e=>{try{return await (0,A.getMajorsByDepartment)(e)}catch(e){return[]}}))).flat(),l=T(t).sort((e,t)=>String(e.code||"").localeCompare(String(t.code||""),"th"));if(U(l),a){let t=E(e.getFieldValue("majorIds")),a=new Set(l.map(e=>e.id));e.setFieldValue("majorIds",t.filter(e=>a.has(e)))}}catch(e){U([])}},ec=async()=>{R(!0);try{let e,t=(e=localStorage.getItem("user"))?JSON.parse(e):null;F(t);let a=C.includes(t?.role),[r,l,s]=await Promise.all([(0,j.getAllActivities)(),(0,I.getAllTypeActivities)(),a?(0,A.getAllDepartments)():Promise.resolve([])]);if(L(Array.isArray(r)?r:[]),G(Array.isArray(l)?l:[]),a)H(Array.isArray(s)?s:[]);else if(t?.department?.id)H([t.department]);else{let e=T((Array.isArray(r)?r:[]).flatMap(e=>b(e)).filter(e=>e?.id));H(e)}}catch(t){let e=t?.response?.data?.message||"ไม่สามารถโหลดข้อมูลกิจกรรมได้";y.message.error(e)}finally{R(!1)}};(0,a.useEffect)(()=>{ec()},[]),(0,a.useEffect)(()=>{Z&&eo(E(O),!0)},[O,Z]);let eu=(0,a.useMemo)(()=>{let e=W.trim().toLowerCase();return B.filter(t=>{if(ed&&!new Set(b(t).map(e=>e.id)).has(ed))return!1;if(e){let a=b(t).map(e=>String(e?.name||"")).join(" ").toLowerCase();if(!(String(t.name||t.title||"").toLowerCase().includes(e)||a.includes(e)))return!1}return(!Y||!!new Set(b(t).map(e=>e.id)).has(Y))&&(!Q||(t.typeActivity?.id||t.typeActivityId)===Q)})},[B,W,Y,Q,ed]),em=(0,a.useMemo)(()=>({totalActivities:eu.length,totalHours:eu.reduce((e,t)=>e+Number(t.hour||t.hours||0),0)}),[eu]),ep=async()=>{el(null),e.resetFields();let t=ed?[ed]:[];e.setFieldsValue({title:"",note:"",location:"",activityTypeId:void 0,requiredEvidenceType:"BOTH",hours:1,capacity:1,startAt:void 0,endAt:void 0,applyOpenAt:void 0,applyCloseAt:void 0,status:"OPEN_REGISTRATION",departmentIds:t,majorIds:[]}),await eo(t,!1),ee(!0)},ey=async t=>{el(t);let a=E(t.departmentIds),r=a.length>0?a:b(t).map(e=>e.id),l=E(t.majorIds).length>0?E(t.majorIds):P(t).map(e=>e.majorId),s=ed?[ed]:r;e.setFieldsValue({title:t.title||t.name||"",note:t.note||t.description||"",location:t.location||t.address||"",activityTypeId:t.typeActivity?.id||t.typeActivityId,requiredEvidenceType:t.requiredEvidenceType||"BOTH",hours:t.hours||t.hour||1,capacity:t.capacity||t.maxPeopleCount||1,startAt:S(t.startAt||t.startDate),endAt:S(t.endAt||t.endDate),applyOpenAt:S(t.applyOpenAt||t.applyOpen),applyCloseAt:S(t.applyCloseAt||t.applyClose||t.date),status:t.status||"OPEN_REGISTRATION",departmentIds:s,majorIds:l}),await eo(s,!1),ee(!0)},ef=async e=>{try{await (0,j.deleteActivity)(e.id),y.message.success(`ลบกิจกรรม "${e.name||e.title}" สำเร็จ`),await ec()}catch(t){let e=t?.response?.data?.message||"ไม่สามารถลบกิจกรรมได้";y.message.error(e)}},ex=async t=>{k(!0);try{let a,r,l,s=(a=T(E(t.departmentIds).map(e=>({id:e}))).map(e=>e.id),r=ed&&!en?[ed]:a,l=T(E(t.majorIds).map(e=>({id:e}))).map(e=>e.id),{title:t.title,note:t.note||"",location:t.location,activityTypeId:t.activityTypeId,requiredEvidenceType:t.requiredEvidenceType||"BOTH",hours:Number(t.hours||1),capacity:Number(t.capacity||1),startAt:$(t.startAt),endAt:$(t.endAt),applyOpenAt:$(t.applyOpenAt||t.startAt),applyCloseAt:$(t.applyCloseAt||t.startAt),status:t.status||"OPEN_REGISTRATION",departmentIds:r,majorIds:l});er?(await (0,j.updateActivity)(er.id,s),y.message.success("แก้ไขกิจกรรมสำเร็จ")):(await (0,j.createActivity)(s),y.message.success("เพิ่มกิจกรรมสำเร็จ")),ee(!1),el(null),e.resetFields(),await ec()}catch(t){let e=t?.response?.data?.message||(er?"ไม่สามารถแก้ไขกิจกรรมได้":"ไม่สามารถเพิ่มกิจกรรมได้");y.message.error(e)}finally{k(!1)}},ev=(0,a.useMemo)(()=>z.length>0?z:T(B.flatMap(e=>b(e))),[z,B]),eh=[{title:"ลำดับ",width:80,align:"center",render:(e,t,a)=>a+1},{title:"กิจกรรม",dataIndex:"name",render:(e,t)=>t.name||t.title||"-"},{title:"ภาควิชา",width:260,render:(e,a)=>{let r=b(a);return(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:r.length>0?r.map(e=>(0,t.jsx)(p.Tag,{color:"blue",children:e.name},e.id)):(0,t.jsx)("span",{className:"text-gray-400",children:"-"})})}},{title:"สาขาวิชา",width:280,render:(e,a)=>{let r=P(a);return 0===r.length?(0,t.jsx)("span",{className:"text-gray-500",children:"ทุกสาขาในภาคที่เลือก"}):(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:r.map(e=>(0,t.jsxs)(p.Tag,{color:"#0A894C",children:[e.major?.code?`${e.major.code} - `:"",e.major?.name||e.majorId]},e.majorId))})}},{title:"ประเภทกิจกรรม",width:180,render:(e,a)=>(0,t.jsx)(p.Tag,{color:"green",children:a.typeActivity?.name||"ยังไม่กำหนดประเภท"})},{title:"นักศึกษา",width:130,align:"center",render:(e,a)=>{let r=Number(a.peopleCount||0),l=Number(a.maxPeopleCount||a.maxStudents||0);return(0,t.jsxs)("span",{className:"font-medium",style:{color:"#0A894C"},children:[r,"/",l]})}},{title:"จัดการ",width:160,align:"center",render:(e,a)=>(0,t.jsxs)(c.Space,{children:[(0,t.jsx)(r.Button,{type:"text",icon:(0,t.jsx)(x.Eye,{size:18}),onClick:()=>{ei(a),ea(!0)},title:"ดูข้อมูล"}),(0,t.jsx)(r.Button,{type:"text",icon:(0,t.jsx)(f.Edit,{size:18}),onClick:()=>ey(a),title:"แก้ไข"}),(0,t.jsx)(d.Popconfirm,{title:"ยืนยันการลบ",description:"ต้องการลบกิจกรรมนี้หรือไม่",onConfirm:()=>ef(a),okText:"ลบ",cancelText:"ยกเลิก",children:(0,t.jsx)(r.Button,{danger:!0,type:"text",icon:(0,t.jsx)(g.Trash2,{size:18}),title:"ลบ"})})]})}];return(0,t.jsx)(u.Spin,{spinning:M,children:(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Card,{className:"mb-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,t.jsx)("div",{className:"col-span-12 lg:col-span-4",children:(0,t.jsx)(i.Input,{placeholder:"ค้นหาชื่อกิจกรรมหรือภาควิชา",value:W,onChange:e=>J(e.target.value),prefix:(0,t.jsx)(h.Search,{size:16})})}),(0,t.jsx)("div",{className:"col-span-12 lg:col-span-3",children:(0,t.jsx)(o.Select,{allowClear:!0,placeholder:"กรองตามภาควิชา",value:Y,onChange:K,style:{width:"100%"},options:ev.map(e=>({value:e.id,label:e.name}))})}),(0,t.jsx)("div",{className:"col-span-12 lg:col-span-3",children:(0,t.jsx)(o.Select,{allowClear:!0,placeholder:"กรองตามประเภทกิจกรรม",value:Q,onChange:X,style:{width:"100%"},options:V.map(e=>({value:e.id,label:`${e.code} - ${e.name}`}))})}),(0,t.jsx)("div",{className:"col-span-12 lg:col-span-2 flex justify-end",children:(0,t.jsx)(r.Button,{type:"primary",icon:(0,t.jsx)(v.Plus,{size:16}),onClick:ep,style:{backgroundColor:"#0A894C",borderColor:"#0A894C"},children:"เพิ่มกิจกรรม"})})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)(l.Card,{children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"จำนวนกิจกรรม"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-[#0A894C]",children:em.totalActivities})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"จำนวนชั่วโมงรวม"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-[#0A894C]",children:em.totalHours})]})]}),(0,t.jsx)(l.Card,{children:(0,t.jsx)(m.Table,{rowKey:"id",columns:eh,dataSource:eu,pagination:{pageSize:10,showSizeChanger:!0},scroll:{x:1200}})}),(0,t.jsx)(n.Modal,{title:er?"แก้ไขกิจกรรม":"เพิ่มกิจกรรม",open:Z,onCancel:()=>{ee(!1),el(null),e.resetFields()},onOk:()=>e.submit(),confirmLoading:q,okText:er?"บันทึก":"สร้าง",cancelText:"ยกเลิก",width:920,children:(0,t.jsxs)(s.Form,{form:e,layout:"vertical",onFinish:ex,children:[(0,t.jsx)(s.Form.Item,{label:"ชื่อกิจกรรม",name:"title",rules:[{required:!0,message:"กรุณากรอกชื่อกิจกรรม"}],children:(0,t.jsx)(i.Input,{})}),(0,t.jsx)(s.Form.Item,{label:"ประเภทกิจกรรม",name:"activityTypeId",rules:[{required:!0,message:"กรุณาเลือกประเภทกิจกรรม"}],children:(0,t.jsx)(o.Select,{placeholder:"เลือกประเภทกิจกรรม",options:V.map(e=>({value:e.id,label:`${e.code} - ${e.name}`}))})}),(0,t.jsx)(s.Form.Item,{label:"ภาควิชา (เลือกได้หลายภาควิชา)",name:"departmentIds",rules:[{required:!0,message:"กรุณาเลือกภาควิชาอย่างน้อย 1 ภาควิชา"}],children:(0,t.jsx)(o.Select,{mode:"multiple",disabled:!en,placeholder:en?"เลือกภาควิชา":"ระบบกำหนดภาควิชาตามสิทธิ์",options:z.map(e=>({value:e.id,label:`${e.code?`${e.code} - `:""}${e.name}`}))})}),(0,t.jsx)(s.Form.Item,{label:"สาขาวิชา (ไม่เลือก = ทุกสาขาในภาคที่เลือก)",name:"majorIds",children:(0,t.jsx)(o.Select,{mode:"multiple",placeholder:"เลือกสาขาวิชา",options:_.map(e=>({value:e.id,label:`${e.code} - ${e.name}`}))})}),(0,t.jsx)(s.Form.Item,{label:"สถานที่",name:"location",rules:[{required:!0,message:"กรุณากรอกสถานที่"}],children:(0,t.jsx)(i.Input,{})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsx)(s.Form.Item,{label:"วันเวลาเริ่มกิจกรรม",name:"startAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาเริ่ม"}],children:(0,t.jsx)(i.Input,{type:"datetime-local"})}),(0,t.jsx)(s.Form.Item,{label:"วันเวลาสิ้นสุดกิจกรรม",name:"endAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาสิ้นสุด"}],children:(0,t.jsx)(i.Input,{type:"datetime-local"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsx)(s.Form.Item,{label:"วันเวลาเปิดรับสมัคร",name:"applyOpenAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาเปิดรับสมัคร"}],children:(0,t.jsx)(i.Input,{type:"datetime-local"})}),(0,t.jsx)(s.Form.Item,{label:"วันเวลาปิดรับสมัคร",name:"applyCloseAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาปิดรับสมัคร"}],children:(0,t.jsx)(i.Input,{type:"datetime-local"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsx)(s.Form.Item,{label:"จำนวนชั่วโมงกิจกรรม",name:"hours",rules:[{required:!0,message:"กรุณากรอกจำนวนชั่วโมง"}],children:(0,t.jsx)(i.Input,{type:"number",min:1})}),(0,t.jsx)(s.Form.Item,{label:"จำนวนนักศึกษาสูงสุด",name:"capacity",rules:[{required:!0,message:"กรุณากรอกจำนวนรับสูงสุด"}],children:(0,t.jsx)(i.Input,{type:"number",min:1})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsx)(s.Form.Item,{label:"หลักฐานที่ต้องใช้",name:"requiredEvidenceType",rules:[{required:!0,message:"กรุณาเลือกประเภทหลักฐาน"}],children:(0,t.jsx)(o.Select,{options:w})}),(0,t.jsx)(s.Form.Item,{label:"สถานะกิจกรรม",name:"status",rules:[{required:!0,message:"กรุณาเลือกสถานะกิจกรรม"}],children:(0,t.jsx)(o.Select,{options:N})})]}),(0,t.jsx)(s.Form.Item,{label:"รายละเอียดเพิ่มเติม",name:"note",children:(0,t.jsx)(i.Input.TextArea,{rows:4})})]})}),(0,t.jsx)(n.Modal,{title:"รายละเอียดกิจกรรม",open:et,onCancel:()=>{ea(!1),ei(null)},footer:null,width:780,children:es&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"ชื่อกิจกรรม"}),(0,t.jsx)("div",{className:"font-medium",children:es.name||es.title})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"ประเภทกิจกรรม"}),(0,t.jsx)(p.Tag,{color:"green",children:es.typeActivity?.name||"ยังไม่กำหนดประเภท"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"ภาควิชา"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:b(es).map(e=>(0,t.jsx)(p.Tag,{color:"blue",children:e.name},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"สาขาวิชา"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:P(es).length>0?P(es).map(e=>(0,t.jsxs)(p.Tag,{color:"#0A894C",children:[e.major?.code?`${e.major.code} - `:"",e.major?.name||e.majorId]},e.majorId)):(0,t.jsx)("span",{className:"text-gray-500 text-sm",children:"ทุกสาขาในภาคที่เลือก"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"วันเวลาเริ่มกิจกรรม"}),(0,t.jsx)("div",{children:S(es.startAt||es.startDate)||"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"วันเวลาสิ้นสุดกิจกรรม"}),(0,t.jsx)("div",{children:S(es.endAt||es.endDate)||"-"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"สถานที่"}),(0,t.jsx)("div",{children:es.location||es.address||"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-gray-500 text-sm",children:"รายละเอียดเพิ่มเติม"}),(0,t.jsx)("div",{children:es.note||es.description||"-"})]})]})})]})})}e.s(["default",()=>O])}]);