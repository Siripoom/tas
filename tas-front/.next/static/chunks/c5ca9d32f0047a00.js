(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},90121,22611,e=>{"use strict";var t=e.i(71645);let a=e=>e&&"object"==typeof e?e:"boolean"==typeof e?{enabled:e,blur:e}:{};e.s(["useMergedMask",0,(e,r,i)=>(0,t.useMemo)(()=>{let t=a(e),n={...a(r),...t},l=!1!==n.blur?`${i}-mask-blur`:void 0;return[!1!==n.enabled,{mask:l}]},[e,r,i])],90121),e.i(63335);var r=e.i(80251);function i(){}let n=t.createContext({add:i,remove:i});function l(e){let a=t.useContext(n),i=t.useRef(null);return(0,r.useEvent)(t=>{if(t){let r=e?t.querySelector(e):t;r&&(a.add(r),i.current=r)}else a.remove(i.current)})}e.s(["usePanelRef",()=>l],22611)},96870,e=>{"use strict";var t=e.i(38243);e.s(["Space",()=>t.default])},21192,e=>{"use strict";let t=e.i(64042).Row;e.s(["Row",0,t],21192)},78654,e=>{"use strict";var t=e.i(31757),t=t;let a=t.default;e.s(["Col",0,a],78654)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>t],3116)},69638,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],69638)},48182,e=>{"use strict";var t=e.i(98961),a=e.i(2783),r=e.i(17851);let i=async()=>(await (0,t.getAllActivities)()).flatMap(e=>(e.attendances||[]).map(t=>({...t,activityId:t.activityId||e.id,activity:e}))),n=async e=>{let t=e.activityId;if(!t)throw Error("activityId is required");let i=await a.default.post(`/activities/${t}/apply`);return{id:i.data.id,activityId:i.data.activityId,userId:i.data.studentUserId,status:(0,r.mapApplicationStatusFromApi)(i.data.status),reason:i.data.remark||null,createdAt:i.data.submittedAt,updatedAt:i.data.updatedAt}},l=async(e,t={})=>{let i=(0,r.mapLegacyAttendanceAction)(t.status),n=await a.default.post(`/approvals/${e}/${"approve"===i?"approve":"request-revision"}`,{remark:t.remark||t.reason||t.rejectReason});return(0,r.normalizeAttendance)(n.data)},s=async e=>(await i()).filter(t=>t.userId===e||t.user?.id===e||t.user?.id===String(e)),d=async e=>{let a=await (0,t.getActivityById)(e);return(a.attendances||[]).map(t=>({...t,activityId:e,activity:a}))};e.s(["createAttendance",0,n,"getAllAttendances",0,i,"getAttendancesByActivity",0,d,"getAttendancesByUser",0,s,"updateAttendance",0,l])},24623,e=>{"use strict";var t=e.i(2783);let a=(e,t=null)=>({id:e.id,fileName:e.originalName||e.fileName||"file",fileType:e.fileType,ownerType:e.ownerType,ownerId:e.ownerId,mimeType:e.mimeType,sizeBytes:e.sizeBytes,uploadedAt:e.uploadedAt||e.createdAt,user:t,downloadUrl:`/files/${e.id}/download`}),r=async(e,r)=>{let i=await t.default.get("/files",{params:{ownerType:e,ownerId:r}});return Array.isArray(i.data)?i.data.map(e=>a(e)):[]},i=async(e,r)=>{let i=new FormData;return i.append("file",e),i.append("ownerType","APPLICATION"),i.append("ownerId",r),a((await t.default.post("/files/upload",i,{headers:{"Content-Type":"multipart/form-data"}})).data)},n=async e=>(await t.default.get(`/files/${e}/download`,{responseType:"blob"})).data,l=async e=>{let a=(await t.default.get(`/activities/${e}`)).data,i=Array.isArray(a.applications)?a.applications:[];return(await Promise.all(i.map(async e=>(await r("APPLICATION",e.id)).map(t=>({...t,user:e.student||null}))))).flat()},s=async e=>r("APPLICATION",e);e.s(["downloadFile",0,n,"getFilesByActivity",0,l,"getFilesByApplication",0,s,"uploadFileAttendance",0,i])},73884,e=>{"use strict";let t=(0,e.i(75254).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],73884)},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},39874,e=>{"use strict";var t=e.i(8206);function a(e,a){let r=[void 0,void 0],i=Array.isArray(e)?e:[e,void 0],n=a||{xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0};return i.forEach((e,a)=>{if("object"==typeof e&&null!==e)for(let i=0;i<t.responsiveArray.length;i++){let l=t.responsiveArray[i];if(n[l]&&void 0!==e[l]){r[a]=e[l];break}}else r[a]=e}),r}e.s(["default",()=>a])},59442,e=>{"use strict";let t=(0,e.i(71645).createContext)({});e.s(["default",0,t])},64042,e=>{"use strict";e.i(47167);var t=e.i(71645),a=e.i(7670),r=e.i(8206),i=e.i(42064),n=e.i(50073),l=e.i(39874),s=e.i(59442),d=e.i(56570);function o(e,a){let[i,n]=t.useState("string"==typeof e?e:"");return t.useEffect(()=>{(()=>{if("string"==typeof e&&n(e),"object"==typeof e)for(let t=0;t<r.responsiveArray.length;t++){let i=r.responsiveArray[t];if(!a||!a[i])continue;let l=e[i];if(void 0!==l)return void n(l)}})()},[JSON.stringify(e),a]),i}let u=t.forwardRef((e,r)=>{let{prefixCls:u,justify:c,align:p,className:m,style:f,children:y,gutter:v=0,wrap:A,...h}=e,{getPrefixCls:I,direction:g}=t.useContext(i.ConfigContext),x=(0,n.default)(!0,null),j=o(p,x),w=o(c,x),C=I("row",u),[E,$]=(0,d.useRowStyle)(C),P=(0,l.default)(v,x),S=(0,a.clsx)(C,{[`${C}-no-wrap`]:!1===A,[`${C}-${w}`]:w,[`${C}-${j}`]:j,[`${C}-rtl`]:"rtl"===g},m,E,$),T={};P?.[0]&&(T.marginInline="number"==typeof P[0]?`${-(P[0]/2)}px`:`calc(${P[0]} / -2)`);let[b,N]=P;T.rowGap=N;let R=t.useMemo(()=>({gutter:[b,N],wrap:A}),[b,N,A]);return t.createElement(s.default.Provider,{value:R},t.createElement("div",{...h,className:S,style:{...T,...f},ref:r},y))});e.s(["Row",0,u],64042)},31757,e=>{"use strict";var t=e.i(71645),a=e.i(7670),r=e.i(42064),i=e.i(59442),n=e.i(56570);function l(e){return"auto"===e?"1 1 auto":"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let s=["xs","sm","md","lg","xl","xxl"],d=t.forwardRef((e,d)=>{let{getPrefixCls:o,direction:u}=t.useContext(r.ConfigContext),{gutter:c,wrap:p}=t.useContext(i.default),{prefixCls:m,span:f,order:y,offset:v,push:A,pull:h,className:I,children:g,flex:x,style:j,...w}=e,C=o("col",m),[E,$]=(0,n.useColStyle)(C),P={},S={};s.forEach(t=>{let a={},r=e[t];"number"==typeof r?a.span=r:"object"==typeof r&&(a=r||{}),delete w[t],S={...S,[`${C}-${t}-${a.span}`]:void 0!==a.span,[`${C}-${t}-order-${a.order}`]:a.order||0===a.order,[`${C}-${t}-offset-${a.offset}`]:a.offset||0===a.offset,[`${C}-${t}-push-${a.push}`]:a.push||0===a.push,[`${C}-${t}-pull-${a.pull}`]:a.pull||0===a.pull,[`${C}-rtl`]:"rtl"===u},a.flex&&(S[`${C}-${t}-flex`]=!0,P[`--${C}-${t}-flex`]=l(a.flex))});let T=(0,a.clsx)(C,{[`${C}-${f}`]:void 0!==f,[`${C}-order-${y}`]:y,[`${C}-offset-${v}`]:v,[`${C}-push-${A}`]:A,[`${C}-pull-${h}`]:h},I,S,E,$),b={};return c?.[0]&&(b.paddingInline="number"==typeof c[0]?`${c[0]/2}px`:`calc(${c[0]} / 2)`),x&&(b.flex=l(x),!1!==p||b.minWidth||(b.minWidth=0)),t.createElement("div",{...w,style:{...b,...j,...P},className:T,ref:d},g)});e.s(["default",0,d])},17851,e=>{"use strict";let t={STUDENT:"student",TEACHER:"teacher",DEPT_STAFF:"admin",FACULTY_ADMIN:"admin",SUPER_ADMIN:"admin"},a={planned:"OPEN_REGISTRATION",inprogress:"IN_PROGRESS",completed:"CLOSED",cancelled:"CANCELLED"},r={APPLIED:"request-revision",APPROVED:"approve",REJECTED:"request-revision",REVISION_REQUIRED:"request-revision",CANCELLED:"request-revision",NO_SHOW:"request-revision",SUBMITTED:"request-revision",COMPLETED:"approve",joined:"request-revision",accepted:"approve",approved:"approve",completed:"approve",rejected:"request-revision",uncompleted:"request-revision",Inprogress:"request-revision"};function i(e){let t=(null==e?"":String(e)).trim();if(!t)return{firstName:"User",lastName:""};let a=t.split(/\s+/);return{firstName:a.shift()||"User",lastName:a.join(" ")}}function n(e){return t[e]||"student"}function l(e){return a[e]||e||void 0}function s(e){return e||"APPLIED"}function d(e){return r[e]||"request-revision"}function o(e){let t=new Map;return e.forEach(e=>{e?.id&&t.set(e.id,e)}),Array.from(t.values())}function u(e){if(!e)return null;let t=[e.firstName,e.lastName].filter(Boolean).join(" ").trim(),a=e.fullname||t||e.username||e.email||"Unknown",r=e.faculty||e.studentProfile?.faculty||e.teacherProfile?.faculty||e.staffProfile?.faculty||null,l=e.department||e.studentProfile?.department||e.teacherProfile?.department||e.staffProfile?.department||null,s=e.major||e.studentProfile?.major||null,d=e.studentCode||e.studentProfile?.studentCode||null,o=e.classYear||e.studentProfile?.classYear||null,u=e.academicYear||e.studentProfile?.academicYear||null;return{id:e.id,role:e.role,userType:n(e.role),username:e.username||null,email:e.email||null,fullname:a,name:a,firstName:e.firstName||i(a).firstName,lastName:e.lastName||i(a).lastName,phone:e.phone||null,status:e.status||"ACTIVE",studentId:d,studentCode:d,classYear:o,academicYear:u,level:o,facultyId:e.facultyId||e.studentProfile?.facultyId||e.teacherProfile?.facultyId||e.staffProfile?.facultyId||r?.id||null,faculty:r,departmentId:e.departmentId||e.studentProfile?.departmentId||e.teacherProfile?.departmentId||e.staffProfile?.departmentId||l?.id||null,department:l,majorId:e.majorId||e.studentProfile?.majorId||s?.id||null,major:s}}function c(e,t=null){let a=u(e?.student||e?.user||null);return{id:e.id,activityId:e.activityId||t?.id||null,userId:e.studentUserId||a?.id||null,status:s(e.status),reason:e.remark||null,createdAt:e.submittedAt||e.createdAt||null,updatedAt:e.updatedAt||null,user:a,activity:t,attendanceId:e.id}}function p(e){var t;let a,r;if(!e)return null;let i=Array.isArray(e?.applications)?e.applications:[],n=i.map(e=>c(e)),l=i.filter(e=>["APPLIED","APPROVED","REVISION_REQUIRED"].includes(e.status)).length,s=e.activityType?{id:e.activityType.id,code:e.activityType.code,name:e.activityType.name}:e.typeActivity?{id:e.typeActivity.id,code:e.typeActivity.code,name:e.typeActivity.name}:(t=e.requiredEvidenceType,(a={PHOTO:{id:"PHOTO",name:"ใช้รูปภาพ"},PDF:{id:"PDF",name:"ใช้ PDF"},BOTH:{id:"BOTH",name:"ทั่วไป"}})[t]||a.BOTH),d=(r=(Array.isArray(e?.targetDepartments)?e.targetDepartments:[]).map(e=>({departmentId:e?.departmentId||e?.department?.id||null,department:e?.department||null})).filter(e=>e.departmentId)).length>0?r:e?.ownerDepartmentId||e?.ownerDepartment?.id?[{departmentId:e.ownerDepartmentId||e.ownerDepartment?.id,department:e.ownerDepartment||null}]:[],u=o(d.map(e=>e.department).filter(e=>e?.id)),p=d.map(e=>e.departmentId).filter(Boolean),m=u[0]||e.ownerDepartment||null,f=(Array.isArray(e?.targetMajors)?e.targetMajors:Array.isArray(e?.majorJoins)?e.majorJoins:[]).map(e=>({majorId:e?.majorId||e?.major?.id||null,major:e?.major||null})).filter(e=>e.majorId),y=o(f.map(e=>e.major).filter(e=>e?.id)),v=f.map(e=>e.majorId).filter(Boolean),A=n.map(t=>({...t,activityId:t.activityId||e.id}));return{id:e.id,name:e.title,title:e.title,description:e.note||"",note:e.note||"",location:e.location,address:e.location,hour:e.hours,hours:e.hours,activityHours:e.hours,maxPeopleCount:e.capacity,maxStudents:e.capacity,peopleCount:l,startDate:e.startAt,endDate:e.endAt,date:e.applyCloseAt,startAt:e.startAt,endAt:e.endAt,applyOpen:e.applyOpenAt,applyClose:e.applyCloseAt,applyOpenAt:e.applyOpenAt,applyCloseAt:e.applyCloseAt,status:e.status||"OPEN_REGISTRATION",departmentId:p[0]||e.ownerDepartmentId||null,departmentIds:p,facultyId:e.ownerFacultyId||null,department:m,departments:u,faculty:e.ownerFaculty||null,activityType:e.activityType||s,typeActivity:s,typeActivityId:e.activityTypeId||s.id,requiredEvidenceType:e.requiredEvidenceType,ownerScope:e.ownerScope,attendances:A,applications:i,createdBy:e.createdBy||null,targetDepartments:d,majorJoins:f,targetMajors:f,majorIds:v,majors:y,level:e.level||null,createdAt:e.createdAt||null,updatedAt:e.updatedAt||null,fileActivities:[],remarks:e.note||""}}e.s(["mapActivityStatusToApi",()=>l,"mapApplicationStatusFromApi",()=>s,"mapLegacyAttendanceAction",()=>d,"normalizeActivity",()=>p,"normalizeAttendance",()=>c,"normalizeUser",()=>u,"roleToUserType",()=>n])},38953,e=>{"use strict";e.i(47167);var t=e.i(71645);let a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"};var r=e.i(9583);function i(){return(i=Object.assign.bind()).apply(this,arguments)}let n=t.forwardRef((e,n)=>t.createElement(r.default,i({},e,{ref:n,icon:a})));e.s(["default",0,n],38953)},99133,e=>{"use strict";var t=e.i(27494);e.s(["Select",()=>t.default])},53496,e=>{"use strict";var t=e.i(21369);e.s(["Tabs",()=>t.default])},48459,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(75712),i=e.i(82725),n=e.i(53496),l=e.i(98573),s=e.i(26912),d=e.i(61911),o=e.i(2143),u=e.i(85810),c=e.i(4756),p=e.i(7764),m=e.i(98961),f=e.i(48182),y=e.i(24623),v=e.i(75312);function A(){let[e,A]=(0,a.useState)("participation"),[h,I]=(0,a.useState)(!1),[g,x]=(0,a.useState)(!1),[j,w]=(0,a.useState)(null),[C,E]=(0,a.useState)([]),[$,P]=(0,a.useState)(""),[S,T]=(0,a.useState)({major:null,year:null}),[b,N]=(0,a.useState)(!1),[R,D]=(0,a.useState)(!1),[O,k]=(0,a.useState)(null),[B,F]=(0,a.useState)({});(0,a.useEffect)(()=>{w((0,v.getUserScope)())},[]);let M=async()=>{if(!j?.departmentId)return void l.message.error("ไม่พบข้อมูลภาควิชาของผู้ใช้");I(!0);try{let e=await (0,m.getAllActivities)({departmentId:j.departmentId}),t=Array.isArray(e)?e:[];E(t.filter(e=>{var t;return t=j.departmentId,(Array.isArray(e?.departments)&&e.departments.length>0?e.departments:e?.department?.id?[e.department]:[]).some(e=>e?.id===t)}))}catch(e){console.error("Error fetching participation activities:",e),l.message.error("ไม่สามารถโหลดข้อมูลได้")}finally{I(!1)}};(0,a.useEffect)(()=>{M()},[j?.departmentId]);let U=(0,a.useMemo)(()=>{let e=new Set;return C.forEach(t=>{(t.majorJoins||[]).forEach(t=>{t?.major?.name&&e.add(t.major.name)})}),Array.from(e)},[C]),q=(0,a.useMemo)(()=>{let e=$.trim().toLowerCase();return C.filter(t=>{if(e){let a=t.department?.name||"",r=t.name||"",i=t.typeActivity?.name||"";if(!`${r} ${a} ${i}`.toLowerCase().includes(e))return!1}return(!S.major||!!(t.majorJoins||[]).some(e=>e?.major?.name===S.major))&&(!S.year||!!(t.attendances||[]).some(e=>String(e?.user?.level||"")===String(S.year)))&&!0})},[C,$,S]),L=async e=>{k(e),D(!0),x(!0);try{var t;let a,r=await (0,y.getFilesByActivity)(e.id);F((t=Array.isArray(r)?r:[],a={},t.forEach(e=>{let t=e?.ownerId;t&&(a[t]||(a[t]=[]),a[t].push(e))}),a))}catch(e){console.error("Error fetching evidence files:",e),F({}),l.message.error("ไม่สามารถโหลดไฟล์หลักฐานได้")}finally{x(!1)}},z=async e=>{try{await (0,f.updateAttendance)(e.id,{status:"APPROVED"}),l.message.success("อนุมัติการเข้าร่วมสำเร็จ"),await M()}catch(e){console.error("Error approving attendance:",e),l.message.error("ไม่สามารถอนุมัติการเข้าร่วมได้")}},_=async e=>{try{await (0,f.updateAttendance)(e.id,{status:"REVISION_REQUIRED",remark:e.rejectReason||void 0}),l.message.success("ส่งกลับแก้ไขสำเร็จ"),await M()}catch(e){console.error("Error requesting revision:",e),l.message.error("ไม่สามารถส่งกลับแก้ไขได้")}},V=[{key:"participation",label:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Users,{size:18}),"การเข้าร่วมกิจกรรม"]}),children:(0,t.jsxs)("div",{children:[(0,t.jsx)(c.default,{onSearch:P,onFilterChange:(e,t)=>T(a=>({...a,[e]:t})),onReset:()=>{P(""),T({major:null,year:null})},hideDepartmentFilter:!0,majorOptions:U}),(0,t.jsx)(r.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:(0,t.jsx)(i.Spin,{spinning:h,children:(0,t.jsx)(u.default,{data:q,onView:e=>{k(e),N(!0)}})})})]})},{key:"evidence",label:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.FileCheck,{size:18}),"หลักฐานการเข้าร่วมกิจกรรม"]}),children:(0,t.jsxs)("div",{children:[(0,t.jsx)(c.default,{onSearch:P,onFilterChange:(e,t)=>T(a=>({...a,[e]:t})),onReset:()=>{P(""),T({major:null,year:null})},hideDepartmentFilter:!0,majorOptions:U}),(0,t.jsx)(r.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:(0,t.jsx)(i.Spin,{spinning:h,children:(0,t.jsx)(u.default,{data:q,onView:L})})})]})}];return(0,t.jsxs)("div",{children:[(0,t.jsx)(r.Card,{className:"mb-6 shadow-sm",style:{background:"linear-gradient(135deg, #0A894C 0%, #0ea258 100%)",border:"none"},children:(0,t.jsxs)("div",{className:"text-white",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["ภาควิชา ",j?.departmentName||"-"]}),(0,t.jsx)("p",{className:"text-sm opacity-90",children:"ตรวจสอบการเข้าร่วมกิจกรรมและหลักฐานของนักศึกษาในภาควิชา"})]})}),(0,t.jsx)(n.Tabs,{activeKey:e,onChange:A,items:V,size:"large"}),(0,t.jsx)(p.default,{visible:b,onClose:()=>N(!1),activity:O,onApprove:z,onReject:_}),(0,t.jsx)(o.default,{visible:R,onClose:()=>D(!1),activity:O,onApprove:z,onReject:_,filesByAttendanceId:B,loading:g})]})}e.s(["default",()=>A])}]);