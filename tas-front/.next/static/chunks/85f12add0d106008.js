(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},90121,22611,e=>{"use strict";var t=e.i(71645);let a=e=>e&&"object"==typeof e?e:"boolean"==typeof e?{enabled:e,blur:e}:{};e.s(["useMergedMask",0,(e,r,l)=>(0,t.useMemo)(()=>{let t=a(e),s={...a(r),...t},n=!1!==s.blur?`${l}-mask-blur`:void 0;return[!1!==s.enabled,{mask:n}]},[e,r,l])],90121),e.i(63335);var r=e.i(80251);function l(){}let s=t.createContext({add:l,remove:l});function n(e){let a=t.useContext(s),l=t.useRef(null);return(0,r.useEvent)(t=>{if(t){let r=e?t.querySelector(e):t;r&&(a.add(r),l.current=r)}else a.remove(l.current)})}e.s(["usePanelRef",()=>n],22611)},96870,e=>{"use strict";var t=e.i(38243);e.s(["Space",()=>t.default])},88511,e=>{"use strict";let t=(0,e.i(75254).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>t],88511)},83552,7233,27612,e=>{"use strict";e.i(47167);var t=e.i(71645),a=e.i(62901);e.i(63335);var r=e.i(51095),l=e.i(30294),s=e.i(7670),n=e.i(11517),i=e.i(42064),o=e.i(29672),d=e.i(96158),c=e.i(85781),u=e.i(36938),m=e.i(20228),p=e.i(62405),f=e.i(8850),y=e.i(87414),I=e.i(10730);let h=(0,e.i(46422).genStyleHooks)("Popconfirm",e=>(e=>{let{componentCls:t,iconCls:a,antCls:r,zIndexPopup:l,colorText:s,colorWarning:n,marginXXS:i,marginXS:o,fontSize:d,fontWeightStrong:c,colorTextHeading:u}=e;return{[t]:{zIndex:l,[`&${r}-popover`]:{fontSize:d},[`${t}-message`]:{marginBottom:o,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${t}-message-icon ${a}`]:{color:n,fontSize:d,lineHeight:1,marginInlineEnd:o},[`${t}-title`]:{fontWeight:c,color:u,"&:only-child":{fontWeight:"normal"}},[`${t}-description`]:{marginTop:i,color:s}},[`${t}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:o}}}}})(e),e=>{let{zIndexPopupBase:t}=e;return{zIndexPopup:t+60}},{resetStyle:!1}),A=e=>{let{prefixCls:r,okButtonProps:l,cancelButtonProps:n,title:o,description:d,cancelText:I,okText:h,okType:A="primary",icon:v=t.createElement(a.default,null),showCancel:x=!0,close:j,onConfirm:C,onCancel:T,onPopupClick:P,classNames:N,styles:g}=e,{getPrefixCls:E}=t.useContext(i.ConfigContext),[S]=(0,f.useLocale)("Popconfirm",y.default.Popconfirm),D=(0,u.getRenderPropValue)(o),F=(0,u.getRenderPropValue)(d);return t.createElement("div",{className:`${r}-inner-content`,onClick:P},t.createElement("div",{className:`${r}-message`},v&&t.createElement("span",{className:`${r}-message-icon`},v),t.createElement("div",{className:`${r}-message-text`},D&&t.createElement("div",{className:(0,s.clsx)(`${r}-title`,N?.title),style:g?.title},D),F&&t.createElement("div",{className:(0,s.clsx)(`${r}-description`,N?.content),style:g?.content},F))),t.createElement("div",{className:`${r}-buttons`},x&&t.createElement(m.default,{onClick:T,size:"small",...n},I||S?.cancelText),t.createElement(c.default,{buttonProps:{size:"small",...(0,p.convertLegacyProps)(A),...l},actionFn:C,close:j,prefixCls:E("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},h||S?.okText)))},v=t.forwardRef((e,c)=>{let{prefixCls:u,placement:m="top",trigger:p="click",okType:f="primary",icon:y=t.createElement(a.default,null),children:I,overlayClassName:v,onOpenChange:x,overlayStyle:j,styles:C,arrow:T,classNames:P,...N}=e,{getPrefixCls:g,className:E,style:S,classNames:D,styles:F,arrow:w}=(0,i.useComponentConfig)("popconfirm"),[b,$]=(0,l.useControlledState)(e.defaultOpen??!1,e.open),U=(0,d.default)(T,w),M=(e,t)=>{$(e),x?.(e,t)},_=g("popconfirm",u),R={...e,placement:m,trigger:p,okType:f,overlayStyle:j,styles:C,classNames:P},[Y,L]=(0,n.useMergeSemantic)([D,P],[F,C],{props:R}),O=(0,s.clsx)(_,E,v,Y.root);return h(_),t.createElement(o.default,{arrow:U,...(0,r.omit)(N,["title"]),trigger:p,placement:m,onOpenChange:(t,a)=>{let{disabled:r=!1}=e;r||M(t,a)},open:b,ref:c,classNames:{root:O,container:Y.container,arrow:Y.arrow},styles:{root:{...S,...L.root,...j},container:L.container,arrow:L.arrow},content:t.createElement(A,{okType:f,icon:y,...e,prefixCls:_,close:e=>{M(!1,e)},onConfirm:t=>e.onConfirm?.call(void 0,t),onCancel:t=>{M(!1,t),e.onCancel?.call(void 0,t)},classNames:Y,styles:L}),"data-popover-inject":!0},I)});v._InternalPanelDoNotUseOrYouWillBeFired=e=>{let{prefixCls:a,placement:r,className:l,style:n,...o}=e,{getPrefixCls:d}=t.useContext(i.ConfigContext),c=d("popconfirm",a);return h(c),t.createElement(I.default,{placement:r,className:(0,s.clsx)(c,l),style:n,content:t.createElement(A,{prefixCls:c,...o})})},e.s(["Popconfirm",0,v],83552);var x=e.i(75254);let j=(0,x.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>j],7233);let C=(0,x.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>C],27612)},27521,e=>{"use strict";var t=e.i(2783);let a=async()=>{var e;let a,r=await t.default.get("/activities");return e=(Array.isArray(r.data)?r.data:[]).map(e=>e.ownerDepartment).filter(e=>e?.id),a=new Map,e.forEach(e=>{e?.id&&a.set(e.id,e)}),Array.from(a.values())},r=e=>[401,403].includes(e?.response?.status),l=async(e={})=>{try{let a=await t.default.get("/departments",{params:e});return Array.isArray(a.data)?a.data:[]}catch(e){if(r(e))return a();throw e}},s=async e=>(await t.default.post("/departments",e)).data,n=async(e,a)=>(await t.default.patch(`/departments/${e}`,a)).data,i=async e=>(await t.default.delete(`/departments/${e}`)).data,o=async()=>{let e=await t.default.get("/departments/faculties");return Array.isArray(e.data)?e.data:[]},d=async e=>{if(!e)return[];try{let a=await t.default.get(`/departments/${e}/majors`);return Array.isArray(a.data)?a.data:[]}catch(a){if(r(a)){let a=await t.default.get(`/activities/departments/${e}/majors`);return Array.isArray(a.data)?a.data:[]}throw a}},c=async(e,a)=>(await t.default.post(`/departments/${e}/majors`,a)).data,u=async(e,a,r)=>(await t.default.patch(`/departments/${e}/majors/${a}`,r)).data,m=async(e,a)=>(await t.default.delete(`/departments/${e}/majors/${a}`)).data;e.s(["createDepartment",0,s,"createMajor",0,c,"deleteDepartment",0,i,"deleteMajor",0,m,"getAllDepartments",0,l,"getAllFaculties",0,o,"getMajorsByDepartment",0,d,"updateDepartment",0,n,"updateMajor",0,u])},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},39874,e=>{"use strict";var t=e.i(8206);function a(e,a){let r=[void 0,void 0],l=Array.isArray(e)?e:[e,void 0],s=a||{xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0};return l.forEach((e,a)=>{if("object"==typeof e&&null!==e)for(let l=0;l<t.responsiveArray.length;l++){let n=t.responsiveArray[l];if(s[n]&&void 0!==e[n]){r[a]=e[n];break}}else r[a]=e}),r}e.s(["default",()=>a])},59442,e=>{"use strict";let t=(0,e.i(71645).createContext)({});e.s(["default",0,t])},64042,e=>{"use strict";e.i(47167);var t=e.i(71645),a=e.i(7670),r=e.i(8206),l=e.i(42064),s=e.i(50073),n=e.i(39874),i=e.i(59442),o=e.i(56570);function d(e,a){let[l,s]=t.useState("string"==typeof e?e:"");return t.useEffect(()=>{(()=>{if("string"==typeof e&&s(e),"object"==typeof e)for(let t=0;t<r.responsiveArray.length;t++){let l=r.responsiveArray[t];if(!a||!a[l])continue;let n=e[l];if(void 0!==n)return void s(n)}})()},[JSON.stringify(e),a]),l}let c=t.forwardRef((e,r)=>{let{prefixCls:c,justify:u,align:m,className:p,style:f,children:y,gutter:I=0,wrap:h,...A}=e,{getPrefixCls:v,direction:x}=t.useContext(l.ConfigContext),j=(0,s.default)(!0,null),C=d(m,j),T=d(u,j),P=v("row",c),[N,g]=(0,o.useRowStyle)(P),E=(0,n.default)(I,j),S=(0,a.clsx)(P,{[`${P}-no-wrap`]:!1===h,[`${P}-${T}`]:T,[`${P}-${C}`]:C,[`${P}-rtl`]:"rtl"===x},p,N,g),D={};E?.[0]&&(D.marginInline="number"==typeof E[0]?`${-(E[0]/2)}px`:`calc(${E[0]} / -2)`);let[F,w]=E;D.rowGap=w;let b=t.useMemo(()=>({gutter:[F,w],wrap:h}),[F,w,h]);return t.createElement(i.default.Provider,{value:b},t.createElement("div",{...A,className:S,style:{...D,...f},ref:r},y))});e.s(["Row",0,c],64042)},31757,e=>{"use strict";var t=e.i(71645),a=e.i(7670),r=e.i(42064),l=e.i(59442),s=e.i(56570);function n(e){return"auto"===e?"1 1 auto":"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let i=["xs","sm","md","lg","xl","xxl"],o=t.forwardRef((e,o)=>{let{getPrefixCls:d,direction:c}=t.useContext(r.ConfigContext),{gutter:u,wrap:m}=t.useContext(l.default),{prefixCls:p,span:f,order:y,offset:I,push:h,pull:A,className:v,children:x,flex:j,style:C,...T}=e,P=d("col",p),[N,g]=(0,s.useColStyle)(P),E={},S={};i.forEach(t=>{let a={},r=e[t];"number"==typeof r?a.span=r:"object"==typeof r&&(a=r||{}),delete T[t],S={...S,[`${P}-${t}-${a.span}`]:void 0!==a.span,[`${P}-${t}-order-${a.order}`]:a.order||0===a.order,[`${P}-${t}-offset-${a.offset}`]:a.offset||0===a.offset,[`${P}-${t}-push-${a.push}`]:a.push||0===a.push,[`${P}-${t}-pull-${a.pull}`]:a.pull||0===a.pull,[`${P}-rtl`]:"rtl"===c},a.flex&&(S[`${P}-${t}-flex`]=!0,E[`--${P}-${t}-flex`]=n(a.flex))});let D=(0,a.clsx)(P,{[`${P}-${f}`]:void 0!==f,[`${P}-order-${y}`]:y,[`${P}-offset-${I}`]:I,[`${P}-push-${h}`]:h,[`${P}-pull-${A}`]:A},v,S,N,g),F={};return u?.[0]&&(F.paddingInline="number"==typeof u[0]?`${u[0]/2}px`:`calc(${u[0]} / 2)`),j&&(F.flex=n(j),!1!==m||F.minWidth||(F.minWidth=0)),t.createElement("div",{...T,style:{...F,...C,...E},className:D,ref:o},x)});e.s(["default",0,o])},17851,e=>{"use strict";let t={STUDENT:"student",TEACHER:"teacher",DEPT_STAFF:"admin",FACULTY_ADMIN:"admin",SUPER_ADMIN:"admin"},a={planned:"OPEN_REGISTRATION",inprogress:"IN_PROGRESS",completed:"CLOSED",cancelled:"CANCELLED"},r={APPLIED:"request-revision",APPROVED:"approve",REJECTED:"request-revision",REVISION_REQUIRED:"request-revision",CANCELLED:"request-revision",NO_SHOW:"request-revision",SUBMITTED:"request-revision",COMPLETED:"approve",joined:"request-revision",accepted:"approve",approved:"approve",completed:"approve",rejected:"request-revision",uncompleted:"request-revision",Inprogress:"request-revision"};function l(e){let t=(null==e?"":String(e)).trim();if(!t)return{firstName:"User",lastName:""};let a=t.split(/\s+/);return{firstName:a.shift()||"User",lastName:a.join(" ")}}function s(e){return t[e]||"student"}function n(e){return a[e]||e||void 0}function i(e){return e||"APPLIED"}function o(e){return r[e]||"request-revision"}function d(e){let t=new Map;return e.forEach(e=>{e?.id&&t.set(e.id,e)}),Array.from(t.values())}function c(e){if(!e)return null;let t=[e.firstName,e.lastName].filter(Boolean).join(" ").trim(),a=e.fullname||t||e.username||e.email||"Unknown",r=e.faculty||e.studentProfile?.faculty||e.teacherProfile?.faculty||e.staffProfile?.faculty||null,n=e.department||e.studentProfile?.department||e.teacherProfile?.department||e.staffProfile?.department||null,i=e.major||e.studentProfile?.major||null,o=e.studentCode||e.studentProfile?.studentCode||null,d=e.classYear||e.studentProfile?.classYear||null,c=e.academicYear||e.studentProfile?.academicYear||null;return{id:e.id,role:e.role,userType:s(e.role),username:e.username||null,email:e.email||null,fullname:a,name:a,firstName:e.firstName||l(a).firstName,lastName:e.lastName||l(a).lastName,phone:e.phone||null,status:e.status||"ACTIVE",studentId:o,studentCode:o,classYear:d,academicYear:c,level:d,facultyId:e.facultyId||e.studentProfile?.facultyId||e.teacherProfile?.facultyId||e.staffProfile?.facultyId||r?.id||null,faculty:r,departmentId:e.departmentId||e.studentProfile?.departmentId||e.teacherProfile?.departmentId||e.staffProfile?.departmentId||n?.id||null,department:n,majorId:e.majorId||e.studentProfile?.majorId||i?.id||null,major:i}}function u(e,t=null){let a=c(e?.student||e?.user||null);return{id:e.id,activityId:e.activityId||t?.id||null,userId:e.studentUserId||a?.id||null,status:i(e.status),reason:e.remark||null,createdAt:e.submittedAt||e.createdAt||null,updatedAt:e.updatedAt||null,user:a,activity:t,attendanceId:e.id}}function m(e){var t;let a,r;if(!e)return null;let l=Array.isArray(e?.applications)?e.applications:[],s=l.map(e=>u(e)),n=l.filter(e=>["APPLIED","APPROVED","REVISION_REQUIRED"].includes(e.status)).length,i=e.activityType?{id:e.activityType.id,code:e.activityType.code,name:e.activityType.name}:e.typeActivity?{id:e.typeActivity.id,code:e.typeActivity.code,name:e.typeActivity.name}:(t=e.requiredEvidenceType,(a={PHOTO:{id:"PHOTO",name:"ใช้รูปภาพ"},PDF:{id:"PDF",name:"ใช้ PDF"},BOTH:{id:"BOTH",name:"ทั่วไป"}})[t]||a.BOTH),o=(r=(Array.isArray(e?.targetDepartments)?e.targetDepartments:[]).map(e=>({departmentId:e?.departmentId||e?.department?.id||null,department:e?.department||null})).filter(e=>e.departmentId)).length>0?r:e?.ownerDepartmentId||e?.ownerDepartment?.id?[{departmentId:e.ownerDepartmentId||e.ownerDepartment?.id,department:e.ownerDepartment||null}]:[],c=d(o.map(e=>e.department).filter(e=>e?.id)),m=o.map(e=>e.departmentId).filter(Boolean),p=c[0]||e.ownerDepartment||null,f=(Array.isArray(e?.targetMajors)?e.targetMajors:Array.isArray(e?.majorJoins)?e.majorJoins:[]).map(e=>({majorId:e?.majorId||e?.major?.id||null,major:e?.major||null})).filter(e=>e.majorId),y=d(f.map(e=>e.major).filter(e=>e?.id)),I=f.map(e=>e.majorId).filter(Boolean),h=s.map(t=>({...t,activityId:t.activityId||e.id}));return{id:e.id,name:e.title,title:e.title,description:e.note||"",note:e.note||"",location:e.location,address:e.location,hour:e.hours,hours:e.hours,activityHours:e.hours,maxPeopleCount:e.capacity,maxStudents:e.capacity,peopleCount:n,startDate:e.startAt,endDate:e.endAt,date:e.applyCloseAt,startAt:e.startAt,endAt:e.endAt,applyOpen:e.applyOpenAt,applyClose:e.applyCloseAt,applyOpenAt:e.applyOpenAt,applyCloseAt:e.applyCloseAt,status:e.status||"OPEN_REGISTRATION",departmentId:m[0]||e.ownerDepartmentId||null,departmentIds:m,facultyId:e.ownerFacultyId||null,department:p,departments:c,faculty:e.ownerFaculty||null,activityType:e.activityType||i,typeActivity:i,typeActivityId:e.activityTypeId||i.id,requiredEvidenceType:e.requiredEvidenceType,ownerScope:e.ownerScope,attendances:h,applications:l,createdBy:e.createdBy||null,targetDepartments:o,majorJoins:f,targetMajors:f,majorIds:I,majors:y,level:e.level||null,createdAt:e.createdAt||null,updatedAt:e.updatedAt||null,fileActivities:[],remarks:e.note||""}}e.s(["mapActivityStatusToApi",()=>n,"mapApplicationStatusFromApi",()=>i,"mapLegacyAttendanceAction",()=>o,"normalizeActivity",()=>m,"normalizeAttendance",()=>u,"normalizeUser",()=>c,"roleToUserType",()=>s])},38953,e=>{"use strict";e.i(47167);var t=e.i(71645);let a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"};var r=e.i(9583);function l(){return(l=Object.assign.bind()).apply(this,arguments)}let s=t.forwardRef((e,s)=>t.createElement(r.default,l({},e,{ref:s,icon:a})));e.s(["default",0,s],38953)},99133,e=>{"use strict";var t=e.i(27494);e.s(["Select",()=>t.default])},53496,e=>{"use strict";var t=e.i(21369);e.s(["Tabs",()=>t.default])},39706,e=>{"use strict";var t=e.i(2783),a=e.i(17851);e.i(98961);let r=e=>Object.fromEntries(Object.entries(e).filter(([,e])=>void 0!==e)),l=async(e={})=>{let r=await t.default.get("/users",{params:e});return(Array.isArray(r.data)?r.data:[]).map(e=>{let t=(0,a.normalizeUser)(e);return{...t,userType:(0,a.roleToUserType)(e.role),department:t.department,major:t.major,departmentId:t.departmentId,majorId:t.majorId,level:t.level,studentId:t.studentId,role:e.role,studentProfile:e.studentProfile||null,teacherProfile:e.teacherProfile||null,staffProfile:e.staffProfile||null}})},s=async e=>{let r=((e={})=>{let t=(()=>{try{return JSON.parse(localStorage.getItem("user")||"null")}catch(e){return null}})(),a=e.role||"STUDENT",r={username:e.username||e.email||e.studentProfile?.studentCode||`user_${Date.now()}`,email:e.email||void 0,password:e.password||"ChangeMe123!",firstName:e.firstName,lastName:e.lastName||"",phone:e.phone||void 0,role:a,status:e.status||"ACTIVE"},l=t?.facultyId||e.facultyId;if("STUDENT"===a&&(r.studentProfile={studentCode:e.studentProfile?.studentCode||e.studentCode,facultyId:e.studentProfile?.facultyId||e.facultyId||l,departmentId:e.studentProfile?.departmentId||e.departmentId,majorId:e.studentProfile?.majorId||e.majorId,classYear:Number(e.studentProfile?.classYear||e.classYear||e.level)||1,academicYear:Number(e.studentProfile?.academicYear||e.academicYear)||2568,registrarVerified:!!(e.studentProfile?.registrarVerified??!0)}),"TEACHER"===a&&(r.teacherProfile={employeeCode:e.teacherProfile?.employeeCode||e.employeeCode||void 0,facultyId:e.teacherProfile?.facultyId||e.facultyId||l,departmentId:e.teacherProfile?.departmentId||e.departmentId}),"DEPT_STAFF"===a||"FACULTY_ADMIN"===a){let t="FACULTY_ADMIN"===a?"FACULTY_ADMIN":"DEPT_STAFF";r.staffProfile={staffType:t,facultyId:e.staffProfile?.facultyId||e.facultyId||l,departmentId:"FACULTY_ADMIN"===t?null:e.staffProfile?.departmentId||e.departmentId}}return r})(e),l=await t.default.post("/users",r);return(0,a.normalizeUser)(l.data)},n=async(e,l)=>{let s=r(((e={})=>{let t=e.role,a={username:e.username,email:e.email,password:e.password||void 0,firstName:e.firstName,lastName:e.lastName,phone:e.phone,status:e.status};if("STUDENT"===t&&(a.studentProfile=e.studentProfile||{studentCode:e.studentCode,facultyId:e.facultyId,departmentId:e.departmentId,majorId:e.majorId,classYear:e.classYear||e.level,academicYear:e.academicYear,registrarVerified:e.registrarVerified}),"TEACHER"===t&&(a.teacherProfile=e.teacherProfile||{employeeCode:e.employeeCode,facultyId:e.facultyId,departmentId:e.departmentId}),"DEPT_STAFF"===t||"FACULTY_ADMIN"===t){let r="FACULTY_ADMIN"===t?"FACULTY_ADMIN":"DEPT_STAFF";a.staffProfile=e.staffProfile||{staffType:r,facultyId:e.facultyId,departmentId:"FACULTY_ADMIN"===r?null:e.departmentId}}return a})(l));s.studentProfile&&(s.studentProfile=r(s.studentProfile)),s.teacherProfile&&(s.teacherProfile=r(s.teacherProfile)),s.staffProfile&&(s.staffProfile=r(s.staffProfile));let n=await t.default.patch(`/users/${e}`,s);return(0,a.normalizeUser)(n.data)},i=async e=>(await t.default.delete(`/users/${e}`)).data;e.s(["createUser",0,s,"deleteUser",0,i,"getAllUsers",0,l,"updateUser",0,n])},9967,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(92989),l=e.i(64571),s=e.i(75712),n=e.i(8613),i=e.i(11451),o=e.i(12931),d=e.i(83552),c=e.i(99133),u=e.i(96870),m=e.i(82725),p=e.i(91542),f=e.i(53496),y=e.i(62218),I=e.i(98573),h=e.i(88511),A=e.i(86536),v=e.i(7233),x=e.i(55436),j=e.i(27612),C=e.i(61911),T=e.i(39706),P=e.i(27521);let N={STUDENT:"นักศึกษา",TEACHER:"อาจารย์",DEPT_STAFF:"เจ้าหน้าที่ภาควิชา",FACULTY_ADMIN:"เจ้าหน้าที่คณะ",SUPER_ADMIN:"SUPER_ADMIN"},g={student:["STUDENT"],deptStaff:["TEACHER","DEPT_STAFF"],adminStaff:["FACULTY_ADMIN","SUPER_ADMIN"]};function E(){let e=(0,r.useRouter)(),[E]=n.Form.useForm(),[S,D]=(0,a.useState)(!1),[F,w]=(0,a.useState)(!1),[b,$]=(0,a.useState)([]),[U,M]=(0,a.useState)([]),[_,R]=(0,a.useState)([]),[Y,L]=(0,a.useState)([]),[O,k]=(0,a.useState)("student"),[V,q]=(0,a.useState)(""),[z,H]=(0,a.useState)(void 0),[B,W]=(0,a.useState)(!1),[K,J]=(0,a.useState)(!1),[G,Q]=(0,a.useState)(null),[X,Z]=(0,a.useState)(null),[ee,et]=(0,a.useState)(null),[ea,er]=(0,a.useState)(!1),el=n.Form.useWatch("role",E),es=n.Form.useWatch("facultyId",E),en=n.Form.useWatch("departmentId",E),ei=el||G?.role||"STUDENT",eo=ee?.role==="FACULTY_ADMIN",ed=async()=>{D(!0);try{let e=await (0,T.getAllUsers)();$(Array.isArray(e)?e:[])}catch(e){I.message.error("ไม่สามารถโหลดข้อมูลผู้ใช้ได้"),console.error(e)}finally{D(!1)}},ec=async()=>{try{let[e,t]=await Promise.all([(0,P.getAllFaculties)(),(0,P.getAllDepartments)()]);M(Array.isArray(e)?e:[]),R(Array.isArray(t)?t:[])}catch(e){I.message.error("ไม่สามารถโหลดข้อมูลคณะ/ภาควิชาได้"),console.error(e)}};(0,a.useEffect)(()=>{let t=localStorage.getItem("user"),a=t?JSON.parse(t):null;if(et(a),a?.role==="DEPT_STAFF"){er(!0),I.message.error("คุณไม่มีสิทธิ์เข้าถึงเมนูจัดการผู้ใช้"),e.push("/admin/home");return}ec(),ed()},[e]),(0,a.useEffect)(()=>{if("STUDENT"!==ei||!en){L([]),"STUDENT"!==ei&&E.setFieldValue("majorId",void 0);return}(async()=>{try{let e=await (0,P.getMajorsByDepartment)(en);L(Array.isArray(e)?e:[])}catch(e){I.message.error("ไม่สามารถโหลดข้อมูลสาขาวิชาได้"),console.error(e)}})()},[ei,en,E]),(0,a.useEffect)(()=>{!es||en||(L([]),E.setFieldValue("majorId",void 0))},[es,en,E]);let eu=(0,a.useMemo)(()=>b.filter(e=>g[O].includes(e.role)),[b,O]),em=(0,a.useMemo)(()=>{let e=[...eu];if(V){let t=V.toLowerCase();e=e.filter(e=>{let a=e.studentProfile?.studentCode||e.teacherProfile?.employeeCode||e.username||"";return`${e.firstName||""} ${e.lastName||""}`.toLowerCase().includes(t)||String(e.email||"").toLowerCase().includes(t)||String(a).toLowerCase().includes(t)})}return z&&(e=e.filter(e=>e.departmentId===z)),e},[eu,V,z]),ep=(0,a.useMemo)(()=>es?_.filter(e=>e.facultyId===es):_,[_,es]),ef=(0,a.useMemo)(()=>"deptStaff"===O?[{value:"TEACHER",label:"อาจารย์"},{value:"DEPT_STAFF",label:"เจ้าหน้าที่ภาควิชา"}]:"adminStaff"===O?[{value:"FACULTY_ADMIN",label:"เจ้าหน้าที่คณะ"}]:[{value:"STUDENT",label:"นักศึกษา"}],[O]),ey=(0,a.useMemo)(()=>"deptStaff"===O?"TEACHER":"adminStaff"===O?"FACULTY_ADMIN":"STUDENT",[O]),eI=async e=>{if("SUPER_ADMIN"===e.role)return;Q(e);let t=e.role,a={role:t,status:e.status,username:e.username||void 0,email:e.email||void 0,firstName:e.firstName||"",lastName:e.lastName||"",phone:e.phone||void 0,facultyId:e.studentProfile?.facultyId||e.teacherProfile?.facultyId||e.staffProfile?.facultyId||void 0,departmentId:e.studentProfile?.departmentId||e.teacherProfile?.departmentId||e.staffProfile?.departmentId||void 0,studentCode:e.studentProfile?.studentCode||void 0,majorId:e.studentProfile?.majorId||void 0,classYear:e.studentProfile?.classYear||void 0,academicYear:e.studentProfile?.academicYear||void 0,employeeCode:e.teacherProfile?.employeeCode||void 0};if("STUDENT"===t&&a.departmentId)try{let e=await (0,P.getMajorsByDepartment)(a.departmentId);L(Array.isArray(e)?e:[])}catch(e){L([])}else L([]);E.setFieldsValue(a),W(!0)},eh=async e=>{try{await (0,T.deleteUser)(e.id),I.message.success("ลบผู้ใช้สำเร็จ"),await ed()}catch(t){let e=t?.response?.data?.message||"ไม่สามารถลบผู้ใช้ได้";I.message.error(e)}},eA=async e=>{w(!0);try{let t,a,r=(a={role:t=e.role,username:e.username||void 0,email:e.email||void 0,password:e.password||void 0,firstName:e.firstName,lastName:e.lastName,phone:e.phone||void 0,status:e.status},"STUDENT"===t&&(a.studentProfile={studentCode:e.studentCode,facultyId:e.facultyId,departmentId:e.departmentId,majorId:e.majorId,classYear:Number(e.classYear),academicYear:Number(e.academicYear),registrarVerified:!0}),"TEACHER"===t&&(a.teacherProfile={employeeCode:e.employeeCode||void 0,facultyId:e.facultyId,departmentId:e.departmentId}),("DEPT_STAFF"===t||"FACULTY_ADMIN"===t)&&(a.staffProfile={staffType:"FACULTY_ADMIN"===t?"FACULTY_ADMIN":"DEPT_STAFF",facultyId:e.facultyId,departmentId:"FACULTY_ADMIN"===t?null:e.departmentId}),a);G?(await (0,T.updateUser)(G.id,r),I.message.success("แก้ไขผู้ใช้สำเร็จ")):(await (0,T.createUser)(r),I.message.success("เพิ่มผู้ใช้สำเร็จ")),W(!1),E.resetFields(),Q(null),await ed()}catch(t){let e=t?.response?.data?.message||"ไม่สามารถบันทึกข้อมูลผู้ใช้ได้";I.message.error(e),console.error(t)}finally{w(!1)}},ev=[{title:"ลำดับ",width:80,render:(e,t,a)=>a+1},{title:"รหัส",width:170,render:(e,t)=>t.studentProfile?.studentCode||t.teacherProfile?.employeeCode||t.username||"-"},{title:"ชื่อ-นามสกุล",render:(e,t)=>`${t.firstName||""} ${t.lastName||""}`.trim()||"-"},{title:"บทบาท",width:180,render:(e,a)=>(0,t.jsx)(y.Tag,{color:"blue",children:N[a.role]||a.role})},{title:"คณะ",width:190,render:(e,t)=>t.studentProfile?.faculty?.name||t.teacherProfile?.faculty?.name||t.staffProfile?.faculty?.name||"-"},{title:"ภาควิชา",width:220,render:(e,t)=>t.studentProfile?.department?.name||t.teacherProfile?.department?.name||t.staffProfile?.department?.name||"-"},{title:"สถานะ",width:120,render:(e,a)=>{let r="ACTIVE"===a.status?"green":"LOCKED"===a.status?"red":"orange";return(0,t.jsx)(y.Tag,{color:r,children:a.status})}},{title:"จัดการ",width:160,render:(e,a)=>{let r="SUPER_ADMIN"===a.role;return(0,t.jsxs)(u.Space,{children:[(0,t.jsx)(l.Button,{type:"text",icon:(0,t.jsx)(A.Eye,{size:18}),onClick:()=>{Z(a),J(!0)},title:"ดูรายละเอียด"}),!r&&(0,t.jsx)(l.Button,{type:"text",icon:(0,t.jsx)(h.Edit,{size:18}),onClick:()=>eI(a),title:"แก้ไข"}),!r&&(0,t.jsx)(d.Popconfirm,{title:"ยืนยันการลบผู้ใช้",description:"ต้องการลบผู้ใช้นี้หรือไม่",onConfirm:()=>eh(a),okText:"ลบ",cancelText:"ยกเลิก",children:(0,t.jsx)(l.Button,{danger:!0,type:"text",icon:(0,t.jsx)(j.Trash2,{size:18}),title:"ลบ"})})]})}}],ex=[{key:"student",label:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(C.Users,{size:16}),"นักศึกษา (",b.filter(e=>"STUDENT"===e.role).length,")"]})},{key:"deptStaff",label:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(C.Users,{size:16}),"อาจารย์/เจ้าหน้าที่ภาควิชา (",b.filter(e=>["TEACHER","DEPT_STAFF"].includes(e.role)).length,")"]})},{key:"adminStaff",label:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(C.Users,{size:16}),"แอดมิน/เจ้าหน้าที่คณะ (",b.filter(e=>["FACULTY_ADMIN","SUPER_ADMIN"].includes(e.role)).length,")"]})}];return ea?null:(0,t.jsx)(m.Spin,{spinning:S,children:(0,t.jsxs)("div",{children:[(0,t.jsx)(f.Tabs,{activeKey:O,onChange:e=>{k(e),q(""),H(void 0)},items:ex,className:"mb-4"}),(0,t.jsx)(s.Card,{className:"mb-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,t.jsx)("div",{className:"col-span-12 md:col-span-5",children:(0,t.jsx)(i.Input,{value:V,onChange:e=>q(e.target.value),prefix:(0,t.jsx)(x.Search,{size:16}),placeholder:"ค้นหาจากชื่อ/อีเมล/รหัส"})}),(0,t.jsx)("div",{className:"col-span-12 md:col-span-4",children:(0,t.jsx)(c.Select,{value:z,onChange:H,allowClear:!0,placeholder:"กรองตามภาควิชา",options:_.map(e=>({label:e.name,value:e.id})),style:{width:"100%"}})}),(0,t.jsx)("div",{className:"col-span-12 md:col-span-3 flex justify-end",children:(0,t.jsx)(l.Button,{type:"primary",icon:(0,t.jsx)(v.Plus,{size:16}),onClick:()=>{Q(null),L([]),E.resetFields(),E.setFieldsValue({role:ey,status:"ACTIVE",facultyId:eo?ee?.facultyId:void 0,classYear:1,academicYear:2568}),W(!0)},style:{backgroundColor:"#0A894C",borderColor:"#0A894C"},children:"เพิ่มผู้ใช้"})})]})}),(0,t.jsx)(s.Card,{children:(0,t.jsx)(p.Table,{rowKey:"id",columns:ev,dataSource:em,pagination:{pageSize:10,showSizeChanger:!0},scroll:{x:1100}})}),(0,t.jsx)(o.Modal,{title:G?"แก้ไขผู้ใช้":"เพิ่มผู้ใช้",open:B,onCancel:()=>{W(!1),Q(null),L([]),E.resetFields()},onOk:()=>E.submit(),okText:G?"บันทึก":"สร้าง",cancelText:"ยกเลิก",confirmLoading:F,width:760,children:(0,t.jsx)(n.Form,{form:E,layout:"vertical",onFinish:eA,children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[!(!G&&"deptStaff"===O)&&(0,t.jsx)(n.Form.Item,{name:"role",className:"col-span-12",hidden:!0,children:(0,t.jsx)(i.Input,{})}),!G&&"deptStaff"===O&&(0,t.jsx)(n.Form.Item,{label:"ประเภทบัญชี",name:"role",className:"col-span-12",rules:[{required:!0,message:"กรุณาเลือกประเภทบัญชี"}],children:(0,t.jsx)(c.Select,{options:ef})}),G&&(0,t.jsx)(n.Form.Item,{label:"บทบาท",className:"col-span-12",children:(0,t.jsx)(i.Input,{value:N[G.role],disabled:!0})}),(0,t.jsx)(n.Form.Item,{label:"ชื่อ",name:"firstName",className:"col-span-12 md:col-span-6",rules:[{required:!0,message:"กรุณากรอกชื่อ"}],children:(0,t.jsx)(i.Input,{})}),(0,t.jsx)(n.Form.Item,{label:"นามสกุล",name:"lastName",className:"col-span-12 md:col-span-6",rules:[{required:!0,message:"กรุณากรอกนามสกุล"}],children:(0,t.jsx)(i.Input,{})}),(0,t.jsx)(n.Form.Item,{label:"Username",name:"username",className:"col-span-12 md:col-span-6",children:(0,t.jsx)(i.Input,{})}),(0,t.jsx)(n.Form.Item,{label:"Email",name:"email",className:"col-span-12 md:col-span-6",rules:[{type:"email",message:"รูปแบบอีเมลไม่ถูกต้อง"}],children:(0,t.jsx)(i.Input,{})}),(0,t.jsx)(n.Form.Item,{label:"เบอร์โทร",name:"phone",className:"col-span-12 md:col-span-6",children:(0,t.jsx)(i.Input,{})}),(0,t.jsx)(n.Form.Item,{label:G?"รหัสผ่านใหม่ (ไม่บังคับ)":"รหัสผ่าน (ไม่กรอก = ChangeMe123!)",name:"password",className:"col-span-12 md:col-span-6",children:(0,t.jsx)(i.Input.Password,{})}),(0,t.jsx)(n.Form.Item,{label:"สถานะ",name:"status",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณาเลือกสถานะ"}],children:(0,t.jsx)(c.Select,{options:[{label:"ACTIVE",value:"ACTIVE"},{label:"INACTIVE",value:"INACTIVE"},{label:"LOCKED",value:"LOCKED"}]})}),(0,t.jsx)(n.Form.Item,{label:"คณะ",name:"facultyId",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณาเลือกคณะ"}],children:(0,t.jsx)(c.Select,{disabled:eo,options:U.map(e=>({label:e.name,value:e.id})),onChange:()=>{E.setFieldValue("departmentId",void 0),E.setFieldValue("majorId",void 0)}})}),("STUDENT"===ei||"TEACHER"===ei||"DEPT_STAFF"===ei)&&(0,t.jsx)(n.Form.Item,{label:"ภาควิชา",name:"departmentId",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณาเลือกภาควิชา"}],children:(0,t.jsx)(c.Select,{options:ep.map(e=>({label:e.name,value:e.id})),onChange:()=>{E.setFieldValue("majorId",void 0)}})}),"STUDENT"===ei&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Form.Item,{label:"รหัสนักศึกษา",name:"studentCode",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณากรอกรหัสนักศึกษา"}],children:(0,t.jsx)(i.Input,{})}),(0,t.jsx)(n.Form.Item,{label:"สาขาวิชา",name:"majorId",className:"col-span-12 md:col-span-4",rules:[{required:!0,message:"กรุณาเลือกสาขาวิชา"}],children:(0,t.jsx)(c.Select,{options:Y.map(e=>({label:e.code,value:e.id}))})}),(0,t.jsx)(n.Form.Item,{label:"ชั้นปี",name:"classYear",className:"col-span-12 md:col-span-2",rules:[{required:!0,message:"กรุณากรอกชั้นปี"}],children:(0,t.jsx)(i.Input,{type:"number",min:1})}),(0,t.jsx)(n.Form.Item,{label:"ปีการศึกษา",name:"academicYear",className:"col-span-12 md:col-span-2",rules:[{required:!0,message:"กรุณากรอกปีการศึกษา"}],children:(0,t.jsx)(i.Input,{type:"number",min:1})})]}),"TEACHER"===ei&&(0,t.jsx)(n.Form.Item,{label:"รหัสพนักงาน",name:"employeeCode",className:"col-span-12 md:col-span-4",children:(0,t.jsx)(i.Input,{})})]})})}),(0,t.jsx)(o.Modal,{title:"รายละเอียดผู้ใช้",open:K,onCancel:()=>J(!1),footer:null,width:640,children:X&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"ชื่อ:"})," ",`${X.firstName||""} ${X.lastName||""}`.trim()]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"บทบาท:"})," ",N[X.role]||X.role]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"Email:"})," ",X.email||"-"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"Username:"})," ",X.username||"-"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"คณะ:"})," ",X.studentProfile?.faculty?.name||X.teacherProfile?.faculty?.name||X.staffProfile?.faculty?.name||"-"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("b",{children:"ภาควิชา:"})," ",X.studentProfile?.department?.name||X.teacherProfile?.department?.name||X.staffProfile?.department?.name||"-"]})]})})]})})}e.s(["default",()=>E])}]);