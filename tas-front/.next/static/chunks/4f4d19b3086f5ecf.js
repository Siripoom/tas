(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},90121,22611,e=>{"use strict";var t=e.i(71645);let a=e=>e&&"object"==typeof e?e:"boolean"==typeof e?{enabled:e,blur:e}:{};e.s(["useMergedMask",0,(e,r,i)=>(0,t.useMemo)(()=>{let t=a(e),s={...a(r),...t},n=!1!==s.blur?`${i}-mask-blur`:void 0;return[!1!==s.enabled,{mask:n}]},[e,r,i])],90121),e.i(63335);var r=e.i(80251);function i(){}let s=t.createContext({add:i,remove:i});function n(e){let a=t.useContext(s),i=t.useRef(null);return(0,r.useEvent)(t=>{if(t){let r=e?t.querySelector(e):t;r&&(a.add(r),i.current=r)}else a.remove(i.current)})}e.s(["usePanelRef",()=>n],22611)},96870,e=>{"use strict";var t=e.i(38243);e.s(["Space",()=>t.default])},21192,e=>{"use strict";let t=e.i(64042).Row;e.s(["Row",0,t],21192)},78654,e=>{"use strict";var t=e.i(31757),t=t;let a=t.default;e.s(["Col",0,a],78654)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>t],3116)},69638,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],69638)},48182,e=>{"use strict";var t=e.i(98961),a=e.i(2783),r=e.i(17851);let i=async()=>(await (0,t.getAllActivities)()).flatMap(e=>(e.attendances||[]).map(t=>({...t,activityId:t.activityId||e.id,activity:e}))),s=async e=>{let t=e.activityId;if(!t)throw Error("activityId is required");let i=await a.default.post(`/activities/${t}/apply`);return{id:i.data.id,activityId:i.data.activityId,userId:i.data.studentUserId,status:(0,r.mapApplicationStatusFromApi)(i.data.status),reason:i.data.remark||null,createdAt:i.data.submittedAt,updatedAt:i.data.updatedAt}},n=async(e,t={})=>{let i=(0,r.mapLegacyAttendanceAction)(t.status),s=await a.default.post(`/approvals/${e}/${"approve"===i?"approve":"request-revision"}`,{remark:t.remark||t.reason||t.rejectReason});return(0,r.normalizeAttendance)(s.data)},l=async e=>(await i()).filter(t=>t.userId===e||t.user?.id===e||t.user?.id===String(e)),o=async e=>{let a=await (0,t.getActivityById)(e);return(a.attendances||[]).map(t=>({...t,activityId:e,activity:a}))};e.s(["createAttendance",0,s,"getAllAttendances",0,i,"getAttendancesByActivity",0,o,"getAttendancesByUser",0,l,"updateAttendance",0,n])},24623,e=>{"use strict";var t=e.i(2783);let a=(e,t=null)=>({id:e.id,fileName:e.originalName||e.fileName||"file",fileType:e.fileType,ownerType:e.ownerType,ownerId:e.ownerId,mimeType:e.mimeType,sizeBytes:e.sizeBytes,uploadedAt:e.uploadedAt||e.createdAt,user:t,downloadUrl:`/files/${e.id}/download`}),r=async(e,r)=>{let i=await t.default.get("/files",{params:{ownerType:e,ownerId:r}});return Array.isArray(i.data)?i.data.map(e=>a(e)):[]},i=async(e,r)=>{let i=new FormData;return i.append("file",e),i.append("ownerType","APPLICATION"),i.append("ownerId",r),a((await t.default.post("/files/upload",i,{headers:{"Content-Type":"multipart/form-data"}})).data)},s=async e=>(await t.default.get(`/files/${e}/download`,{responseType:"blob"})).data,n=async e=>{let a=(await t.default.get(`/activities/${e}`)).data,i=Array.isArray(a.applications)?a.applications:[];return(await Promise.all(i.map(async e=>(await r("APPLICATION",e.id)).map(t=>({...t,user:e.student||null}))))).flat()},l=async e=>r("APPLICATION",e);e.s(["downloadFile",0,s,"getFilesByActivity",0,n,"getFilesByApplication",0,l,"uploadFileAttendance",0,i])},73884,e=>{"use strict";let t=(0,e.i(75254).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],73884)},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},39874,e=>{"use strict";var t=e.i(8206);function a(e,a){let r=[void 0,void 0],i=Array.isArray(e)?e:[e,void 0],s=a||{xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0};return i.forEach((e,a)=>{if("object"==typeof e&&null!==e)for(let i=0;i<t.responsiveArray.length;i++){let n=t.responsiveArray[i];if(s[n]&&void 0!==e[n]){r[a]=e[n];break}}else r[a]=e}),r}e.s(["default",()=>a])},59442,e=>{"use strict";let t=(0,e.i(71645).createContext)({});e.s(["default",0,t])},64042,e=>{"use strict";e.i(47167);var t=e.i(71645),a=e.i(7670),r=e.i(8206),i=e.i(42064),s=e.i(50073),n=e.i(39874),l=e.i(59442),o=e.i(56570);function d(e,a){let[i,s]=t.useState("string"==typeof e?e:"");return t.useEffect(()=>{(()=>{if("string"==typeof e&&s(e),"object"==typeof e)for(let t=0;t<r.responsiveArray.length;t++){let i=r.responsiveArray[t];if(!a||!a[i])continue;let n=e[i];if(void 0!==n)return void s(n)}})()},[JSON.stringify(e),a]),i}let c=t.forwardRef((e,r)=>{let{prefixCls:c,justify:u,align:p,className:m,style:f,children:y,gutter:v=0,wrap:A,...I}=e,{getPrefixCls:h,direction:g}=t.useContext(i.ConfigContext),E=(0,s.default)(!0,null),x=d(p,E),P=d(u,E),w=h("row",c),[C,b]=(0,o.useRowStyle)(w),j=(0,n.default)(v,E),T=(0,a.clsx)(w,{[`${w}-no-wrap`]:!1===A,[`${w}-${P}`]:P,[`${w}-${x}`]:x,[`${w}-rtl`]:"rtl"===g},m,C,b),$={};j?.[0]&&($.marginInline="number"==typeof j[0]?`${-(j[0]/2)}px`:`calc(${j[0]} / -2)`);let[R,S]=j;$.rowGap=S;let D=t.useMemo(()=>({gutter:[R,S],wrap:A}),[R,S,A]);return t.createElement(l.default.Provider,{value:D},t.createElement("div",{...I,className:T,style:{...$,...f},ref:r},y))});e.s(["Row",0,c],64042)},31757,e=>{"use strict";var t=e.i(71645),a=e.i(7670),r=e.i(42064),i=e.i(59442),s=e.i(56570);function n(e){return"auto"===e?"1 1 auto":"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let l=["xs","sm","md","lg","xl","xxl"],o=t.forwardRef((e,o)=>{let{getPrefixCls:d,direction:c}=t.useContext(r.ConfigContext),{gutter:u,wrap:p}=t.useContext(i.default),{prefixCls:m,span:f,order:y,offset:v,push:A,pull:I,className:h,children:g,flex:E,style:x,...P}=e,w=d("col",m),[C,b]=(0,s.useColStyle)(w),j={},T={};l.forEach(t=>{let a={},r=e[t];"number"==typeof r?a.span=r:"object"==typeof r&&(a=r||{}),delete P[t],T={...T,[`${w}-${t}-${a.span}`]:void 0!==a.span,[`${w}-${t}-order-${a.order}`]:a.order||0===a.order,[`${w}-${t}-offset-${a.offset}`]:a.offset||0===a.offset,[`${w}-${t}-push-${a.push}`]:a.push||0===a.push,[`${w}-${t}-pull-${a.pull}`]:a.pull||0===a.pull,[`${w}-rtl`]:"rtl"===c},a.flex&&(T[`${w}-${t}-flex`]=!0,j[`--${w}-${t}-flex`]=n(a.flex))});let $=(0,a.clsx)(w,{[`${w}-${f}`]:void 0!==f,[`${w}-order-${y}`]:y,[`${w}-offset-${v}`]:v,[`${w}-push-${A}`]:A,[`${w}-pull-${I}`]:I},h,T,C,b),R={};return u?.[0]&&(R.paddingInline="number"==typeof u[0]?`${u[0]/2}px`:`calc(${u[0]} / 2)`),E&&(R.flex=n(E),!1!==p||R.minWidth||(R.minWidth=0)),t.createElement("div",{...P,style:{...R,...x,...j},className:$,ref:o},g)});e.s(["default",0,o])},17851,e=>{"use strict";let t={STUDENT:"student",TEACHER:"teacher",DEPT_STAFF:"admin",FACULTY_ADMIN:"admin",SUPER_ADMIN:"admin"},a={planned:"OPEN_REGISTRATION",inprogress:"IN_PROGRESS",completed:"CLOSED",cancelled:"CANCELLED"},r={APPLIED:"request-revision",APPROVED:"approve",REJECTED:"request-revision",REVISION_REQUIRED:"request-revision",CANCELLED:"request-revision",NO_SHOW:"request-revision",SUBMITTED:"request-revision",COMPLETED:"approve",joined:"request-revision",accepted:"approve",approved:"approve",completed:"approve",rejected:"request-revision",uncompleted:"request-revision",Inprogress:"request-revision"};function i(e){let t=(null==e?"":String(e)).trim();if(!t)return{firstName:"User",lastName:""};let a=t.split(/\s+/);return{firstName:a.shift()||"User",lastName:a.join(" ")}}function s(e){return t[e]||"student"}function n(e){return a[e]||e||void 0}function l(e){return e||"APPLIED"}function o(e){return r[e]||"request-revision"}function d(e){let t=new Map;return e.forEach(e=>{e?.id&&t.set(e.id,e)}),Array.from(t.values())}function c(e){if(!e)return null;let t=[e.firstName,e.lastName].filter(Boolean).join(" ").trim(),a=e.fullname||t||e.username||e.email||"Unknown",r=e.faculty||e.studentProfile?.faculty||e.teacherProfile?.faculty||e.staffProfile?.faculty||null,n=e.department||e.studentProfile?.department||e.teacherProfile?.department||e.staffProfile?.department||null,l=e.major||e.studentProfile?.major||null,o=e.studentCode||e.studentProfile?.studentCode||null,d=e.classYear||e.studentProfile?.classYear||null,c=e.academicYear||e.studentProfile?.academicYear||null;return{id:e.id,role:e.role,userType:s(e.role),username:e.username||null,email:e.email||null,fullname:a,name:a,firstName:e.firstName||i(a).firstName,lastName:e.lastName||i(a).lastName,phone:e.phone||null,status:e.status||"ACTIVE",studentId:o,studentCode:o,classYear:d,academicYear:c,level:d,facultyId:e.facultyId||e.studentProfile?.facultyId||e.teacherProfile?.facultyId||e.staffProfile?.facultyId||r?.id||null,faculty:r,departmentId:e.departmentId||e.studentProfile?.departmentId||e.teacherProfile?.departmentId||e.staffProfile?.departmentId||n?.id||null,department:n,majorId:e.majorId||e.studentProfile?.majorId||l?.id||null,major:l}}function u(e,t=null){let a=c(e?.student||e?.user||null);return{id:e.id,activityId:e.activityId||t?.id||null,userId:e.studentUserId||a?.id||null,status:l(e.status),reason:e.remark||null,createdAt:e.submittedAt||e.createdAt||null,updatedAt:e.updatedAt||null,user:a,activity:t,attendanceId:e.id}}function p(e){var t;let a,r;if(!e)return null;let i=Array.isArray(e?.applications)?e.applications:[],s=i.map(e=>u(e)),n=i.filter(e=>["APPLIED","APPROVED","REVISION_REQUIRED"].includes(e.status)).length,l=e.activityType?{id:e.activityType.id,code:e.activityType.code,name:e.activityType.name}:e.typeActivity?{id:e.typeActivity.id,code:e.typeActivity.code,name:e.typeActivity.name}:(t=e.requiredEvidenceType,(a={PHOTO:{id:"PHOTO",name:"ใช้รูปภาพ"},PDF:{id:"PDF",name:"ใช้ PDF"},BOTH:{id:"BOTH",name:"ทั่วไป"}})[t]||a.BOTH),o=(r=(Array.isArray(e?.targetDepartments)?e.targetDepartments:[]).map(e=>({departmentId:e?.departmentId||e?.department?.id||null,department:e?.department||null})).filter(e=>e.departmentId)).length>0?r:e?.ownerDepartmentId||e?.ownerDepartment?.id?[{departmentId:e.ownerDepartmentId||e.ownerDepartment?.id,department:e.ownerDepartment||null}]:[],c=d(o.map(e=>e.department).filter(e=>e?.id)),p=o.map(e=>e.departmentId).filter(Boolean),m=c[0]||e.ownerDepartment||null,f=(Array.isArray(e?.targetMajors)?e.targetMajors:Array.isArray(e?.majorJoins)?e.majorJoins:[]).map(e=>({majorId:e?.majorId||e?.major?.id||null,major:e?.major||null})).filter(e=>e.majorId),y=d(f.map(e=>e.major).filter(e=>e?.id)),v=f.map(e=>e.majorId).filter(Boolean),A=s.map(t=>({...t,activityId:t.activityId||e.id}));return{id:e.id,name:e.title,title:e.title,description:e.note||"",note:e.note||"",location:e.location,address:e.location,hour:e.hours,hours:e.hours,activityHours:e.hours,maxPeopleCount:e.capacity,maxStudents:e.capacity,peopleCount:n,startDate:e.startAt,endDate:e.endAt,date:e.applyCloseAt,startAt:e.startAt,endAt:e.endAt,applyOpen:e.applyOpenAt,applyClose:e.applyCloseAt,applyOpenAt:e.applyOpenAt,applyCloseAt:e.applyCloseAt,status:e.status||"OPEN_REGISTRATION",departmentId:p[0]||e.ownerDepartmentId||null,departmentIds:p,facultyId:e.ownerFacultyId||null,department:m,departments:c,faculty:e.ownerFaculty||null,activityType:e.activityType||l,typeActivity:l,typeActivityId:e.activityTypeId||l.id,requiredEvidenceType:e.requiredEvidenceType,ownerScope:e.ownerScope,attendances:A,applications:i,createdBy:e.createdBy||null,targetDepartments:o,majorJoins:f,targetMajors:f,majorIds:v,majors:y,level:e.level||null,createdAt:e.createdAt||null,updatedAt:e.updatedAt||null,fileActivities:[],remarks:e.note||""}}e.s(["mapActivityStatusToApi",()=>n,"mapApplicationStatusFromApi",()=>l,"mapLegacyAttendanceAction",()=>o,"normalizeActivity",()=>p,"normalizeAttendance",()=>u,"normalizeUser",()=>c,"roleToUserType",()=>s])},38953,e=>{"use strict";e.i(47167);var t=e.i(71645);let a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"};var r=e.i(9583);function i(){return(i=Object.assign.bind()).apply(this,arguments)}let s=t.forwardRef((e,s)=>t.createElement(r.default,i({},e,{ref:s,icon:a})));e.s(["default",0,s],38953)},99133,e=>{"use strict";var t=e.i(27494);e.s(["Select",()=>t.default])},53496,e=>{"use strict";var t=e.i(21369);e.s(["Tabs",()=>t.default])},22172,e=>{"use strict";var t=e.i(43476),a=e.i(37902),r=e.i(71645),i=e.i(53496),s=e.i(75712),n=e.i(98573),l=e.i(82725),o=e.i(61911),d=e.i(26912),c=e.i(4756),u=e.i(85810),p=e.i(7764),m=e.i(2143),f=e.i(98961),y=e.i(48182),v=e.i(24623);function A(){let[e,A]=(0,r.useState)("participation"),[I,h]=(0,r.useState)(""),[g,E]=(0,r.useState)({department:null,major:null,year:null}),[x,P]=(0,r.useState)(!1),[w,C]=(0,r.useState)(!1),[b,j]=(0,r.useState)(!1),[T,$]=(0,r.useState)({}),[R,S]=(0,r.useState)(null),[D,N]=(0,r.useState)(!1),[O,k]=(0,r.useState)([]),[B,L]=(0,r.useState)([]);(0,r.useEffect)(()=>{U()},[]);let U=async()=>{N(!0);try{let[e,t]=await Promise.all([(0,f.getAllActivities)(),(0,y.getAllAttendances)()]);k(e),L(t)}catch(e){n.message.error("ไม่สามารถโหลดข้อมูลการเข้าร่วมได้"),console.error("Error fetching data:",e)}finally{N(!1)}},q=()=>{let e=O.map(e=>{let t=B.filter(t=>t.activityId===e.id),a=t.filter(e=>["APPLIED","APPROVED","REVISION_REQUIRED"].includes(e.status)).length,r=t.filter(e=>["SUBMITTED","APPROVED","COMPLETED","REJECTED"].includes(e.status)).length;return{...e,participationCount:a,evidenceCount:r,attendances:t}});if(I){let t=I.toLowerCase();e=e.filter(e=>e.name?.toLowerCase().includes(t)||e.department?.name?.toLowerCase().includes(t))}return g.department&&(e=e.filter(e=>e.department?.name===g.department)),g.major&&(e=e.filter(e=>e.majorJoins?.some(e=>e.major?.name===g.major))),g.year&&(e=e.filter(e=>e.level===`ปี ${g.year}`)),e},M=e=>{h(e)},F=(e,t)=>{E(a=>({...a,[e]:t}))},z=()=>{h(""),E({department:null,major:null,year:null}),n.message.success("Reset filters successfully")},V=async e=>{S(e),C(!0),j(!0);try{var t;let a,r=await (0,v.getFilesByActivity)(e.id);$((t=Array.isArray(r)?r:[],a={},t.forEach(e=>{let t=e?.ownerId;t&&(a[t]||(a[t]=[]),a[t].push(e))}),a))}catch(e){$({}),n.message.error("ไม่สามารถโหลดไฟล์หลักฐานได้")}finally{j(!1)}},_=e=>{n.message.info(`Edit activity: ${e.activityName}`)},H=e=>{n.message.success(`Deleted activity: ${e.activityName}`)},J=async e=>{try{await (0,y.updateAttendance)(e.id,{status:"APPROVED"}),n.message.success(`อนุมัติการเข้าร่วมสำเร็จ`),U()}catch(e){n.message.error("ไม่สามารถอนุมัติการเข้าร่วมได้"),console.error("Error approving attendance:",e)}},Q=async e=>{try{await (0,y.updateAttendance)(e.id,{status:"REVISION_REQUIRED",remark:e.rejectReason||void 0}),n.message.success("ส่งกลับแก้ไขการเข้าร่วมสำเร็จ"),U()}catch(e){n.message.error("ไม่สามารถส่งกลับแก้ไขการเข้าร่วมได้"),console.error("Error requesting participation revision:",e)}},Y=async e=>{try{await (0,y.updateAttendance)(e.id,{status:"APPROVED"}),n.message.success(`อนุมัติหลักฐานสำเร็จ`),U()}catch(e){n.message.error("ไม่สามารถอนุมัติหลักฐานได้"),console.error("Error approving evidence:",e)}},G=async e=>{try{await (0,y.updateAttendance)(e.id,{status:"REVISION_REQUIRED",remark:e.rejectReason||void 0}),n.message.success("ส่งกลับแก้ไขหลักฐานสำเร็จ"),U()}catch(e){n.message.error("ไม่สามารถส่งกลับแก้ไขหลักฐานได้"),console.error("Error requesting evidence revision:",e)}},K=[{key:"participation",label:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Users,{size:18}),"Event Participation"]}),children:(0,t.jsxs)("div",{children:[(0,t.jsx)(c.default,{onSearch:M,onFilterChange:F,onReset:z}),(0,t.jsx)(s.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:(0,t.jsx)(l.Spin,{spinning:D,children:(0,t.jsx)(u.default,{data:q(),onView:e=>{S(e),P(!0)},onEdit:_,onDelete:H,showParticipationCount:!0})})})]})},{key:"evidence",label:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.FileCheck,{size:18}),"Participation Evidence"]}),children:(0,t.jsxs)("div",{children:[(0,t.jsx)(c.default,{onSearch:M,onFilterChange:F,onReset:z}),(0,t.jsx)(s.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:(0,t.jsx)(l.Spin,{spinning:D,children:(0,t.jsx)(u.default,{data:q(),onView:V,onEdit:_,onDelete:H,showEvidenceCount:!0})})})]})}];return(0,t.jsxs)("div",{className:"jsx-ddb748a2f4573329",children:[(0,t.jsx)(i.Tabs,{activeKey:e,onChange:A,items:K,size:"large",className:"custom-main-tabs"}),(0,t.jsx)(p.default,{visible:x,onClose:()=>P(!1),activity:R,onApprove:J,onReject:Q}),(0,t.jsx)(m.default,{visible:w,onClose:()=>C(!1),activity:R,onApprove:Y,onReject:G,filesByAttendanceId:T,loading:b}),(0,t.jsx)(a.default,{id:"ddb748a2f4573329",children:".custom-main-tabs .ant-tabs-tab.ant-tabs-tab-active .ant-tabs-tab-btn{color:#0a894c!important;font-weight:600!important}.custom-main-tabs .ant-tabs-ink-bar{background:#0a894c!important;height:3px!important}.custom-main-tabs .ant-tabs-tab:hover{color:#0a894c!important}.custom-main-tabs .ant-tabs-nav{margin-bottom:24px!important}"})]})}e.s(["default",()=>A])}]);