(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,39874,e=>{"use strict";var t=e.i(8206);function a(e,a){let r=[void 0,void 0],l=Array.isArray(e)?e:[e,void 0],s=a||{xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0};return l.forEach((e,a)=>{if("object"==typeof e&&null!==e)for(let l=0;l<t.responsiveArray.length;l++){let i=t.responsiveArray[l];if(s[i]&&void 0!==e[i]){r[a]=e[i];break}}else r[a]=e}),r}e.s(["default",()=>a])},59442,e=>{"use strict";let t=(0,e.i(71645).createContext)({});e.s(["default",0,t])},64042,e=>{"use strict";e.i(47167);var t=e.i(71645),a=e.i(7670),r=e.i(8206),l=e.i(42064),s=e.i(50073),i=e.i(39874),n=e.i(59442),o=e.i(56570);function d(e,a){let[l,s]=t.useState("string"==typeof e?e:"");return t.useEffect(()=>{(()=>{if("string"==typeof e&&s(e),"object"==typeof e)for(let t=0;t<r.responsiveArray.length;t++){let l=r.responsiveArray[t];if(!a||!a[l])continue;let i=e[l];if(void 0!==i)return void s(i)}})()},[JSON.stringify(e),a]),l}let c=t.forwardRef((e,r)=>{let{prefixCls:c,justify:m,align:u,className:p,style:y,children:f,gutter:x=0,wrap:h,...g}=e,{getPrefixCls:v,direction:j}=t.useContext(l.ConfigContext),A=(0,s.default)(!0,null),b=d(u,A),I=d(m,A),N=v("row",c),[C,w]=(0,o.useRowStyle)(N),T=(0,i.default)(x,A),E=(0,a.clsx)(N,{[`${N}-no-wrap`]:!1===h,[`${N}-${I}`]:I,[`${N}-${b}`]:b,[`${N}-rtl`]:"rtl"===j},p,C,w),$={};T?.[0]&&($.marginInline="number"==typeof T[0]?`${-(T[0]/2)}px`:`calc(${T[0]} / -2)`);let[S,P]=T;$.rowGap=P;let O=t.useMemo(()=>({gutter:[S,P],wrap:h}),[S,P,h]);return t.createElement(n.default.Provider,{value:O},t.createElement("div",{...g,className:E,style:{...$,...y},ref:r},f))});e.s(["Row",0,c],64042)},31757,e=>{"use strict";var t=e.i(71645),a=e.i(7670),r=e.i(42064),l=e.i(59442),s=e.i(56570);function i(e){return"auto"===e?"1 1 auto":"number"==typeof e?`${e} ${e} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?`0 0 ${e}`:e}let n=["xs","sm","md","lg","xl","xxl"],o=t.forwardRef((e,o)=>{let{getPrefixCls:d,direction:c}=t.useContext(r.ConfigContext),{gutter:m,wrap:u}=t.useContext(l.default),{prefixCls:p,span:y,order:f,offset:x,push:h,pull:g,className:v,children:j,flex:A,style:b,...I}=e,N=d("col",p),[C,w]=(0,s.useColStyle)(N),T={},E={};n.forEach(t=>{let a={},r=e[t];"number"==typeof r?a.span=r:"object"==typeof r&&(a=r||{}),delete I[t],E={...E,[`${N}-${t}-${a.span}`]:void 0!==a.span,[`${N}-${t}-order-${a.order}`]:a.order||0===a.order,[`${N}-${t}-offset-${a.offset}`]:a.offset||0===a.offset,[`${N}-${t}-push-${a.push}`]:a.push||0===a.push,[`${N}-${t}-pull-${a.pull}`]:a.pull||0===a.pull,[`${N}-rtl`]:"rtl"===c},a.flex&&(E[`${N}-${t}-flex`]=!0,T[`--${N}-${t}-flex`]=i(a.flex))});let $=(0,a.clsx)(N,{[`${N}-${y}`]:void 0!==y,[`${N}-order-${f}`]:f,[`${N}-offset-${x}`]:x,[`${N}-push-${h}`]:h,[`${N}-pull-${g}`]:g},v,E,C,w),S={};return m?.[0]&&(S.paddingInline="number"==typeof m[0]?`${m[0]/2}px`:`calc(${m[0]} / 2)`),A&&(S.flex=i(A),!1!==u||S.minWidth||(S.minWidth=0)),t.createElement("div",{...I,style:{...S,...b,...T},className:$,ref:o},j)});e.s(["default",0,o])},17851,e=>{"use strict";let t={STUDENT:"student",TEACHER:"teacher",DEPT_STAFF:"admin",FACULTY_ADMIN:"admin",SUPER_ADMIN:"admin"},a={planned:"OPEN_REGISTRATION",inprogress:"IN_PROGRESS",completed:"CLOSED",cancelled:"CANCELLED"},r={APPLIED:"request-revision",APPROVED:"approve",REJECTED:"request-revision",REVISION_REQUIRED:"request-revision",CANCELLED:"request-revision",NO_SHOW:"request-revision",SUBMITTED:"request-revision",COMPLETED:"approve",joined:"request-revision",accepted:"approve",approved:"approve",completed:"approve",rejected:"request-revision",uncompleted:"request-revision",Inprogress:"request-revision"};function l(e){let t=(null==e?"":String(e)).trim();if(!t)return{firstName:"User",lastName:""};let a=t.split(/\s+/);return{firstName:a.shift()||"User",lastName:a.join(" ")}}function s(e){return t[e]||"student"}function i(e){return a[e]||e||void 0}function n(e){return e||"APPLIED"}function o(e){return r[e]||"request-revision"}function d(e){let t=new Map;return e.forEach(e=>{e?.id&&t.set(e.id,e)}),Array.from(t.values())}function c(e){if(!e)return null;let t=[e.firstName,e.lastName].filter(Boolean).join(" ").trim(),a=e.fullname||t||e.username||e.email||"Unknown",r=e.faculty||e.studentProfile?.faculty||e.teacherProfile?.faculty||e.staffProfile?.faculty||null,i=e.department||e.studentProfile?.department||e.teacherProfile?.department||e.staffProfile?.department||null,n=e.major||e.studentProfile?.major||null,o=e.studentCode||e.studentProfile?.studentCode||null,d=e.classYear||e.studentProfile?.classYear||null,c=e.academicYear||e.studentProfile?.academicYear||null;return{id:e.id,role:e.role,userType:s(e.role),username:e.username||null,email:e.email||null,fullname:a,name:a,firstName:e.firstName||l(a).firstName,lastName:e.lastName||l(a).lastName,phone:e.phone||null,status:e.status||"ACTIVE",studentId:o,studentCode:o,classYear:d,academicYear:c,level:d,facultyId:e.facultyId||e.studentProfile?.facultyId||e.teacherProfile?.facultyId||e.staffProfile?.facultyId||r?.id||null,faculty:r,departmentId:e.departmentId||e.studentProfile?.departmentId||e.teacherProfile?.departmentId||e.staffProfile?.departmentId||i?.id||null,department:i,majorId:e.majorId||e.studentProfile?.majorId||n?.id||null,major:n}}function m(e,t=null){let a=c(e?.student||e?.user||null);return{id:e.id,activityId:e.activityId||t?.id||null,userId:e.studentUserId||a?.id||null,status:n(e.status),reason:e.remark||null,createdAt:e.submittedAt||e.createdAt||null,updatedAt:e.updatedAt||null,user:a,activity:t,attendanceId:e.id}}function u(e){var t;let a,r;if(!e)return null;let l=Array.isArray(e?.applications)?e.applications:[],s=l.map(e=>m(e)),i=l.filter(e=>["APPLIED","APPROVED","REVISION_REQUIRED"].includes(e.status)).length,n=e.activityType?{id:e.activityType.id,code:e.activityType.code,name:e.activityType.name}:e.typeActivity?{id:e.typeActivity.id,code:e.typeActivity.code,name:e.typeActivity.name}:(t=e.requiredEvidenceType,(a={PHOTO:{id:"PHOTO",name:"ใช้รูปภาพ"},PDF:{id:"PDF",name:"ใช้ PDF"},BOTH:{id:"BOTH",name:"ทั่วไป"}})[t]||a.BOTH),o=(r=(Array.isArray(e?.targetDepartments)?e.targetDepartments:[]).map(e=>({departmentId:e?.departmentId||e?.department?.id||null,department:e?.department||null})).filter(e=>e.departmentId)).length>0?r:e?.ownerDepartmentId||e?.ownerDepartment?.id?[{departmentId:e.ownerDepartmentId||e.ownerDepartment?.id,department:e.ownerDepartment||null}]:[],c=d(o.map(e=>e.department).filter(e=>e?.id)),u=o.map(e=>e.departmentId).filter(Boolean),p=c[0]||e.ownerDepartment||null,y=(Array.isArray(e?.targetMajors)?e.targetMajors:Array.isArray(e?.majorJoins)?e.majorJoins:[]).map(e=>({majorId:e?.majorId||e?.major?.id||null,major:e?.major||null})).filter(e=>e.majorId),f=d(y.map(e=>e.major).filter(e=>e?.id)),x=y.map(e=>e.majorId).filter(Boolean),h=s.map(t=>({...t,activityId:t.activityId||e.id}));return{id:e.id,name:e.title,title:e.title,description:e.note||"",note:e.note||"",location:e.location,address:e.location,hour:e.hours,hours:e.hours,activityHours:e.hours,maxPeopleCount:e.capacity,maxStudents:e.capacity,peopleCount:i,startDate:e.startAt,endDate:e.endAt,date:e.applyCloseAt,startAt:e.startAt,endAt:e.endAt,applyOpen:e.applyOpenAt,applyClose:e.applyCloseAt,applyOpenAt:e.applyOpenAt,applyCloseAt:e.applyCloseAt,status:e.status||"OPEN_REGISTRATION",departmentId:u[0]||e.ownerDepartmentId||null,departmentIds:u,facultyId:e.ownerFacultyId||null,department:p,departments:c,faculty:e.ownerFaculty||null,activityType:e.activityType||n,typeActivity:n,typeActivityId:e.activityTypeId||n.id,requiredEvidenceType:e.requiredEvidenceType,ownerScope:e.ownerScope,attendances:h,applications:l,createdBy:e.createdBy||null,targetDepartments:o,majorJoins:y,targetMajors:y,majorIds:x,majors:f,level:e.level||null,createdAt:e.createdAt||null,updatedAt:e.updatedAt||null,fileActivities:[],remarks:e.note||""}}e.s(["mapActivityStatusToApi",()=>i,"mapApplicationStatusFromApi",()=>n,"mapLegacyAttendanceAction",()=>o,"normalizeActivity",()=>u,"normalizeAttendance",()=>m,"normalizeUser",()=>c,"roleToUserType",()=>s])},38953,e=>{"use strict";e.i(47167);var t=e.i(71645);let a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"};var r=e.i(9583);function l(){return(l=Object.assign.bind()).apply(this,arguments)}let s=t.forwardRef((e,s)=>t.createElement(r.default,l({},e,{ref:s,icon:a})));e.s(["default",0,s],38953)},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},90121,22611,e=>{"use strict";var t=e.i(71645);let a=e=>e&&"object"==typeof e?e:"boolean"==typeof e?{enabled:e,blur:e}:{};e.s(["useMergedMask",0,(e,r,l)=>(0,t.useMemo)(()=>{let t=a(e),s={...a(r),...t},i=!1!==s.blur?`${l}-mask-blur`:void 0;return[!1!==s.enabled,{mask:i}]},[e,r,l])],90121),e.i(63335);var r=e.i(80251);function l(){}let s=t.createContext({add:l,remove:l});function i(e){let a=t.useContext(s),l=t.useRef(null);return(0,r.useEvent)(t=>{if(t){let r=e?t.querySelector(e):t;r&&(a.add(r),l.current=r)}else a.remove(l.current)})}e.s(["usePanelRef",()=>i],22611)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},99133,e=>{"use strict";var t=e.i(27494);e.s(["Select",()=>t.default])},88511,e=>{"use strict";let t=(0,e.i(75254).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);e.s(["Edit",()=>t],88511)},83552,7233,27612,e=>{"use strict";e.i(47167);var t=e.i(71645),a=e.i(62901);e.i(63335);var r=e.i(51095),l=e.i(30294),s=e.i(7670),i=e.i(11517),n=e.i(42064),o=e.i(29672),d=e.i(96158),c=e.i(85781),m=e.i(36938),u=e.i(20228),p=e.i(62405),y=e.i(8850),f=e.i(87414),x=e.i(10730);let h=(0,e.i(46422).genStyleHooks)("Popconfirm",e=>(e=>{let{componentCls:t,iconCls:a,antCls:r,zIndexPopup:l,colorText:s,colorWarning:i,marginXXS:n,marginXS:o,fontSize:d,fontWeightStrong:c,colorTextHeading:m}=e;return{[t]:{zIndex:l,[`&${r}-popover`]:{fontSize:d},[`${t}-message`]:{marginBottom:o,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${t}-message-icon ${a}`]:{color:i,fontSize:d,lineHeight:1,marginInlineEnd:o},[`${t}-title`]:{fontWeight:c,color:m,"&:only-child":{fontWeight:"normal"}},[`${t}-description`]:{marginTop:n,color:s}},[`${t}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:o}}}}})(e),e=>{let{zIndexPopupBase:t}=e;return{zIndexPopup:t+60}},{resetStyle:!1}),g=e=>{let{prefixCls:r,okButtonProps:l,cancelButtonProps:i,title:o,description:d,cancelText:x,okText:h,okType:g="primary",icon:v=t.createElement(a.default,null),showCancel:j=!0,close:A,onConfirm:b,onCancel:I,onPopupClick:N,classNames:C,styles:w}=e,{getPrefixCls:T}=t.useContext(n.ConfigContext),[E]=(0,y.useLocale)("Popconfirm",f.default.Popconfirm),$=(0,m.getRenderPropValue)(o),S=(0,m.getRenderPropValue)(d);return t.createElement("div",{className:`${r}-inner-content`,onClick:N},t.createElement("div",{className:`${r}-message`},v&&t.createElement("span",{className:`${r}-message-icon`},v),t.createElement("div",{className:`${r}-message-text`},$&&t.createElement("div",{className:(0,s.clsx)(`${r}-title`,C?.title),style:w?.title},$),S&&t.createElement("div",{className:(0,s.clsx)(`${r}-description`,C?.content),style:w?.content},S))),t.createElement("div",{className:`${r}-buttons`},j&&t.createElement(u.default,{onClick:I,size:"small",...i},x||E?.cancelText),t.createElement(c.default,{buttonProps:{size:"small",...(0,p.convertLegacyProps)(g),...l},actionFn:b,close:A,prefixCls:T("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},h||E?.okText)))},v=t.forwardRef((e,c)=>{let{prefixCls:m,placement:u="top",trigger:p="click",okType:y="primary",icon:f=t.createElement(a.default,null),children:x,overlayClassName:v,onOpenChange:j,overlayStyle:A,styles:b,arrow:I,classNames:N,...C}=e,{getPrefixCls:w,className:T,style:E,classNames:$,styles:S,arrow:P}=(0,n.useComponentConfig)("popconfirm"),[O,D]=(0,l.useControlledState)(e.defaultOpen??!1,e.open),k=(0,d.default)(I,P),R=(e,t)=>{D(e),j?.(e,t)},M=w("popconfirm",m),F={...e,placement:u,trigger:p,okType:y,overlayStyle:A,styles:b,classNames:N},[q,B]=(0,i.useMergeSemantic)([$,N],[S,b],{props:F}),z=(0,s.clsx)(M,T,v,q.root);return h(M),t.createElement(o.default,{arrow:k,...(0,r.omit)(C,["title"]),trigger:p,placement:u,onOpenChange:(t,a)=>{let{disabled:r=!1}=e;r||R(t,a)},open:O,ref:c,classNames:{root:z,container:q.container,arrow:q.arrow},styles:{root:{...E,...B.root,...A},container:B.container,arrow:B.arrow},content:t.createElement(g,{okType:y,icon:f,...e,prefixCls:M,close:e=>{R(!1,e)},onConfirm:t=>e.onConfirm?.call(void 0,t),onCancel:t=>{R(!1,t),e.onCancel?.call(void 0,t)},classNames:q,styles:B}),"data-popover-inject":!0},x)});v._InternalPanelDoNotUseOrYouWillBeFired=e=>{let{prefixCls:a,placement:r,className:l,style:i,...o}=e,{getPrefixCls:d}=t.useContext(n.ConfigContext),c=d("popconfirm",a);return h(c),t.createElement(x.default,{placement:r,className:(0,s.clsx)(c,l),style:i,content:t.createElement(g,{prefixCls:c,...o})})},e.s(["Popconfirm",0,v],83552);var j=e.i(75254);let A=(0,j.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>A],7233);let b=(0,j.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>b],27612)},27521,e=>{"use strict";var t=e.i(2783);let a=async()=>{var e;let a,r=await t.default.get("/activities");return e=(Array.isArray(r.data)?r.data:[]).map(e=>e.ownerDepartment).filter(e=>e?.id),a=new Map,e.forEach(e=>{e?.id&&a.set(e.id,e)}),Array.from(a.values())},r=e=>[401,403].includes(e?.response?.status),l=async(e={})=>{try{let a=await t.default.get("/departments",{params:e});return Array.isArray(a.data)?a.data:[]}catch(e){if(r(e))return a();throw e}},s=async e=>(await t.default.post("/departments",e)).data,i=async(e,a)=>(await t.default.patch(`/departments/${e}`,a)).data,n=async e=>(await t.default.delete(`/departments/${e}`)).data,o=async()=>{let e=await t.default.get("/departments/faculties");return Array.isArray(e.data)?e.data:[]},d=async e=>{if(!e)return[];try{let a=await t.default.get(`/departments/${e}/majors`);return Array.isArray(a.data)?a.data:[]}catch(a){if(r(a)){let a=await t.default.get(`/activities/departments/${e}/majors`);return Array.isArray(a.data)?a.data:[]}throw a}},c=async(e,a)=>(await t.default.post(`/departments/${e}/majors`,a)).data,m=async(e,a,r)=>(await t.default.patch(`/departments/${e}/majors/${a}`,r)).data,u=async(e,a)=>(await t.default.delete(`/departments/${e}/majors/${a}`)).data;e.s(["createDepartment",0,s,"createMajor",0,c,"deleteDepartment",0,n,"deleteMajor",0,u,"getAllDepartments",0,l,"getAllFaculties",0,o,"getMajorsByDepartment",0,d,"updateDepartment",0,i,"updateMajor",0,m])},20905,e=>{"use strict";var t=e.i(2783);let a=async(e={})=>{let a=await t.default.get("/activity-types",{params:e});return Array.isArray(a.data)?a.data:[]},r=async e=>(await t.default.post("/activity-types",e)).data,l=async(e,a)=>(await t.default.patch(`/activity-types/${e}`,a)).data,s=async e=>(await t.default.delete(`/activity-types/${e}`)).data;e.s(["createTypeActivity",0,r,"deleteTypeActivity",0,s,"getAllTypeActivities",0,a,"updateTypeActivity",0,l])},24880,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(64571),l=e.i(75712),s=e.i(8613),i=e.i(11451),n=e.i(12931),o=e.i(83552),d=e.i(99133),c=e.i(82725),m=e.i(91542),u=e.i(62218),p=e.i(98573),y=e.i(88511),f=e.i(86536),x=e.i(7233),h=e.i(55436),g=e.i(27612),v=e.i(98961),j=e.i(27521),A=e.i(20905),b=e.i(75312);let I=[{value:"OPEN_REGISTRATION",label:"เปิดรับสมัคร"},{value:"IN_PROGRESS",label:"กำลังดำเนินการ"},{value:"CLOSED",label:"ปิดกิจกรรม"},{value:"CANCELLED",label:"ยกเลิกกิจกรรม"}],N=[{value:"BOTH",label:"ทั่วไป (รูปภาพ/PDF)"},{value:"PHOTO",label:"รูปภาพเท่านั้น"},{value:"PDF",label:"PDF เท่านั้น"}],C=e=>e?Array.isArray(e)?e.filter(Boolean):[e]:[],w=e=>Array.isArray(e?.majorJoins)?e.majorJoins:Array.isArray(e?.targetMajors)?e.targetMajors:[],T=e=>{if(!e)return;let t=new Date(e);if(Number.isNaN(t.getTime()))return;let a=60*t.getTimezoneOffset()*1e3;return new Date(t.getTime()-a).toISOString().slice(0,16)},E=e=>{if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()},$=e=>{if(!e)return"-";let t=new Date(e);return Number.isNaN(t.getTime())?"-":t.toLocaleString("th-TH")};function S(){let[e]=s.Form.useForm(),[S,P]=(0,a.useState)(null),[O,D]=(0,a.useState)(!1),[k,R]=(0,a.useState)(!1),[M,F]=(0,a.useState)([]),[q,B]=(0,a.useState)([]),[z,L]=(0,a.useState)([]),[H,U]=(0,a.useState)(""),[_,V]=(0,a.useState)(null),[W,G]=(0,a.useState)(!1),[J,Y]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(null),[X,Z]=(0,a.useState)(null);(0,a.useEffect)(()=>{P((0,b.getUserScope)())},[]);let ee=async()=>{if(!S?.departmentId)return void p.message.error("ไม่พบข้อมูลภาควิชาของผู้ใช้");D(!0);try{let[e,t,a]=await Promise.all([(0,v.getAllActivities)({departmentId:S.departmentId}),(0,A.getAllTypeActivities)(),(0,j.getMajorsByDepartment)(S.departmentId)]),r=Array.isArray(e)?e:[];F(r.filter(e=>{var t;return t=S.departmentId,(Array.isArray(e?.departments)&&e.departments.length>0?e.departments:e?.department?.id?[e.department]:[]).some(e=>e?.id===t)})),L(Array.isArray(t)?t:[]),B(Array.isArray(a)?a:[])}catch(e){console.error("Error fetching teacher events:",e),p.message.error("ไม่สามารถโหลดข้อมูลได้")}finally{D(!1)}};(0,a.useEffect)(()=>{ee()},[S?.departmentId]);let et=(0,a.useMemo)(()=>{let e=H.trim().toLowerCase();return M.filter(t=>(!e||!!`${t.name||""} ${t.typeActivity?.name||""}`.toLowerCase().includes(e))&&(!_||(t.typeActivity?.id||t.typeActivityId)===_))},[M,H,_]),ea=(0,a.useMemo)(()=>({totalActivities:et.length,totalHours:et.reduce((e,t)=>e+Number(t.hour||t.hours||0),0)}),[et]),er=async e=>{try{await (0,v.deleteActivity)(e.id),p.message.success(`ลบกิจกรรม "${e.name||e.title}" สำเร็จ`),await ee()}catch(t){let e=t?.response?.data?.message||"ไม่สามารถลบกิจกรรมได้";p.message.error(e)}},el=async t=>{var a;let r;if(!S?.departmentId)return void p.message.error("ไม่พบข้อมูลภาควิชาของผู้ใช้");let l={title:t.title,startAt:E(t.startAt),endAt:E(t.endAt),location:t.location,hours:Number(t.hours),requiredEvidenceType:t.requiredEvidenceType,activityTypeId:t.activityTypeId,capacity:Number(t.capacity),applyOpenAt:E(t.applyOpenAt),applyCloseAt:E(t.applyCloseAt),note:t.note||void 0,departmentIds:[S.departmentId],majorIds:(a=C(t.majorIds).map(e=>({id:e})),r=new Map,a.forEach(e=>{e?.id&&r.set(e.id,e)}),Array.from(r.values())).map(e=>e.id),status:t.status};R(!0);try{K?(await (0,v.updateActivity)(K.id,l),p.message.success("แก้ไขกิจกรรมสำเร็จ")):(await (0,v.createActivity)(l),p.message.success("เพิ่มกิจกรรมสำเร็จ")),G(!1),Q(null),e.resetFields(),await ee()}catch(t){let e=t?.response?.data?.message||"ไม่สามารถบันทึกกิจกรรมได้";p.message.error(e)}finally{R(!1)}},es=[{title:"ลำดับ",width:80,align:"center",render:(e,t,a)=>a+1},{title:"ชื่อกิจกรรม",dataIndex:"name",render:(e,t)=>e||t.title||"-"},{title:"ประเภท",width:200,render:(e,a)=>(0,t.jsx)(u.Tag,{color:"#0A894C",children:a.typeActivity?.name||"ไม่ระบุประเภท"})},{title:"ช่วงเวลา",width:260,render:(e,a)=>(0,t.jsxs)("span",{children:[$(a.startAt||a.startDate)," -"," ",$(a.endAt||a.endDate)]})},{title:"สาขาวิชา",width:260,render:(e,a)=>{let r=w(a);return 0===r.length?(0,t.jsx)("span",{className:"text-gray-500",children:"-"}):(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:r.map(e=>(0,t.jsxs)(u.Tag,{color:"#0A894C",children:[e.major?.code?`${e.major.code} - `:"",e.major?.name||e.majorId]},e.majorId))})}},{title:"สถานะ",width:160,render:(e,a)=>(0,t.jsx)(u.Tag,{color:"blue",children:I.find(e=>e.value===a.status)?.label||a.status})},{title:"จัดการ",width:140,align:"center",render:(a,l)=>(0,t.jsxs)("div",{className:"flex gap-1 justify-center",children:[(0,t.jsx)(r.Button,{type:"text",icon:(0,t.jsx)(f.Eye,{size:18}),onClick:()=>Z(l)}),(0,t.jsx)(r.Button,{type:"text",icon:(0,t.jsx)(y.Edit,{size:18}),onClick:()=>{let t;return Q(l),void(e.setFieldsValue({title:l.title||l.name||"",location:l.location||"",hours:Number(l.hours||l.hour||1),capacity:Number(l.capacity||l.maxPeopleCount||1),activityTypeId:l.typeActivity?.id||l.typeActivityId,requiredEvidenceType:l.requiredEvidenceType||"BOTH",startAt:T(l.startAt||l.startDate),endAt:T(l.endAt||l.endDate),applyOpenAt:T(l.applyOpenAt||l.applyOpen),applyCloseAt:T(l.applyCloseAt||l.applyClose),status:l.status||"OPEN_REGISTRATION",note:l.note||l.description||"",majorIds:(t=C(l?.majorIds)).length>0?t:w(l).map(e=>e?.majorId||e?.major?.id).filter(Boolean)}),G(!0))}}),(0,t.jsx)(o.Popconfirm,{title:"ยืนยันการลบกิจกรรม",description:"ต้องการลบกิจกรรมนี้หรือไม่",onConfirm:()=>er(l),okText:"ลบ",cancelText:"ยกเลิก",children:(0,t.jsx)(r.Button,{danger:!0,type:"text",icon:(0,t.jsx)(g.Trash2,{size:18})})})]})}];return(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Card,{className:"mb-4 shadow-sm",style:{background:"linear-gradient(135deg, #0A894C 0%, #0ea258 100%)",border:"none"},children:(0,t.jsxs)("div",{className:"text-white",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold mb-1",children:["ภาควิชา ",S?.departmentName||"-"]}),(0,t.jsx)("p",{className:"text-sm opacity-90",children:"จัดการกิจกรรมของภาควิชา"})]})}),(0,t.jsxs)("div",{className:"p-4 rounded-lg mb-4",style:{background:"#ffffff",border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-4",children:[(0,t.jsx)(i.Input,{placeholder:"ค้นหาจากชื่อกิจกรรม",prefix:(0,t.jsx)(h.Search,{size:16,style:{color:"#0A894C"}}),onChange:e=>U(e.target.value),value:H,size:"large",style:{maxWidth:420,borderColor:"#0A894C"}}),(0,t.jsx)(r.Button,{type:"primary",icon:(0,t.jsx)(x.Plus,{size:18}),onClick:()=>{let t=new Date,a=new Date(t.getTime()+36e5),r=new Date(t.getTime()-72e5),l=new Date(t.getTime()-36e5);Q(null),e.resetFields(),e.setFieldsValue({title:"",location:"",hours:1,capacity:1,activityTypeId:void 0,requiredEvidenceType:"BOTH",startAt:T(t),endAt:T(a),applyOpenAt:T(r),applyCloseAt:T(l),status:"OPEN_REGISTRATION",note:"",majorIds:[]}),G(!0)},size:"large",style:{backgroundColor:"#0A894C",borderColor:"#0A894C"},children:"เพิ่มกิจกรรม"})]}),(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-4",children:(0,t.jsx)(d.Select,{placeholder:"กรองตามประเภทกิจกรรม",allowClear:!0,value:_,onChange:V,style:{minWidth:300},children:z.map(e=>(0,t.jsx)(d.Select.Option,{value:e.id,children:e.name},e.id))})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,t.jsx)(l.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)",background:"linear-gradient(135deg, #0A894C 0%, #0ea258 100%)"},children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-white text-sm mb-1 opacity-90",children:"Total Activities"}),(0,t.jsx)("h2",{className:"text-white text-3xl font-bold",children:ea.totalActivities})]}),(0,t.jsx)("div",{className:"p-4 rounded-full",style:{backgroundColor:"rgba(255, 255, 255, 0.2)"},children:(0,t.jsx)(h.Search,{size:32,className:"text-white"})})]})}),(0,t.jsx)(l.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)",background:"linear-gradient(135deg, #1890ff 0%, #40a9ff 100%)"},children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-white text-sm mb-1 opacity-90",children:"Total Activity Hours"}),(0,t.jsx)("h2",{className:"text-white text-3xl font-bold",children:ea.totalHours})]}),(0,t.jsx)("div",{className:"p-4 rounded-full",style:{backgroundColor:"rgba(255, 255, 255, 0.2)"},children:(0,t.jsx)(x.Plus,{size:32,className:"text-white"})})]})})]}),(0,t.jsx)(l.Card,{style:{borderRadius:8,border:"1px solid #e8f5e9",boxShadow:"0 2px 8px rgba(10, 137, 76, 0.08)"},children:(0,t.jsx)(c.Spin,{spinning:O,children:(0,t.jsx)(m.Table,{columns:es,dataSource:et,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`ทั้งหมด ${e} รายการ`},scroll:{x:1e3}})})}),(0,t.jsx)(n.Modal,{title:(0,t.jsx)("h3",{className:"text-lg font-semibold",style:{color:"#0A894C"},children:K?"แก้ไขกิจกรรม":"เพิ่มกิจกรรม"}),open:W,onCancel:()=>{G(!1),Q(null),e.resetFields()},onOk:()=>e.submit(),okText:K?"บันทึก":"เพิ่ม",cancelText:"ยกเลิก",confirmLoading:k,width:860,okButtonProps:{style:{backgroundColor:"#0A894C",borderColor:"#0A894C"}},children:(0,t.jsxs)(s.Form,{form:e,layout:"vertical",onFinish:el,className:"mt-4",children:[(0,t.jsx)(s.Form.Item,{label:"ชื่อกิจกรรม",name:"title",rules:[{required:!0,message:"กรุณากรอกชื่อกิจกรรม"}],children:(0,t.jsx)(i.Input,{placeholder:"ชื่อกิจกรรม"})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(s.Form.Item,{label:"ประเภทกิจกรรม",name:"activityTypeId",rules:[{required:!0,message:"กรุณาเลือกประเภทกิจกรรม"}],children:(0,t.jsx)(d.Select,{placeholder:"เลือกประเภทกิจกรรม",children:z.map(e=>(0,t.jsx)(d.Select.Option,{value:e.id,children:e.name},e.id))})}),(0,t.jsx)(s.Form.Item,{label:"รูปแบบหลักฐาน",name:"requiredEvidenceType",rules:[{required:!0,message:"กรุณาเลือกรูปแบบหลักฐาน"}],children:(0,t.jsx)(d.Select,{options:N})})]}),(0,t.jsx)(s.Form.Item,{label:"สถานที่",name:"location",rules:[{required:!0,message:"กรุณากรอกสถานที่"}],children:(0,t.jsx)(i.Input,{placeholder:"สถานที่จัดกิจกรรม"})}),(0,t.jsx)(s.Form.Item,{label:"สาขาวิชา",name:"majorIds",rules:[{required:!0,message:"กรุณาเลือกสาขาวิชาอย่างน้อย 1 สาขา"}],children:(0,t.jsx)(d.Select,{mode:"multiple",placeholder:"เลือกสาขาวิชา",options:q.map(e=>({value:e.id,label:`${e.code} - ${e.name}`}))})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(s.Form.Item,{label:"วันที่เริ่มกิจกรรม",name:"startAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาเริ่มกิจกรรม"}],children:(0,t.jsx)(i.Input,{type:"datetime-local"})}),(0,t.jsx)(s.Form.Item,{label:"วันที่สิ้นสุดกิจกรรม",name:"endAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาสิ้นสุดกิจกรรม"}],children:(0,t.jsx)(i.Input,{type:"datetime-local"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(s.Form.Item,{label:"วันเวลาเริ่มรับสมัคร",name:"applyOpenAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาเริ่มรับสมัคร"}],children:(0,t.jsx)(i.Input,{type:"datetime-local"})}),(0,t.jsx)(s.Form.Item,{label:"วันเวลาปิดรับสมัคร",name:"applyCloseAt",rules:[{required:!0,message:"กรุณาเลือกวันเวลาปิดรับสมัคร"}],children:(0,t.jsx)(i.Input,{type:"datetime-local"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(s.Form.Item,{label:"ชั่วโมงกิจกรรม",name:"hours",rules:[{required:!0,message:"กรุณากรอกชั่วโมงกิจกรรม"}],children:(0,t.jsx)(i.Input,{type:"number",min:1})}),(0,t.jsx)(s.Form.Item,{label:"จำนวนผู้เข้าร่วมสูงสุด",name:"capacity",rules:[{required:!0,message:"กรุณากรอกจำนวนผู้เข้าร่วมสูงสุด"}],children:(0,t.jsx)(i.Input,{type:"number",min:1})}),(0,t.jsx)(s.Form.Item,{label:"สถานะ",name:"status",rules:[{required:!0,message:"กรุณาเลือกสถานะ"}],children:(0,t.jsx)(d.Select,{options:I})})]}),(0,t.jsx)(s.Form.Item,{label:"หมายเหตุ",name:"note",children:(0,t.jsx)(i.Input.TextArea,{rows:3,placeholder:"รายละเอียดเพิ่มเติม"})})]})}),(0,t.jsx)(n.Modal,{title:(0,t.jsx)("h3",{className:"text-lg font-semibold",style:{color:"#0A894C"},children:"รายละเอียดกิจกรรม"}),open:J||!!X,onCancel:()=>{Y(!1),Z(null)},footer:[(0,t.jsx)(r.Button,{onClick:()=>{Y(!1),Z(null)},children:"ปิด"},"close")],width:760,children:X&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"ชื่อกิจกรรม:"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:X.name||X.title||"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"ประเภทกิจกรรม:"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:X.typeActivity?.name||"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"สถานที่:"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:X.location||"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"สาขาวิชา:"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:w(X).length>0?w(X).map(e=>(0,t.jsxs)(u.Tag,{color:"#0A894C",children:[e.major?.code?`${e.major.code} - `:"",e.major?.name||e.majorId]},e.majorId)):(0,t.jsx)("span",{className:"text-gray-500",children:"-"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"ช่วงเวลากิจกรรม:"}),(0,t.jsxs)("p",{className:"text-gray-600 mt-1",children:[$(X.startAt||X.startDate)," -"," ",$(X.endAt||X.endDate)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"ช่วงรับสมัคร:"}),(0,t.jsxs)("p",{className:"text-gray-600 mt-1",children:[$(X.applyOpenAt||X.applyOpen)," -"," ",$(X.applyCloseAt||X.applyClose)]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"ชั่วโมงกิจกรรม:"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:X.hour||X.hours||0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"จำนวนผู้เข้าร่วมสูงสุด:"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:X.maxPeopleCount||X.capacity||0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"font-semibold text-gray-700",children:"หมายเหตุ:"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:X.note||X.description||"-"})]})]})})]})}e.s(["default",()=>S])}]);